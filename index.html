<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>Smart Report Card System - Primary School Karanpur</title>
    <meta name="description" content="Digital Report Card System for Primary School Karanpur - View student performance and manage academic records">
    <meta name="theme-color" content="#667eea">
    
    <!-- Optimized CDN Loading -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Optimized Google Fonts - Reduced to essential fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Poppins:wght@400;500;600;700&family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Optimized Font System */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', system-ui, -apple-system, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .font-primary {
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
        }
        
        .font-heading {
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .font-elegant {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .font-display {
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        /* Optimized Text Shadows */
        .text-shadow-soft {
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .text-shadow-bold {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
        }
        
        .text-shadow-glow {
            text-shadow: 0 0 10px rgba(255,255,255,0.6), 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        /* Performance-Optimized Animations */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { 
                transform: translateY(0) translateZ(0); 
            }
            40% { 
                transform: translateY(-15px) translateZ(0); 
            }
            60% { 
                transform: translateY(-8px) translateZ(0); 
            }
        }
        
        @keyframes wiggle {
            0%, 100% { 
                transform: rotate(0deg) translateZ(0); 
            }
            25% { 
                transform: rotate(-3deg) translateZ(0); 
            }
            75% { 
                transform: rotate(3deg) translateZ(0); 
            }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) translateZ(0); 
            }
            50% { 
                transform: translateY(-10px) translateZ(0); 
            }
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1) translateZ(0); 
            }
            50% { 
                transform: scale(1.02) translateZ(0); 
            }
        }
        
        @keyframes slideIn {
            from { 
                transform: translateX(-50px) translateZ(0); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0) translateZ(0); 
                opacity: 1; 
            }
        }
        
        @keyframes fadeInUp {
            from { 
                transform: translateY(20px) translateZ(0); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0) translateZ(0); 
                opacity: 1; 
            }
        }
        
        /* Report Card Limited Animations - Only for 5 seconds */
        .report-card-bounce {
            animation: bounce 2s ease-in-out;
            animation-iteration-count: 2; /* Only 2 cycles = ~4 seconds */
        }
        
        .report-card-wiggle {
            animation: wiggle 2s ease-in-out;
            animation-iteration-count: 2; /* Only 2 cycles = ~4 seconds */
        }
        
        .report-card-pulse {
            animation: pulse 2s ease-in-out;
            animation-iteration-count: 2; /* Only 2 cycles = ~4 seconds */
        }
        
        .report-card-float {
            animation: float 3s ease-in-out;
            animation-iteration-count: 1; /* Only 1 cycle = ~3 seconds */
        }
        
        /* School Box Animations */
        @keyframes schoolBoxFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            25% { transform: translateY(-8px) scale(1.02); }
            50% { transform: translateY(-12px) scale(1.03); }
            75% { transform: translateY(-6px) scale(1.01); }
        }
        
        @keyframes schoolBoxGlow {
            0%, 100% { 
                box-shadow: 0 20px 50px rgba(0,0,0,0.4), 0 0 0 6px #ffd700, inset 0 0 30px rgba(255,215,0,0.2);
            }
            50% { 
                box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 0 8px #ffd700, 0 0 40px rgba(255,215,0,0.6), inset 0 0 40px rgba(255,215,0,0.3);
            }
        }
        
        /* Floating Elements Around Box */
        @keyframes floatAround1 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10px, -15px) rotate(90deg); }
            50% { transform: translate(-5px, -25px) rotate(180deg); }
            75% { transform: translate(-15px, -10px) rotate(270deg); }
        }
        
        @keyframes floatAround2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-12px, 8px) rotate(-90deg); }
            50% { transform: translate(8px, 20px) rotate(-180deg); }
            75% { transform: translate(18px, 5px) rotate(-270deg); }
        }
        
        @keyframes floatAround3 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(15px, -8px) rotate(120deg); }
            66% { transform: translate(-8px, 12px) rotate(240deg); }
        }
        
        @keyframes floatAround4 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            30% { transform: translate(-10px, -12px) rotate(-108deg); }
            60% { transform: translate(12px, -8px) rotate(-216deg); }
        }
        
        /* Sparkle Rotation */
        @keyframes sparkleRotate {
            0% { transform: rotate(0deg) scale(1); opacity: 0.8; }
            25% { transform: rotate(90deg) scale(1.2); opacity: 1; }
            50% { transform: rotate(180deg) scale(0.8); opacity: 0.6; }
            75% { transform: rotate(270deg) scale(1.1); opacity: 0.9; }
            100% { transform: rotate(360deg) scale(1); opacity: 0.8; }
        }
        
        /* Text Color Shifting Animation */
        @keyframes textColorShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Special Celebration Animations for High Achievers (85%+) */
        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-3deg); }
        }
        
        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        @keyframes starBurst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
        
        @keyframes goldGlow {
            0%, 100% { box-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ffd700; }
            50% { box-shadow: 0 0 40px #ffd700, 0 0 80px #ffd700, 0 0 120px #ffd700; }
        }
        
        @keyframes fireworks {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        @keyframes shower {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .shower-drop {
            position: absolute;
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: shower 2s linear infinite;
            opacity: 0.8;
        }
        
        @keyframes trophy-bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-30px) scale(1.1); }
            60% { transform: translateY(-15px) scale(1.05); }
        }
        
        /* High Achiever Classes */
        .celebration { animation: celebration 2s ease-in-out infinite; }
        .gold-glow { animation: goldGlow 2s ease-in-out infinite; }
        .trophy-bounce { animation: trophy-bounce 2s ease-in-out infinite; }
        
        /* Confetti Container */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti 3s linear infinite;
        }
        
        .star-burst {
            position: absolute;
            font-size: 30px;
            animation: starBurst 2s ease-out infinite;
        }
        
        .firework {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: fireworks 2s ease-out infinite;
        }
        
        /* Fun Classes */
        .bounce { animation: bounce 2s infinite; }
        .wiggle { animation: wiggle 2s ease-in-out infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .pulse { animation: pulse 2s ease-in-out infinite; }
        .slide-in { animation: slideIn 0.8s ease-out; }
        .fade-in-up { animation: fadeInUp 0.6s ease-out; }
        .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
        .color-shift { animation: colorShift 4s linear infinite; }
        
        /* Rainbow Background */
        .rainbow-bg {
            background: linear-gradient(-45deg, #ff6b35, #f7931e, #ffd23f, #06d6a0, #118ab2, #073b4c, #e63946, #f77f00, #fcbf49);
            background-size: 400% 400%;
            animation: rainbow 4s ease infinite;
        }
        
        /* Magical Gradient Buttons */
        .magic-button {
            background: linear-gradient(45deg, #ff6b35, #f7931e, #06d6a0, #118ab2, #e63946, #f77f00);
            background-size: 300% 300%;
            animation: rainbow 3s ease infinite;
            border: none;
            color: white;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .magic-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 25px rgba(0,0,0,0.3);
        }
        
        /* Cute Cards */
        .cute-card {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #06d6a0 100%);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 3px solid #fff;
        }
        
        .cute-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        /* Fun Messages */
        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease-out, pulse 2s ease-in-out infinite;
            font-weight: bold;
            border: 3px solid #fff;
        }
        
        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease-out, wiggle 1s ease-in-out;
            font-weight: bold;
            border: 3px solid #fff;
        }


        
        /* Sparkle Effects */
        .sparkle-container {
            position: relative;
            overflow: hidden;
        }
        
        .sparkle-container::before,
        .sparkle-container::after {
            content: '‚ú®';
            position: absolute;
            font-size: 20px;
            animation: sparkle 2s ease-in-out infinite;
        }
        
        .sparkle-container::before {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .sparkle-container::after {
            top: 70%;
            right: 10%;
            animation-delay: 1s;
        }
        
        /* Universal Device Optimization */
        
        /* Base responsive settings */
        html {
            scroll-behavior: smooth;
        }
        
        /* Mobile-First Design (320px and up) */
        @media screen and (max-width: 767px) {
            body {
                font-size: 14px;
                line-height: 1.5;
                overflow-x: hidden;
            }
            
            /* Touch-optimized interactions */
            button, select, input, a {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Prevent zoom on form inputs */
            input, select, textarea {
                font-size: 16px !important;
                border-radius: 8px;
            }
            
            /* Mobile spacing */
            .container {
                padding: 0 12px;
            }
            
            /* Mobile text scaling */
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.25rem; }
            h3 { font-size: 1.125rem; }
            
            /* Mobile table optimization */
            .mobile-table {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border-radius: 8px;
            }
            
            .mobile-table table {
                min-width: 600px;
                font-size: 13px;
            }
            
            .mobile-table th,
            .mobile-table td {
                padding: 8px 6px;
                white-space: nowrap;
            }
            
            /* Reduce animation complexity on mobile */
            * {
                animation-duration: 0.3s !important;
                transition-duration: 0.3s !important;
            }
            
            /* Mobile-specific utilities */
            .mobile-hidden { display: none !important; }
            .mobile-block { display: block !important; }
            .mobile-flex { display: flex !important; }
        }
        
        /* Tablet Portrait (768px - 1023px) */
        @media screen and (min-width: 768px) and (max-width: 1023px) {
            body {
                font-size: 15px;
            }
            
            .container {
                padding: 0 20px;
            }
            
            /* Tablet grid layouts */
            .tablet-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            /* Tablet text scaling */
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            h3 { font-size: 1.25rem; }
        }
        
        /* Desktop and Large Screens (1024px+) */
        @media screen and (min-width: 1024px) {
            body {
                font-size: 16px;
            }
            
            .container {
                padding: 0 24px;
            }
            
            /* Desktop hover effects */
            .hover-scale:hover {
                transform: scale(1.05);
            }
            
            .hover-shadow:hover {
                box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            }
        }
        
        /* High DPI Displays */
        @media screen and (-webkit-min-device-pixel-ratio: 2),
               screen and (min-resolution: 192dpi) {
            /* Optimize for retina displays */
            .text-shadow-soft {
                text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.2);
            }
        }
        
        /* Landscape Mobile Optimization */
        @media screen and (max-height: 500px) and (orientation: landscape) {
            /* Reduce vertical spacing in landscape */
            .py-8 { padding-top: 1rem; padding-bottom: 1rem; }
            .py-6 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
            .my-8 { margin-top: 1rem; margin-bottom: 1rem; }
            .my-6 { margin-top: 0.75rem; margin-bottom: 0.75rem; }
        }
        
        /* Optimized Table Styles */
        .fun-table {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 100%;
            font-size: 14px;
            background: white;
        }
        
        .fun-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 14px;
            padding: 12px 8px;
            font-weight: 600;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .fun-table td {
            padding: 10px 8px;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f1f5f9;
            font-size: 13px;
            text-align: center;
            vertical-align: middle;
        }
        
        .fun-table tr:hover td {
            background-color: #f8fafc;
        }
        
        /* Responsive table scaling */
        @media screen and (min-width: 768px) {
            .fun-table {
                font-size: 16px;
                border-radius: 16px;
                box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            }
            
            .fun-table th {
                font-size: 16px;
                padding: 16px 12px;
            }
            
            .fun-table td {
                font-size: 15px;
                padding: 14px 12px;
            }
        }
        
        @media screen and (min-width: 1024px) {
            .fun-table {
                font-size: 18px;
                border-radius: 20px;
            }
            
            .fun-table th {
                font-size: 18px;
                padding: 20px 16px;
            }
            
            .fun-table td {
                font-size: 17px;
                padding: 18px 16px;
            }
            
            .fun-table tr:hover td {
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
        }
        
        /* Optimized Utility Classes */
        
        /* Performance-optimized animations */
        .bounce { 
            animation: bounce 2s ease-in-out infinite;
            will-change: transform;
        }
        .wiggle { 
            animation: wiggle 3s ease-in-out infinite;
            will-change: transform;
        }
        .float { 
            animation: float 4s ease-in-out infinite;
            will-change: transform;
        }
        .pulse { 
            animation: pulse 2s ease-in-out infinite;
            will-change: transform;
        }
        .slide-in { 
            animation: slideIn 0.6s ease-out;
            will-change: transform, opacity;
        }
        .fade-in-up { 
            animation: fadeInUp 0.5s ease-out;
            will-change: transform, opacity;
        }
        
        /* Optimized gradient backgrounds */
        .rainbow-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: rainbow 8s ease infinite;
        }
        
        /* Button styles */
        .magic-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .magic-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .magic-button:active {
            transform: translateY(0);
        }
        
        /* Card styles */
        .cute-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .cute-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.2);
        }
        
        /* Message styles */
        .success-message, .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .error-message {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* Marquee optimization */
        @keyframes marquee {
            0% { transform: translate3d(100%, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }
        
        .animate-marquee {
            animation: marquee 25s linear infinite;
            will-change: transform;
        }
        
        .marquee-container {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }
        
        /* Responsive marquee */
        @media screen and (max-width: 767px) {
            .animate-marquee {
                animation-duration: 20s;
            }
        }
    </style>
</head>
<body class="min-h-screen rainbow-bg">
    
    <!-- Welcome Marquee -->
    <div class="overflow-hidden border-b-4 border-yellow-400 shadow-lg" style="background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #533483); background-size: 400% 400%; animation: rainbow 4s ease infinite; padding: 12px 0;">
        <div class="marquee-container">
            <div class="marquee-text text-lg sm:text-2xl font-bold whitespace-nowrap animate-marquee text-yellow-300" style="text-shadow: 3px 3px 6px rgba(0,0,0,0.9), 0 0 30px rgba(255,215,0,0.8), 0 0 40px rgba(255,215,0,0.6); letter-spacing: 2px;">
                üöÄüë®‚Äçüíª This site is developed by Mr. Deepak Kumar Vaishy üë®‚ÄçüíªüöÄ 
                üíª‚ú® This site is developed by Mr. Deepak Kumar Vaishy ‚ú®üíª 
                üéìüåü This site is developed by Mr. Deepak Kumar Vaishy üåüüéì 
                üöÄüë®‚Äçüíª This site is developed by Mr. Deepak Kumar Vaishy üë®‚ÄçüíªüöÄ 
                üíª‚ú® This site is developed by Mr. Deepak Kumar Vaishy ‚ú®üíª 
                üéìüåü This site is developed by Mr. Deepak Kumar Vaishy üåüüéì
            </div>
        </div>
    </div>

    <!-- Celebration Effects Container for High Achievers -->
    <div id="celebrationContainer" class="confetti-container hidden"></div>

    <!-- Optimized Header -->
    <header class="text-center py-6 px-4">
        <!-- School Name Section -->
        <div class="mb-8 px-4">
            <div class="bg-white rounded-2xl shadow-lg p-6 mx-auto max-w-4xl border border-blue-200">
                <h1 class="text-2xl md:text-4xl lg:text-6xl font-heading text-blue-800 mb-4 leading-tight tracking-wider px-4" style="font-size: clamp(1.5rem, 8vw, 4rem); letter-spacing: 0.1em; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">
                    PRIMARY SCHOOL KARANPUR
                </h1>
                <div class="w-20 h-1 bg-blue-500 mx-auto rounded-full"></div>
            </div>
        </div>

        <!-- Location Info -->
        <div class="mb-6 flex flex-col sm:flex-row justify-center gap-4 px-4">
            <!-- Block Info -->
            <div class="bg-white rounded-2xl px-6 py-4 shadow-lg border-2 border-green-400 hover-scale transition-all duration-300 flex-1 max-w-sm mx-auto" style="background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%);">
                <p class="text-lg font-elegant font-bold text-center text-green-700">
                    üìç Block: Behjam üìç
                </p>
            </div>
            
            <!-- District Info -->
            <div class="bg-white rounded-2xl px-6 py-4 shadow-lg border-2 border-blue-400 hover-scale transition-all duration-300 flex-1 max-w-sm mx-auto" style="background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);">
                <p class="text-lg font-elegant font-bold text-center text-blue-700">
                    üèõÔ∏è Lakhimpur-Kheri üèõÔ∏è
                </p>
            </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="flex flex-col sm:flex-row justify-center gap-4 px-4">
            <button id="studentBtn" class="magic-button py-4 px-8 text-lg font-primary hover-shadow w-full sm:w-auto">
                ‚ú®üìä VIEW REPORT CARD üìä‚ú®
            </button>
            <button id="adminBtn" class="magic-button py-4 px-8 text-lg font-primary hover-shadow w-full sm:w-auto">
                üöÄüë®‚Äçüíº ADMIN PANEL üë®‚ÄçüíºüöÄ
            </button>
        </div>
    </header>

    <!-- Optimized Student Section -->
    <main id="studentSection" class="container mx-auto px-4 max-w-6xl mb-20">
        <!-- Student Selection Container -->
        <div class="relative overflow-hidden rainbow-bg rounded-2xl p-1 shadow-lg hover-scale transition-all duration-500">
            
            <!-- Decorative Elements -->
            <div class="absolute top-4 left-4 w-8 h-8 bg-yellow-300 rounded-full opacity-60 bounce mobile-hidden"></div>
            <div class="absolute top-6 right-6 w-6 h-6 bg-pink-300 rounded-full opacity-50 pulse mobile-hidden"></div>
            <div class="absolute bottom-4 left-6 w-10 h-10 bg-blue-300 rounded-full opacity-40 float mobile-hidden"></div>
            <div class="absolute bottom-6 right-4 w-7 h-7 bg-green-300 rounded-full opacity-45 wiggle mobile-hidden"></div>
            
            <!-- Main Content -->
            <div class="relative bg-white/95 backdrop-blur-sm rounded-xl p-6 shadow-xl">
                
                <!-- Title Section -->
                <div class="text-center mb-8">
                    <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-4 mb-4">
                        <h2 class="text-xl md:text-2xl lg:text-3xl font-display text-white mb-2">
                            üåü‚ú® SELECT STUDENT DETAILS ‚ú®üåü
                        </h2>
                        <p class="text-sm md:text-base text-white/90 font-elegant">
                            üéØ Choose Class & Student to View Report Card üéØ
                        </p>
                    </div>
                </div>
                
                <!-- Form Fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Class Selection -->
                    <div class="relative">
                        <div class="bg-gradient-to-r from-pink-400 to-purple-500 rounded-xl p-1 hover-scale transition-all duration-300">
                            <div class="bg-white rounded-lg p-4" style="background: linear-gradient(135deg, #fef7ff 0%, #f3e8ff 100%);">
                                
                                <!-- Icon -->
                                <div class="absolute -top-2 -right-2 w-10 h-10 bg-gradient-to-r from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold shadow-lg bounce">
                                    üìö
                                </div>
                                
                                <!-- Label -->
                                <label class="block text-lg font-bold mb-3 text-purple-700">
                                    üåüüìö SELECT CLASS LEVEL üìöüåü
                                </label>
                                
                                <!-- Select Field -->
                                <select id="classSelect" class="w-full p-4 text-base font-bold rounded-lg border-0 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300 cursor-pointer" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #7c3aed;">
                                    <option value="">üéØ Choose Your Class</option>
                                    <option value="1">üåü Class 1 - Foundation</option>
                                    <option value="2">üåü Class 2 - Explorer</option>
                                    <option value="3">üåü Class 3 - Achiever</option>
                                    <option value="4">üåü Class 4 - Leader</option>
                                    <option value="5">üåü Class 5 - Champion</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Selection -->
                    <div class="relative">
                        <div class="bg-gradient-to-r from-cyan-400 to-blue-500 rounded-xl p-1 hover-scale transition-all duration-300">
                            <div class="bg-white rounded-lg p-4" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
                                
                                <!-- Icon -->
                                <div class="absolute -top-2 -right-2 w-10 h-10 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-white text-lg font-bold shadow-lg bounce">
                                    üë¶
                                </div>
                                
                                <!-- Label -->
                                <label class="block text-lg font-bold mb-3 text-blue-700">
                                    ‚ú®üë¶ SELECT STUDENT NAME üë¶‚ú®
                                </label>
                                
                                <!-- Select Field -->
                                <select id="studentSelect" class="w-full p-4 text-base font-bold rounded-lg border-0 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 cursor-pointer disabled:opacity-60 disabled:cursor-not-allowed" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #1e40af;" disabled>
                                    <option value="">üéØ First select a class above</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer Message -->
                <div class="mt-8 text-center">
                    <div class="bg-gradient-to-r from-yellow-200 via-pink-200 to-purple-200 rounded-xl p-4 hover-scale transition-all duration-300">
                        <p class="text-lg font-bold text-purple-700">
                            üéâ Ready to explore your academic journey? Select your details above! üéâ
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Card Display -->
        <div id="reportCard" class="hidden mt-6">
            <!-- Report Card Container -->
            <div class="relative overflow-hidden rainbow-bg rounded-2xl p-1 shadow-lg float">
                
                <!-- Background Elements -->
                <div class="absolute inset-0 overflow-hidden rounded-xl mobile-hidden">
                    <div class="absolute top-4 left-4 w-8 h-8 bg-yellow-300 rounded-full opacity-20 pulse"></div>
                    <div class="absolute bottom-4 right-4 w-10 h-10 bg-blue-300 rounded-full opacity-15 bounce"></div>
                </div>

                <div class="relative bg-white rounded-xl p-4 shadow-xl">
                    
                    <!-- Header -->
                    <div class="text-center mb-6">
                        <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-4 mb-4">
                            <h2 class="text-xl md:text-2xl font-display text-white mb-2">
                                üèÜ‚ú® REPORT CARD ‚ú®üèÜ
                            </h2>
                            <p class="text-sm md:text-base text-white/90 font-elegant">
                                üåü Academic Excellence Report üåü
                            </p>
                        </div>
                    </div>
                    
                    <!-- Student Info Cards -->
                    <div id="studentInfo" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <!-- Student info will be populated here -->
                    </div>
                    
                    <!-- Marks Table -->
                    <div class="mb-6">
                        <div class="text-center mb-4">
                            <h3 class="text-lg md:text-xl font-heading text-purple-700 mb-2">
                                üìö‚ú® SUBJECT PERFORMANCE ‚ú®üìö
                            </h3>
                            <div class="w-20 h-1 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto rounded-full"></div>
                        </div>
                        
                        <div class="mobile-table overflow-x-auto rounded-xl shadow-lg bg-gradient-to-r from-purple-600 to-pink-600 p-1">
                            <div class="bg-white rounded-lg overflow-hidden">
                                <table class="fun-table w-full">
                                    <thead>
                                        <tr>
                                            <th>üìñ SUBJECT</th>
                                            <th>üìù GOT</th>
                                            <th>üéØ MAX</th>
                                            <th>üìä %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="marksTable">
                                        <!-- Marks will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="mb-6">
                        <div class="text-center mb-4">
                            <h3 class="text-lg md:text-xl font-heading text-green-700 mb-2">
                                üìäüèÜ OVERALL RESULT üèÜüìä
                            </h3>
                            <div class="w-24 h-1 bg-gradient-to-r from-green-500 to-blue-500 mx-auto rounded-full"></div>
                        </div>
                        
                        <div id="summary" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <!-- Summary will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Inspirational Quote -->
                    <div class="bg-gradient-to-r from-orange-200 to-pink-200 rounded-xl p-1 shadow-lg">
                        <div id="inspirationalQuote" class="bg-white rounded-lg p-4 text-center shadow-inner">
                            <!-- Quote will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Optimized Admin Section -->
    <section id="adminSection" class="hidden container mx-auto px-4 max-w-6xl mb-20">
        <!-- Admin Login -->
        <div id="adminLogin" class="cute-card p-6 mx-auto max-w-md">
            <h2 class="text-xl md:text-2xl font-heading text-center text-white mb-6">
                üîê‚ú® Admin Access ‚ú®üîê
            </h2>
            <div class="mb-6">
                <label class="block text-base font-bold text-white mb-2">üîë Password</label>
                <input type="password" id="adminPassword" class="w-full p-4 border-2 border-white rounded-xl text-base focus:border-yellow-300 focus:outline-none transition-all duration-300" placeholder="‚ú® Enter admin password" style="background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);">
            </div>
            <button id="loginBtn" class="w-full magic-button py-4 px-6 rounded-xl text-lg font-bold">
                üöÄ‚ú® Login ‚ú®üöÄ
            </button>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <div class="cute-card p-4 sm:p-8 sparkle-container">
                <h2 class="text-2xl sm:text-4xl font-bold text-center text-white mb-4 sm:mb-8 bounce color-shift">üë®‚Äçüíº‚ú® Admin Dashboard ‚ú®üë®‚Äçüíº</h2>
                
                <!-- Student Management -->
                <div class="bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-4 sm:p-8 rounded-3xl shadow-lg mb-4 sm:mb-8 border-4 border-white sparkle-container">
                    <h3 class="text-xl sm:text-3xl font-bold text-purple-800 mb-4 sm:mb-6 text-center wiggle">üéì‚ú® Student & Marks Management ‚ú®üéì</h3>
                    
                    <!-- Class Selection -->
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">üìö Select Class</label>
                        <select id="adminClassSelect" class="w-full p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none">
                            <option value="">Choose Class</option>
                            <option value="1">Class 1</option>
                            <option value="2">Class 2</option>
                            <option value="3">Class 3</option>
                            <option value="4">Class 4</option>
                            <option value="5">Class 5</option>
                        </select>
                    </div>

                    <!-- Student Selection/Creation -->
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">üë¶ Student</label>
                        <div class="flex flex-col sm:flex-row gap-3 mb-3">
                            <select id="adminStudentSelect" class="flex-1 p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <option value="">First select a class</option>
                                <option value="new">‚ûï Add New Student</option>
                            </select>
                            <button id="deleteStudentBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-xl transform hover:scale-105 transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base" disabled>
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>

                    <!-- Student Details Form -->
                    <div id="studentForm" class="mb-4 sm:mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4">
                            <div>
                                <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">üë¶ Student Name</label>
                                <input type="text" id="studentName" placeholder="First select a class to enable editing" class="w-full p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-100" disabled>
                            </div>
                            <div>
                                <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">üë® Father's Name</label>
                                <input type="text" id="fatherName" placeholder="First select a class to enable editing" class="w-full p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-100" disabled>
                            </div>
                        </div>
                    </div>

                    <!-- Subjects and Marks -->
                    <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-inner mb-4 sm:mb-6">
                        <h4 class="text-lg sm:text-2xl font-bold text-purple-700 text-center mb-3 sm:mb-4">üìñ Subjects & Marks</h4>
                        
                        <div id="subjectsContainer" class="disabled:opacity-50 disabled:pointer-events-none">
                            <!-- Subject rows will be added here -->
                        </div>
                        
                        <div class="text-center mt-3 sm:mt-4">
                            <button id="addSubjectBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 sm:py-3 px-4 sm:px-6 rounded-full transform hover:scale-105 transition-all duration-300 text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400" disabled>
                                ‚ûï Add Subject
                            </button>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button id="saveStudentBtn" class="w-full magic-button py-4 sm:py-6 px-6 sm:px-8 rounded-2xl text-lg sm:text-2xl font-bold bounce disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400" disabled>
                        ‚ú®üåü Save Student & Marks üåü‚ú®
                    </button>
                    
                    <!-- Debug Database Button -->
                    <div class="mt-4 text-center">
                        <button id="fetchDatabaseBtn" class="bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-3 px-6 rounded-xl transform hover:scale-105 transition-all duration-300 shadow-lg">
                            üîçüìä Fetch All Database Data üìäüîç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXcBGbfxZ0kU0vqbZvsB_eD7nRBdmRAVI",
            authDomain: "deeapk1281.firebaseapp.com",
            databaseURL: "https://deeapk1281-default-rtdb.firebaseio.com",
            projectId: "deeapk1281",
            storageBucket: "deeapk1281.appspot.com",
            messagingSenderId: ".",
            appId: "1:.:web:c60b948ecacf60888a356b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Configuration
        const ADMIN_PASSWORD = "admin123";
        let currentStudentId = null;
        let subjectCount = 0;

        // Sample Data for Recovery
        const sampleData = {
            students: {
                class1: {
                    "alice_johnson_1": { name: "Alice Johnson", fatherName: "Robert Johnson" },
                    "bob_smith_1": { name: "Bob Smith", fatherName: "Michael Smith" },
                    "charlie_brown_1": { name: "Charlie Brown", fatherName: "David Brown" }
                },
                class2: {
                    "diana_wilson_2": { name: "Diana Wilson", fatherName: "James Wilson" },
                    "edward_davis_2": { name: "Edward Davis", fatherName: "William Davis" },
                    "fiona_miller_2": { name: "Fiona Miller", fatherName: "Thomas Miller" }
                },
                class3: {
                    "george_taylor_3": { name: "George Taylor", fatherName: "Richard Taylor" },
                    "helen_anderson_3": { name: "Helen Anderson", fatherName: "Charles Anderson" },
                    "ivan_thomas_3": { name: "Ivan Thomas", fatherName: "Joseph Thomas" }
                }
            },
            marks: {
                class1: {
                    "alice_johnson_1": {
                        "Mathematics": { obtained: 9, maximum: 10 },
                        "English": { obtained: 8, maximum: 10 },
                        "Science": { obtained: 9, maximum: 10 },
                        "Social Studies": { obtained: 8, maximum: 10 }
                    },
                    "bob_smith_1": {
                        "Mathematics": { obtained: 7, maximum: 10 },
                        "English": { obtained: 8, maximum: 10 },
                        "Science": { obtained: 7, maximum: 10 },
                        "Social Studies": { obtained: 8, maximum: 10 }
                    },
                    "charlie_brown_1": {
                        "Mathematics": { obtained: 6, maximum: 10 },
                        "English": { obtained: "Absent", maximum: 10 },
                        "Science": { obtained: 6, maximum: 10 },
                        "Social Studies": { obtained: 7, maximum: 10 }
                    }
                },
                class2: {
                    "diana_wilson_2": {
                        "Mathematics": { obtained: 9, maximum: 10 },
                        "English": { obtained: 9, maximum: 10 },
                        "Science": { obtained: 8, maximum: 10 },
                        "Social Studies": { obtained: 9, maximum: 10 },
                        "Art": { obtained: 9, maximum: 10 }
                    },
                    "edward_davis_2": {
                        "Mathematics": { obtained: 7, maximum: 10 },
                        "English": { obtained: 7, maximum: 10 },
                        "Science": { obtained: 7, maximum: 10 },
                        "Social Studies": { obtained: 7, maximum: 10 },
                        "Art": { obtained: 8, maximum: 10 }
                    },
                    "fiona_miller_2": {
                        "Mathematics": { obtained: 8, maximum: 10 },
                        "English": { obtained: 8, maximum: 10 },
                        "Science": { obtained: 8, maximum: 10 },
                        "Social Studies": { obtained: 8, maximum: 10 },
                        "Art": { obtained: 9, maximum: 10 }
                    }
                },
                class3: {
                    "george_taylor_3": {
                        "Mathematics": { obtained: 8, maximum: 10 },
                        "English": { obtained: 8, maximum: 10 },
                        "Science": { obtained: 9, maximum: 10 },
                        "Social Studies": { obtained: 8, maximum: 10 },
                        "Computer": { obtained: 9, maximum: 10 }
                    },
                    "helen_anderson_3": {
                        "Mathematics": { obtained: 9, maximum: 10 },
                        "English": { obtained: 8, maximum: 10 },
                        "Science": { obtained: 9, maximum: 10 },
                        "Social Studies": { obtained: 9, maximum: 10 },
                        "Computer": { obtained: 8, maximum: 10 }
                    },
                    "ivan_thomas_3": {
                        "Mathematics": { obtained: 7, maximum: 10 },
                        "English": { obtained: 7, maximum: 10 },
                        "Science": { obtained: 7, maximum: 10 },
                        "Social Studies": { obtained: 7, maximum: 10 },
                        "Computer": { obtained: 8, maximum: 10 }
                    }
                }
            }
        };

        // DOM Elements
        const elements = {
            // Navigation
            studentBtn: document.getElementById('studentBtn'),
            adminBtn: document.getElementById('adminBtn'),
            studentSection: document.getElementById('studentSection'),
            adminSection: document.getElementById('adminSection'),

            
            // Student View
            classSelect: document.getElementById('classSelect'),
            studentSelect: document.getElementById('studentSelect'),
            reportCard: document.getElementById('reportCard'),
            studentInfo: document.getElementById('studentInfo'),
            marksTable: document.getElementById('marksTable'),
            summary: document.getElementById('summary'),
            inspirationalQuote: document.getElementById('inspirationalQuote'),
            
            // Admin
            adminLogin: document.getElementById('adminLogin'),
            adminDashboard: document.getElementById('adminDashboard'),
            adminPassword: document.getElementById('adminPassword'),
            loginBtn: document.getElementById('loginBtn'),
            adminClassSelect: document.getElementById('adminClassSelect'),
            adminStudentSelect: document.getElementById('adminStudentSelect'),
            deleteStudentBtn: document.getElementById('deleteStudentBtn'),
            studentForm: document.getElementById('studentForm'),
            studentName: document.getElementById('studentName'),
            fatherName: document.getElementById('fatherName'),
            subjectsContainer: document.getElementById('subjectsContainer'),
            addSubjectBtn: document.getElementById('addSubjectBtn'),
            saveStudentBtn: document.getElementById('saveStudentBtn'),
            fetchDatabaseBtn: document.getElementById('fetchDatabaseBtn')
        };

        // Utility Functions
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            if (type === 'success') {
                messageDiv.className = 'success-message';
            } else if (type === 'info') {
                messageDiv.className = 'fixed top-20 right-20 bg-gradient-to-r from-blue-500 to-cyan-500 text-white padding-15px-20px rounded-20px box-shadow-0-8px-25px-rgba(0,0,0,0.2) z-index-1000 animation-slideIn-0.5s-ease-out font-weight-bold border-3px-solid-white';
                messageDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: linear-gradient(45deg, #3b82f6, #06b6d4); color: white; padding: 15px 20px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); z-index: 1000; animation: slideIn 0.5s ease-out; font-weight: bold; border: 3px solid white;';
            } else {
                messageDiv.className = 'error-message';
            }
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function generateStudentId(name) {
            return name.toLowerCase().replace(/\s+/g, '_') + '_' + Date.now();
        }

        function calculateGrade(percentage) {
            if (percentage >= 90) return 'A+';
            if (percentage >= 80) return 'A';
            if (percentage >= 70) return 'B';
            if (percentage >= 60) return 'C';
            if (percentage >= 50) return 'D';
            return 'F';
        }

        // Celebration Functions for High Achievers (85%+)
        function createCelebrationEffects() {
            const container = document.getElementById('celebrationContainer');
            container.classList.remove('hidden');
            container.innerHTML = '';

            // Create confetti pieces
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'][Math.floor(Math.random() * 6)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
            }

            // Create star bursts
            for (let i = 0; i < 10; i++) {
                const star = document.createElement('div');
                star.className = 'star-burst';
                star.innerHTML = '‚≠ê';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }

            // Create fireworks
            for (let i = 0; i < 8; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = Math.random() * 100 + '%';
                firework.style.top = Math.random() * 50 + '%';
                firework.style.backgroundColor = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1'][Math.floor(Math.random() * 4)];
                firework.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(firework);
            }

            // Create shower effect (water drops)
            for (let i = 0; i < 30; i++) {
                const drop = document.createElement('div');
                drop.className = 'shower-drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDelay = Math.random() * 2 + 's';
                drop.style.animationDuration = (Math.random() * 1 + 1.5) + 's';
                container.appendChild(drop);
            }

            // Hide celebration after 10 seconds
            setTimeout(() => {
                container.classList.add('hidden');
            }, 10000);
        }

        function applyCelebrationStyles(percentage) {
            const reportCard = document.getElementById('reportCard');
            const studentInfo = document.getElementById('studentInfo');
            const summary = document.getElementById('summary');
            const inspirationalQuote = document.getElementById('inspirationalQuote');

            if (percentage >= 85) {
                // Add special celebration classes
                reportCard.classList.add('gold-glow');
                studentInfo.classList.add('celebration');
                summary.classList.add('trophy-bounce');
                inspirationalQuote.classList.add('celebration');
                
                // Create celebration effects
                createCelebrationEffects();
                
                // Add special trophy and crown emojis
                const reportCardTitle = reportCard.querySelector('h2');
                if (reportCardTitle && !reportCardTitle.innerHTML.includes('üëë')) {
                    reportCardTitle.innerHTML = 'üëëüèÜ EXCELLENT REPORT CARD üèÜüëë';
                }
            } else {
                // Remove celebration classes if percentage is below 85%
                reportCard.classList.remove('gold-glow');
                studentInfo.classList.remove('celebration');
                summary.classList.remove('trophy-bounce');
                inspirationalQuote.classList.remove('celebration');
                
                // Reset title
                const reportCardTitle = reportCard.querySelector('h2');
                if (reportCardTitle) {
                    reportCardTitle.innerHTML = 'üéâ‚ú® REPORT CARD ‚ú®üéâ';
                }
            }
        }

        // Inspirational Quotes based on exact percentage performance
        function getInspirationalQuote(percentage, rank) {
            let quote, emoji;
            
            // Specific quotes based on exact percentage ranges
            if (percentage >= 98) {
                quote = `Outstanding! With ${percentage}% you've achieved near perfection! You're truly exceptional!`;
                emoji = "üëë";
            } else if (percentage >= 95) {
                quote = `Brilliant! Scoring ${percentage}% shows your incredible dedication and talent!`;
                emoji = "üèÜ";
            } else if (percentage >= 90) {
                quote = `Excellent work! Your ${percentage}% score reflects outstanding academic performance!`;
                emoji = "‚≠ê";
            } else if (percentage >= 85) {
                quote = `Great job! With ${percentage}%, you've demonstrated strong understanding and effort!`;
                emoji = "üåü";
            } else if (percentage >= 80) {
                quote = `Well done! Your ${percentage}% shows good academic progress and commitment!`;
                emoji = "‚ú®";
            } else if (percentage >= 75) {
                quote = `Good work! Scoring ${percentage}% indicates you're on the right learning path!`;
                emoji = "üéØ";
            } else if (percentage >= 70) {
                quote = `Nice effort! Your ${percentage}% shows steady improvement in your studies!`;
                emoji = "üí™";
            } else if (percentage >= 65) {
                quote = `Keep going! With ${percentage}%, you're making consistent academic progress!`;
                emoji = "üöÄ";
            } else if (percentage >= 60) {
                quote = `Stay positive! Your ${percentage}% shows you're learning and developing skills!`;
                emoji = "‚ù§Ô∏è";
            } else if (percentage >= 55) {
                quote = `Don't give up! At ${percentage}%, you have room to grow and improve further!`;
                emoji = "üå±";
            } else if (percentage >= 50) {
                quote = `Keep trying! Your ${percentage}% is a starting point for greater achievements!`;
                emoji = "üìà";
            } else if (percentage >= 40) {
                quote = `Stay strong! With ${percentage}%, focus on building stronger study habits!`;
                emoji = "üåà";
            } else if (percentage >= 30) {
                quote = `Never give up! At ${percentage}%, every small step forward counts!`;
                emoji = "üí´";
            } else {
                quote = `Believe in yourself! Your ${percentage}% shows you need extra support and practice!`;
                emoji = "ü¶Å";
            }

            return {
                quote: quote,
                emoji: emoji
            };
        }

        // Restore Sample Data Function
        async function restoreSampleData() {
            try {
                // Add sample students
                await db.ref('students').set(sampleData.students);
                
                // Add sample marks
                await db.ref('marks').set(sampleData.marks);
                
                console.log('Sample data restored successfully');
                
            } catch (error) {
                console.error('Error restoring sample data:', error);
            }
        }

        // Navigation - Desktop and Mobile
        function showStudentSection() {
            elements.studentSection.classList.remove('hidden');
            elements.adminSection.classList.add('hidden');
            elements.reportCard.classList.add('hidden');
        }

        function showAdminSection() {
            elements.adminSection.classList.remove('hidden');
            elements.studentSection.classList.add('hidden');
            elements.reportCard.classList.add('hidden');
            // Always show login first and hide dashboard
            elements.adminLogin.classList.remove('hidden');
            elements.adminDashboard.classList.add('hidden');
            // Clear password field
            elements.adminPassword.value = '';
        }

        // Desktop Navigation
        elements.studentBtn.addEventListener('click', showStudentSection);
        elements.adminBtn.addEventListener('click', showAdminSection);

        // Admin Login
        elements.loginBtn.addEventListener('click', () => {
            const password = elements.adminPassword.value.trim();
            console.log('Login attempt with password:', password);
            
            if (password === ADMIN_PASSWORD) {
                console.log('Password correct, showing admin dashboard');
                elements.adminLogin.classList.add('hidden');
                elements.adminDashboard.classList.remove('hidden');
                showMessage('‚úÖ Welcome Admin! Dashboard loaded successfully!');
                
                // Clear the password field
                elements.adminPassword.value = '';
                
                // Initialize admin dashboard
                initializeAdminDashboard();
            } else {
                console.log('Password incorrect');
                showMessage('‚ùå Incorrect password! Please try again.', 'error');
                elements.adminPassword.value = '';
                elements.adminPassword.focus();
            }
        });

        // Allow Enter key to login
        elements.adminPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                elements.loginBtn.click();
            }
        });

        // Student View - Class Selection
        elements.classSelect.addEventListener('change', async () => {
            const classNum = elements.classSelect.value;
            elements.studentSelect.innerHTML = '<option value="">Select Student</option>';
            elements.studentSelect.disabled = true;
            elements.reportCard.classList.add('hidden');

            if (classNum) {
                try {
                    const snapshot = await db.ref(`students/class${classNum}`).once('value');
                    const students = snapshot.val();
                    
                    if (students) {
                        elements.studentSelect.disabled = false;
                        Object.keys(students).forEach(studentId => {
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = students[studentId].name;
                            elements.studentSelect.appendChild(option);
                        });
                    } else {
                        elements.studentSelect.innerHTML = '<option value="">No students found</option>';
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                    showMessage('‚ùå Error loading students', 'error');
                }
            }
        });

        // Student View - Student Selection
        elements.studentSelect.addEventListener('change', async () => {
            const classNum = elements.classSelect.value;
            const studentId = elements.studentSelect.value;
            
            if (classNum && studentId) {
                await displayReportCard(classNum, studentId);
            } else {
                elements.reportCard.classList.add('hidden');
            }
        });

        // Display Report Card Function
        async function displayReportCard(classNum, studentId) {
            // Show report card immediately
            elements.reportCard.classList.remove('hidden');
            
            try {
                const [studentSnapshot, marksSnapshot] = await Promise.all([
                    db.ref(`students/class${classNum}/${studentId}`).once('value'),
                    db.ref(`marks/class${classNum}/${studentId}`).once('value')
                ]);
                
                const studentData = studentSnapshot.val();
                const marksData = marksSnapshot.val();

                if (!studentData) {
                    showMessage('‚ùå Student data not found!', 'error');
                    elements.reportCard.classList.add('hidden');
                    return;
                }

                // Display student info with limited animations (5 seconds only)
                elements.studentInfo.innerHTML = `
                    <div class="relative overflow-hidden rounded-2xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); padding: 3px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); animation: slideIn 0.8s ease-out;">
                        <div class="bg-white rounded-xl p-3 sm:p-4 text-center relative z-10">
                            <div class="absolute top-1 right-1 text-lg report-card-bounce">üë¶</div>
                            <h3 class="text-sm sm:text-lg font-bold text-orange-700 mb-2 report-card-wiggle">‚ú® STUDENT NAME ‚ú®</h3>
                            <p class="text-xs sm:text-base font-bold text-orange-800 bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">${studentData.name}</p>
                        </div>
                        <div class="absolute -top-1 -left-1 w-4 h-4 bg-yellow-300 rounded-full opacity-60 report-card-pulse"></div>
                    </div>
                    <div class="relative overflow-hidden rounded-2xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%); padding: 3px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.2s;">
                        <div class="bg-white rounded-xl p-3 sm:p-4 text-center relative z-10">
                            <div class="absolute top-1 right-1 text-lg report-card-bounce" style="animation-delay: 0.5s;">üë®</div>
                            <h3 class="text-sm sm:text-lg font-bold text-green-700 mb-2 report-card-pulse">üíö FATHER'S NAME üíö</h3>
                            <p class="text-xs sm:text-base font-bold text-green-800 bg-gradient-to-r from-green-500 to-teal-500 bg-clip-text text-transparent">${studentData.fatherName}</p>
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-300 rounded-full opacity-60 report-card-bounce"></div>
                    </div>
                    <div class="relative overflow-hidden rounded-2xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); padding: 3px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.4s;">
                        <div class="bg-white rounded-xl p-3 sm:p-4 text-center relative z-10">
                            <div class="absolute top-1 right-1 text-lg report-card-bounce" style="animation-delay: 1s;">üìö</div>
                            <h3 class="text-sm sm:text-lg font-bold text-blue-700 mb-2 report-card-float">üíô CLASS LEVEL üíô</h3>
                            <p class="text-xs sm:text-base font-bold text-blue-800 bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">Class ${classNum}</p>
                        </div>
                        <div class="absolute -top-1 -right-1 w-5 h-5 bg-blue-300 rounded-full opacity-60 report-card-float"></div>
                    </div>
                `;

                // Display enhanced marks table with animations
                let totalObtained = 0;
                let totalMaximum = 0;
                let tableHTML = '';

                if (marksData) {
                    // Define the correct order: Hindi, English, Mathematics first, then others
                    const subjectOrder = ['Hindi', 'English', 'Mathematics'];
                    const orderedSubjects = [];
                    
                    // First add subjects in the specified order
                    subjectOrder.forEach(subject => {
                        if (marksData[subject]) {
                            orderedSubjects.push(subject);
                        }
                    });
                    
                    // Then add any remaining subjects
                    Object.keys(marksData).forEach(subject => {
                        if (!subjectOrder.includes(subject)) {
                            orderedSubjects.push(subject);
                        }
                    });

                    orderedSubjects.forEach((subject, index) => {
                        const marks = marksData[subject];
                        let percentage, grade, obtainedDisplay;
                        
                        // Handle absent students
                        if (marks.obtained === 'Absent') {
                            percentage = 0;
                            grade = 'Absent';
                            obtainedDisplay = 'Absent';
                            // Don't add to total for absent subjects
                        } else {
                            percentage = ((marks.obtained / marks.maximum) * 100).toFixed(1);
                            grade = calculateGrade(percentage);
                            obtainedDisplay = marks.obtained;
                            totalObtained += marks.obtained;
                        }
                        totalMaximum += marks.maximum;

                        // Enhanced row styling with gradients and animations
                        const rowGradient = index % 4 === 0 ? 'from-pink-50 to-rose-100' : 
                                          index % 4 === 1 ? 'from-blue-50 to-indigo-100' : 
                                          index % 4 === 2 ? 'from-green-50 to-emerald-100' : 
                                          'from-yellow-50 to-amber-100';
                        
                        const gradeColor = marks.obtained === 'Absent' ? 'text-gray-600 font-extrabold' :
                                         percentage >= 90 ? 'text-green-600 font-extrabold' : 
                                         percentage >= 80 ? 'text-blue-600 font-extrabold' : 
                                         percentage >= 70 ? 'text-yellow-600 font-extrabold' : 
                                         percentage >= 60 ? 'text-orange-600 font-extrabold' : 
                                         'text-red-600 font-extrabold';
                        
                        const gradeEmoji = marks.obtained === 'Absent' ? '‚ùå' :
                                         percentage >= 90 ? 'üèÜ' : 
                                         percentage >= 80 ? 'ü•á' : 
                                         percentage >= 70 ? 'ü•à' : 
                                         percentage >= 60 ? 'ü•â' : 'üìö';
                        
                        const animationDelay = index * 0.1;
                        
                        tableHTML += `
                            <tr class="bg-gradient-to-r ${rowGradient} hover:scale-102 transition-all duration-300 border-b-1 sm:border-b-2 border-white mobile-animate" style="animation: fadeInUp 0.6s ease-out; animation-delay: ${animationDelay}s; animation-fill-mode: both;">
                                <td class="text-purple-800 relative">
                                    <div class="flex items-center justify-center">
                                        <span class="mr-1 text-lg sm:text-2xl report-card-bounce" style="animation-delay: ${animationDelay + 0.5}s;">üìñ</span>
                                        <span class="text-base sm:text-lg md:text-xl font-bold">${subject}</span>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="${marks.obtained === 'Absent' ? 'bg-gradient-to-r from-gray-500 to-gray-600' : 'bg-gradient-to-r from-blue-500 to-indigo-500'} text-white px-3 py-2 rounded-full inline-block transform hover:scale-110 transition-all duration-300 text-base sm:text-lg md:text-xl font-bold mobile-animate report-card-pulse" style="animation-delay: ${animationDelay + 0.2}s;">
                                        ${obtainedDisplay}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-3 py-2 rounded-full inline-block transform hover:scale-110 transition-all duration-300 text-base sm:text-lg md:text-xl font-bold mobile-animate report-card-pulse" style="animation-delay: ${animationDelay + 0.4}s;">
                                        ${marks.maximum}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="${marks.obtained === 'Absent' ? 'bg-gradient-to-r from-gray-500 to-gray-600' : 'bg-gradient-to-r from-purple-500 to-pink-500'} text-white px-3 py-2 rounded-full inline-block transform hover:scale-110 transition-all duration-300 text-base sm:text-lg md:text-xl font-bold mobile-animate report-card-wiggle" style="animation-delay: ${animationDelay + 0.6}s;">
                                        ${marks.obtained === 'Absent' ? 'Absent' : percentage + '%'}
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                } else {
                    tableHTML = '<tr><td colspan="4" class="py-8 text-center text-gray-500 text-lg">üìö No marks data available üìö</td></tr>';
                }

                elements.marksTable.innerHTML = tableHTML;

                // Calculate overall performance
                const overallPercentage = totalMaximum > 0 ? ((totalObtained / totalMaximum) * 100).toFixed(1) : 0;
                const overallGrade = calculateGrade(overallPercentage);
                const rank = await calculateRank(classNum, parseFloat(overallPercentage));

                // Display enhanced summary with spectacular animations
                const performanceLevel = overallPercentage >= 90 ? 'outstanding' : 
                                       overallPercentage >= 80 ? 'excellent' : 
                                       overallPercentage >= 70 ? 'good' : 
                                       overallPercentage >= 60 ? 'satisfactory' : 'needsImprovement';
                
                const performanceEmoji = overallPercentage >= 90 ? 'üèÜüëë' : 
                                       overallPercentage >= 80 ? 'ü•á‚≠ê' : 
                                       overallPercentage >= 70 ? 'ü•àüí´' : 
                                       overallPercentage >= 60 ? 'ü•â‚ú®' : 'üìöüí™';
                
                const rankEmoji = rank === 1 ? 'üëëüèÜ' : rank <= 3 ? 'ü•á‚≠ê' : rank <= 5 ? 'ü•àüí´' : 'ü•â‚ú®';
                
                elements.summary.innerHTML = `
                    <div class="relative overflow-hidden rounded-2xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 50%, #fd79a8 100%); padding: 3px; box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 0 2px rgba(255,255,255,0.2); animation: slideIn 0.8s ease-out;">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-1 left-1 text-lg report-card-bounce">üìä</div>
                        <div class="absolute top-1 right-1 text-sm report-card-bounce" style="animation-delay: 0.5s;">‚ú®</div>
                        <div class="absolute bottom-1 left-1 text-sm report-card-bounce" style="animation-delay: 1s;">üíØ</div>
                        
                        <div class="bg-white rounded-xl p-3 sm:p-4 text-center relative z-10 shadow-inner">
                            <div class="mb-2">
                                <div class="text-xl sm:text-2xl mb-1 report-card-bounce">üìä‚ú®</div>
                                <h3 class="text-sm sm:text-lg font-bold text-orange-700 mb-2 report-card-wiggle">TOTAL MARKS</h3>
                            </div>
                            <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-3 py-2 rounded-xl transform hover:scale-105 transition-all duration-300 report-card-pulse">
                                <p class="text-lg sm:text-2xl font-extrabold">${totalObtained}/${totalMaximum}</p>
                            </div>
                        </div>
                        
                        <!-- Decorative circles -->
                        <div class="absolute -top-1 -left-1 w-6 h-6 bg-yellow-300 rounded-full opacity-40 report-card-pulse"></div>
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-pink-300 rounded-full opacity-40 report-card-float"></div>
                    </div>
                    
                    <div class="relative overflow-hidden rounded-2xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 50%, #52c41a 100%); padding: 3px; box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 0 2px rgba(255,255,255,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.2s;">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-1 left-1 text-lg report-card-bounce" style="animation-delay: 0.3s;">üìà</div>
                        <div class="absolute top-1 right-1 text-sm report-card-bounce" style="animation-delay: 0.8s;">üåü</div>
                        <div class="absolute bottom-1 right-1 text-sm report-card-bounce" style="animation-delay: 1.3s;">üíö</div>
                        
                        <div class="bg-white rounded-xl p-3 sm:p-4 text-center relative z-10 shadow-inner">
                            <div class="mb-2">
                                <div class="text-xl sm:text-2xl mb-1 report-card-bounce" style="animation-delay: 0.5s;">${performanceEmoji}</div>
                                <h3 class="text-sm sm:text-lg font-bold text-green-700 mb-2 report-card-pulse">PERCENTAGE</h3>
                            </div>
                            <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-3 py-2 rounded-xl transform hover:scale-105 transition-all duration-300 ${overallPercentage >= 85 ? 'gold-glow' : ''} ${overallPercentage >= 85 ? 'celebration' : 'report-card-wiggle'}">
                                <p class="text-lg sm:text-2xl font-extrabold">${overallPercentage}%</p>
                                <p class="text-xs sm:text-sm font-bold mt-1 capitalize">${performanceLevel}</p>
                            </div>
                        </div>
                        
                        <!-- Decorative circles -->
                        <div class="absolute -top-1 -right-1 w-5 h-5 bg-green-300 rounded-full opacity-40 report-card-float"></div>
                        <div class="absolute -bottom-1 -left-1 w-3 h-3 bg-teal-300 rounded-full opacity-40 report-card-bounce"></div>
                    </div>
                    
                    <div class="relative overflow-hidden rounded-2xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%); padding: 3px; box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 0 2px rgba(255,255,255,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.4s;">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-1 left-1 text-lg report-card-bounce" style="animation-delay: 0.6s;">ü•á</div>
                        <div class="absolute top-1 right-1 text-sm report-card-bounce" style="animation-delay: 1.1s;">üí´</div>
                        <div class="absolute bottom-1 left-1 text-sm report-card-bounce" style="animation-delay: 1.6s;">üéØ</div>
                        
                        <div class="bg-white rounded-xl p-3 sm:p-4 text-center relative z-10 shadow-inner">
                            <div class="mb-2">
                                <div class="text-xl sm:text-2xl mb-1 report-card-bounce" style="animation-delay: 0.7s;">${rankEmoji}</div>
                                <h3 class="text-sm sm:text-lg font-bold text-blue-700 mb-2 report-card-float">CLASS RANK</h3>
                            </div>
                            <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-2 rounded-xl transform hover:scale-105 transition-all duration-300 ${rank <= 3 ? 'trophy-bounce' : ''} ${rank <= 3 ? 'celebration' : 'report-card-pulse'}">
                                <p class="text-lg sm:text-2xl font-extrabold">#${rank}</p>
                                <p class="text-xs sm:text-sm font-bold mt-1">${rank === 1 ? 'First Place!' : rank <= 3 ? 'Top 3!' : rank <= 5 ? 'Top 5!' : 'Keep Going!'}</p>
                            </div>
                        </div>
                        
                        <!-- Decorative circles -->
                        <div class="absolute -top-1 -left-1 w-4 h-4 bg-blue-300 rounded-full opacity-40 report-card-pulse"></div>
                        <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-purple-300 rounded-full opacity-40 report-card-float"></div>
                    </div>
                `;

                // Display simplified inspirational quote with only highlighted text
                const inspirationalQuote = getInspirationalQuote(parseFloat(overallPercentage), rank);
                document.getElementById('inspirationalQuote').innerHTML = `
                    <div class="mb-2 relative">
                        <!-- Static Title -->
                        <div class="text-center relative">
                            <h3 class="relative text-sm sm:text-lg font-bold mb-2" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                ${inspirationalQuote.emoji} WORDS OF INSPIRATION ${inspirationalQuote.emoji}
                            </h3>
                        </div>
                    </div>
                    
                    <!-- Simplified Quote Container -->
                    <div class="relative overflow-hidden rounded-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2px;">
                        
                        <!-- Main Quote Content -->
                        <div class="bg-white rounded-md p-3 sm:p-4 shadow-lg relative z-10">
                            
                            <!-- Only the Main Highlighted Text -->
                            <div class="text-center">
                                <div class="text-xl sm:text-2xl mb-2">${inspirationalQuote.emoji}</div>
                                
                                <!-- Main Inspirational Quote - Larger Font -->
                                <p class="text-base sm:text-lg md:text-xl font-bold leading-relaxed" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1.4;">
                                    ${inspirationalQuote.quote}
                                </p>
                            </div>
                        </div>
                    </div>
                `;

                // Apply celebration effects for high achievers (85%+)
                applyCelebrationStyles(parseFloat(overallPercentage));

                // Report card already shown above

            } catch (error) {
                console.error('Error displaying report card:', error);
                showMessage('‚ùå Error loading report card!', 'error');
            }
        }

        // Calculate Rank
        async function calculateRank(classNum, currentPercentage) {
            try {
                const studentsSnapshot = await db.ref(`students/class${classNum}`).once('value');
                const students = studentsSnapshot.val();
                
                if (!students) return 1;

                const studentPercentages = [];
                
                // Calculate percentage for each student in the class
                for (const studentId of Object.keys(students)) {
                    const marksSnapshot = await db.ref(`marks/class${classNum}/${studentId}`).once('value');
                    const marksData = marksSnapshot.val();
                    
                    if (marksData) {
                        let totalObtained = 0;
                        let totalMaximum = 0;
                        
                        Object.values(marksData).forEach(marks => {
                            if (marks.obtained !== 'Absent') {
                                totalObtained += marks.obtained;
                            }
                            totalMaximum += marks.maximum;
                        });
                        
                        const studentPercentage = totalMaximum > 0 ? (totalObtained / totalMaximum) * 100 : 0;
                        studentPercentages.push({
                            studentId: studentId,
                            percentage: studentPercentage
                        });
                    }
                }
                
                // Sort students by percentage in descending order (highest first)
                studentPercentages.sort((a, b) => b.percentage - a.percentage);
                
                // Find rank based on percentage
                let rank = 1;
                for (let i = 0; i < studentPercentages.length; i++) {
                    if (studentPercentages[i].percentage > currentPercentage) {
                        rank = i + 2; // +2 because rank starts from 1 and we want position after this student
                    } else if (studentPercentages[i].percentage === currentPercentage) {
                        rank = i + 1; // Same percentage gets same rank
                        break;
                    } else {
                        break; // Current percentage is higher than this student
                    }
                }
                
                return Math.min(rank, studentPercentages.length);
                
            } catch (error) {
                console.error('Error calculating rank:', error);
                return 1;
            }
        }

        // Admin - Class Selection
        elements.adminClassSelect.addEventListener('change', async () => {
            const classNum = elements.adminClassSelect.value;
            elements.adminStudentSelect.innerHTML = '<option value="">Select Student</option><option value="new">‚ûï Add New Student</option>';
            elements.adminStudentSelect.disabled = true;
            elements.deleteStudentBtn.disabled = true;
            clearForm();

            if (classNum) {
                try {
                    const snapshot = await db.ref(`students/class${classNum}`).once('value');
                    const students = snapshot.val();
                    
                    // Enable all form elements when class is selected
                    elements.adminStudentSelect.disabled = false;
                    elements.studentName.disabled = false;
                    elements.fatherName.disabled = false;
                    elements.addSubjectBtn.disabled = false;
                    elements.saveStudentBtn.disabled = false;
                    
                    // Update placeholders
                    elements.studentName.placeholder = "Enter student name";
                    elements.fatherName.placeholder = "Enter father's name";
                    
                    // Enable subjects container
                    elements.subjectsContainer.style.opacity = '1';
                    elements.subjectsContainer.style.pointerEvents = 'auto';
                    
                    if (students) {
                        Object.keys(students).forEach(studentId => {
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = students[studentId].name;
                            elements.adminStudentSelect.appendChild(option);
                        });
                    }
                    
                    // Add default subjects if no subjects exist
                    if (elements.subjectsContainer.children.length === 0) {
                        addDefaultSubjects();
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                    showMessage('‚ùå Error loading students', 'error');
                }
            } else {
                // Disable all form elements when no class is selected
                elements.studentName.disabled = true;
                elements.fatherName.disabled = true;
                elements.addSubjectBtn.disabled = true;
                elements.saveStudentBtn.disabled = true;
                
                // Update placeholders
                elements.studentName.placeholder = "First select a class to enable editing";
                elements.fatherName.placeholder = "First select a class to enable editing";
                
                // Disable subjects container
                elements.subjectsContainer.style.opacity = '0.5';
                elements.subjectsContainer.style.pointerEvents = 'none';
            }
        });

        // Admin - Student Selection
        elements.adminStudentSelect.addEventListener('change', async () => {
            const selectedValue = elements.adminStudentSelect.value;
            const classNum = elements.adminClassSelect.value;
            
            elements.deleteStudentBtn.disabled = !selectedValue || selectedValue === 'new';
            
            if (selectedValue === 'new') {
                clearForm();
                currentStudentId = null;
            } else if (selectedValue && classNum) {
                await loadStudentData(classNum, selectedValue);
            }
        });

        // Load Student Data
        async function loadStudentData(classNum, studentId) {
            try {
                const [studentSnapshot, marksSnapshot] = await Promise.all([
                    db.ref(`students/class${classNum}/${studentId}`).once('value'),
                    db.ref(`marks/class${classNum}/${studentId}`).once('value')
                ]);
                
                const studentData = studentSnapshot.val();
                const marksData = marksSnapshot.val();
                
                currentStudentId = studentId;
                
                // Populate student info
                elements.studentName.value = studentData.name || '';
                elements.fatherName.value = studentData.fatherName || '';
                
                // Clear and populate subjects
                elements.subjectsContainer.innerHTML = '';
                subjectCount = 0;
                
                if (marksData) {
                    // First add default subjects if they exist in data
                    const defaultSubjects = ['Hindi', 'English', 'Mathematics'];
                    defaultSubjects.forEach(subject => {
                        if (marksData[subject]) {
                            const marks = marksData[subject];
                            addSubjectRow(subject, marks.obtained, marks.maximum);
                        } else {
                            addSubjectRow(subject, '', '10');
                        }
                    });
                    
                    // Then add any additional subjects
                    Object.keys(marksData).forEach(subject => {
                        if (!defaultSubjects.includes(subject)) {
                            const marks = marksData[subject];
                            addSubjectRow(subject, marks.obtained, marks.maximum);
                        }
                    });
                } else {
                    addDefaultSubjects(); // Add default subjects
                }
                
            } catch (error) {
                console.error('Error loading student data:', error);
                showMessage('‚ùå Error loading student data', 'error');
            }
        }

        // Clear Form
        function clearForm() {
            elements.studentName.value = '';
            elements.fatherName.value = '';
            elements.subjectsContainer.innerHTML = '';
            subjectCount = 0;
            currentStudentId = null;
            
            // Only add subjects if class is selected
            if (!elements.adminClassSelect.value) {
                // If no class selected, don't add any subjects
                return;
            }
            
            // Add default subjects when clearing form
            addDefaultSubjects();
        }

        // Add Subject Row (Simplified Layout)
        function addSubjectRow(subjectName = '', obtained = '', maximum = '') {
            subjectCount++;
            const row = document.createElement('div');
            row.className = 'subject-row mb-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border-2 border-blue-200 transform hover:scale-102 transition-all duration-300';
            row.innerHTML = `
                <!-- Single Row Layout -->
                <div class="flex flex-col sm:flex-row items-center gap-3 sm:gap-4">
                    
                    <!-- Subject Number -->
                    <div class="flex items-center">
                        <span class="text-xl mr-2">üìö</span>
                        <span class="text-sm font-bold text-purple-700 whitespace-nowrap">
                            Subject ${subjectCount}:
                        </span>
                    </div>
                    
                    <!-- Subject Name Field (Larger) -->
                    <div class="flex-1 min-w-0 sm:min-w-[200px]">
                        <input type="text" class="subject-name w-full p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none text-base font-semibold transition-all duration-300" 
                               placeholder="Subject name..." 
                               value="${subjectName}">
                    </div>
                    
                    <!-- Obtained Marks Field -->
                    <div class="w-20 sm:w-24">
                        <input type="text" class="obtained-marks w-full p-3 border-2 border-green-300 rounded-lg focus:border-green-500 focus:outline-none text-base font-semibold transition-all duration-300 text-center" 
                               placeholder="Got" 
                               value="${obtained}">
                    </div>
                    
                    <!-- Slash Separator -->
                    <div class="text-xl font-bold text-gray-500">/</div>
                    
                    <!-- Maximum Marks Field -->
                    <div class="w-20 sm:w-24">
                        <input type="number" class="max-marks w-full p-3 border-2 border-orange-300 rounded-lg focus:border-orange-500 focus:outline-none text-base font-semibold transition-all duration-300 text-center" 
                               placeholder="Max" 
                               min="1" 
                               max="1000"
                               value="${maximum || '10'}">
                    </div>
                    
                    <!-- Remove Button -->
                    <button type="button" class="remove-subject bg-red-500 hover:bg-red-600 text-white font-bold p-2 rounded-lg transform hover:scale-105 transition-all duration-300 shadow-lg flex items-center justify-center" ${subjectCount <= 3 ? 'style="display:none"' : ''}>
                        <span class="text-sm">üóëÔ∏è</span>
                    </button>
                </div>
                
                <!-- Helper Text -->
                <div class="mt-2 text-center">
                    <small class="text-xs text-gray-600 font-medium">
                        üí° Type "Absent" in obtained marks if student was absent
                    </small>
                </div>
            `;
            
            elements.subjectsContainer.appendChild(row);
            
            // Add remove functionality
            row.querySelector('.remove-subject').addEventListener('click', () => {
                // Add removal animation
                row.style.transform = 'scale(0.8)';
                row.style.opacity = '0';
                setTimeout(() => {
                    row.remove();
                    subjectCount--;
                    updateRemoveButtons();
                    updateSubjectNumbers();
                }, 300);
            });
            
            updateRemoveButtons();
            updateSubjectNumbers();
        }

        // Update Remove Buttons Visibility
        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.remove-subject');
            removeButtons.forEach((btn, index) => {
                // Only show remove button for subjects beyond the first 3 (Hindi, English, Mathematics)
                btn.style.display = (index >= 3) ? 'flex' : 'none';
            });
        }

        // Update Subject Numbers
        function updateSubjectNumbers() {
            const subjectRows = document.querySelectorAll('.subject-row');
            subjectRows.forEach((row, index) => {
                const header = row.querySelector('span.text-sm');
                if (header) {
                    header.innerHTML = `Subject ${index + 1}:`;
                }
            });
        }

        // Add Default Subjects Function
        function addDefaultSubjects() {
            // Clear existing subjects
            elements.subjectsContainer.innerHTML = '';
            subjectCount = 0;
            
            // Add the three default subjects
            addSubjectRow('Hindi', '', '10');
            addSubjectRow('English', '', '10');
            addSubjectRow('Mathematics', '', '10');
        }

        // Initialize Admin Dashboard
        function initializeAdminDashboard() {
            console.log('Initializing admin dashboard...');
            
            // Reset all form elements
            elements.adminClassSelect.value = '';
            elements.adminStudentSelect.value = '';
            elements.adminStudentSelect.disabled = true;
            elements.deleteStudentBtn.disabled = true;
            elements.studentName.value = '';
            elements.fatherName.value = '';
            elements.studentName.disabled = true;
            elements.fatherName.disabled = true;
            elements.addSubjectBtn.disabled = true;
            elements.saveStudentBtn.disabled = true;
            
            // Update placeholders
            elements.studentName.placeholder = "First select a class to enable editing";
            elements.fatherName.placeholder = "First select a class to enable editing";
            
            // Clear subjects container
            elements.subjectsContainer.innerHTML = '';
            subjectCount = 0;
            
            // Disable subjects container
            elements.subjectsContainer.style.opacity = '0.5';
            elements.subjectsContainer.style.pointerEvents = 'none';
            
            console.log('Admin dashboard initialized successfully');
        }

        // Add Subject Button
        elements.addSubjectBtn.addEventListener('click', () => {
            addSubjectRow('', '', '10');
        });

        // Delete Student (Enhanced to handle both demo and user-input students)
        elements.deleteStudentBtn.addEventListener('click', async () => {
            const selectedValue = elements.adminStudentSelect.value;
            const classNum = elements.adminClassSelect.value;
            
            if (!selectedValue || selectedValue === 'new' || !classNum) {
                showMessage('‚ùå Please select a student to delete!', 'error');
                return;
            }
            
            const studentName = elements.adminStudentSelect.selectedOptions[0].textContent;
            
            // Enhanced confirmation dialog with more details
            const confirmMessage = `‚ö†Ô∏è DELETE CONFIRMATION ‚ö†Ô∏è\n\n` +
                                 `Student: ${studentName}\n` +
                                 `Class: ${classNum}\n\n` +
                                 `This will permanently delete:\n` +
                                 `‚Ä¢ Student information\n` +
                                 `‚Ä¢ All subject marks\n` +
                                 `‚Ä¢ Report card data\n\n` +
                                 `This action CANNOT be undone!\n\n` +
                                 `Are you absolutely sure you want to proceed?`;
            
            if (confirm(confirmMessage)) {
                try {
                    // Show loading message
                    showMessage('üîÑ Deleting student data...', 'info');
                    
                    // Delete from both locations to ensure complete removal
                    await Promise.all([
                        db.ref(`students/class${classNum}/${selectedValue}`).remove(),
                        db.ref(`marks/class${classNum}/${selectedValue}`).remove()
                    ]);
                    
                    showMessage(`‚úÖ ${studentName} has been completely deleted from Class ${classNum}!`);
                    
                    // Clear form and refresh student list
                    clearForm();
                    elements.adminStudentSelect.value = '';
                    elements.deleteStudentBtn.disabled = true;
                    
                    // Refresh student list
                    elements.adminClassSelect.dispatchEvent(new Event('change'));
                    
                } catch (error) {
                    console.error('Error deleting student:', error);
                    showMessage(`‚ùå Failed to delete ${studentName}! Please try again.`, 'error');
                }
            }
        });

        // Fetch Database Button
        elements.fetchDatabaseBtn.addEventListener('click', async () => {
            await fetchAllFirebaseData();
        });

        // Save Student
        elements.saveStudentBtn.addEventListener('click', async () => {
            const classNum = elements.adminClassSelect.value;
            const studentName = elements.studentName.value.trim();
            const fatherName = elements.fatherName.value.trim();
            
            if (!classNum) {
                showMessage('‚ùå Please select a class!', 'error');
                return;
            }
            
            if (!studentName || !fatherName) {
                showMessage('‚ùå Please fill in student name and father\'s name!', 'error');
                return;
            }
            
            // Collect subjects data
            const subjectRows = document.querySelectorAll('.subject-row');
            const subjects = {};
            let hasValidSubject = false;
            
            subjectRows.forEach(row => {
                const subjectName = row.querySelector('.subject-name').value.trim();
                const obtainedValue = row.querySelector('.obtained-marks').value.trim();
                const maxMarks = parseInt(row.querySelector('.max-marks').value);
                
                if (subjectName && obtainedValue && !isNaN(maxMarks) && maxMarks > 0) {
                    // Check if student was absent
                    if (obtainedValue.toLowerCase() === 'absent') {
                        subjects[subjectName] = {
                            obtained: 'Absent',
                            maximum: maxMarks
                        };
                    } else {
                        const obtainedMarks = parseInt(obtainedValue);
                        if (!isNaN(obtainedMarks)) {
                            subjects[subjectName] = {
                                obtained: obtainedMarks,
                                maximum: maxMarks
                            };
                        }
                    }
                    hasValidSubject = true;
                }
            });
            
            if (!hasValidSubject) {
                showMessage('‚ùå Please add at least one complete subject with valid marks!', 'error');
                return;
            }
            
            try {
                const studentId = currentStudentId || generateStudentId(studentName);
                
                // Save student data
                await db.ref(`students/class${classNum}/${studentId}`).set({
                    name: studentName,
                    fatherName: fatherName
                });
                
                // Save marks data
                await db.ref(`marks/class${classNum}/${studentId}`).set(subjects);
                
                const action = currentStudentId ? 'updated' : 'saved';
                showMessage(`‚úÖ ${studentName} ${action} successfully!`);
                
                // Refresh student list
                elements.adminClassSelect.dispatchEvent(new Event('change'));
                
            } catch (error) {
                console.error('Error saving student:', error);
                showMessage('‚ùå Error saving student data!', 'error');
            }
        });

        // Fetch All Firebase Database Function
        async function fetchAllFirebaseData() {
            try {
                console.log('üîÑ Fetching all Firebase database data...');
                showMessage('üîÑ Loading database data...', 'info');
                
                const [studentsSnapshot, marksSnapshot] = await Promise.all([
                    db.ref('students').once('value'),
                    db.ref('marks').once('value')
                ]);
                
                const studentsData = studentsSnapshot.val();
                const marksData = marksSnapshot.val();
                
                console.log('üìä Complete Students Data:', studentsData);
                console.log('üìä Complete Marks Data:', marksData);
                
                // Display detailed summary
                let totalStudents = 0;
                let classBreakdown = {};
                
                if (studentsData) {
                    Object.keys(studentsData).forEach(classKey => {
                        if (studentsData[classKey]) {
                            const classStudentCount = Object.keys(studentsData[classKey]).length;
                            totalStudents += classStudentCount;
                            classBreakdown[classKey] = classStudentCount;
                        }
                    });
                }
                
                console.log('üìà Class-wise Student Count:', classBreakdown);
                console.log('üìä Total Students in Database:', totalStudents);
                
                // Show detailed success message
                let classDetails = '';
                Object.keys(classBreakdown).forEach(classKey => {
                    classDetails += `${classKey}: ${classBreakdown[classKey]} students, `;
                });
                
                showMessage(`‚úÖ Database loaded! Found ${totalStudents} students (${classDetails.slice(0, -2)})`);
                
                return {
                    students: studentsData,
                    marks: marksData,
                    totalStudents: totalStudents,
                    classBreakdown: classBreakdown
                };
                
            } catch (error) {
                console.error('‚ùå Error fetching Firebase data:', error);
                showMessage('‚ùå Error loading database data!', 'error');
                return null;
            }
        }

        // Initialize with sample data on first load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Smart Report Card System initialized');
            
            // Show initial section (student section by default)
            showStudentSection();
            
            // Fetch all database data on load
            await fetchAllFirebaseData();
            
            // Check if database is empty and auto-restore sample data in background (non-blocking)
            setTimeout(async () => {
                try {
                    const studentsSnapshot = await db.ref('students').once('value');
                    if (!studentsSnapshot.exists()) {
                        console.log('üì¶ Database is empty, restoring sample data...');
                        await restoreSampleData();
                        console.log('‚úÖ Sample data restored successfully');
                        // Fetch data again after restoring
                        await fetchAllFirebaseData();
                    }
                } catch (error) {
                    console.error('‚ùå Error checking database:', error);
                }
            }, 100);
        });
    </script>

    <!-- Optimized Bottom Marquee -->
    <footer class="fixed bottom-0 left-0 right-0 z-50 overflow-hidden bg-gradient-to-r from-slate-800 to-slate-700 border-t-2 border-yellow-400 shadow-lg">
        
        <!-- Background Elements -->
        <div class="absolute inset-0 overflow-hidden mobile-hidden">
            <div class="absolute top-1 left-8 w-4 h-4 bg-yellow-400 rounded-full opacity-40 bounce"></div>
            <div class="absolute top-2 right-12 w-3 h-3 bg-orange-400 rounded-full opacity-30 pulse"></div>
        </div>
        
        <!-- Marquee Content -->
        <div class="py-3 overflow-hidden">
            <div class="marquee-container">
                <div class="animate-marquee text-yellow-300 font-display">
                    
                    <!-- Welcome Message -->
                    <span class="text-lg md:text-xl mr-8">
                        ‚ú® Welcome to Primary School Karanpur - Where Students Learn with JOY! ‚ú®
                    </span>
                    
                    <!-- Separator -->
                    <span class="text-base mr-4">üåü</span>
                    
                    <!-- Excellence Message -->
                    <span class="text-lg md:text-xl mr-8">
                        üìö Excellence in Education, Building Future Leaders üìö
                    </span>
                    
                    <!-- Separator -->
                    <span class="text-base mr-4">üí´</span>
                    
                    <!-- Dreams Message -->
                    <span class="text-lg md:text-xl mr-8">
                        üéì Where Dreams Take Flight & Knowledge Shines Bright üéì
                    </span>
                    
                </div>
            </div>
        </div>
        
        <!-- Top Border -->
        <div class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-yellow-400 to-orange-400"></div>
        
    </footer>

    <!-- Bottom Padding for Fixed Footer -->
    <style>
        body {
            padding-bottom: 60px;
        }
        
        @media screen and (min-width: 768px) {
            body {
                padding-bottom: 70px;
            }
        }
        
        /* Pause marquee on hover */
        .marquee-container:hover .animate-marquee {
            animation-play-state: paused;
        }
    </style>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a852b037185522',t:'MTc1NDQxODE3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
