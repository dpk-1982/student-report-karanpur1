<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒˆ Primary School KaranpurğŸŒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1) rotate(180deg); opacity: 1; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 150, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 0, 150, 0.8), 0 0 60px rgba(0, 255, 255, 0.5); }
        }
        
        .celebration {
            animation: bounce 2s infinite, glow 3s infinite;
        }
        
        .sparkle {
            position: absolute;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #ffd700, #ff6b6b, #4ecdc4, #45b7d1);
            border-radius: 50%;
            animation: sparkle 1.5s infinite;
        }
        
        .rainbow-bg {
            background: linear-gradient(-45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
            background-size: 400% 400%;
            animation: rainbow 4s ease infinite;
        }
        
        .magical-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .magical-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }
        
        .neon-button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: rainbow 3s ease infinite;
            border: none;
            color: white;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }
        
        .neon-button:hover {
            animation-duration: 1s;
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.6);
            transform: scale(1.05);
        }
        
        .floating-emoji {
            animation: float 3s ease-in-out infinite;
        }
        
        .slide-in {
            animation: slideIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%) rotate(-10deg); opacity: 0; }
            to { transform: translateX(0) rotate(0deg); opacity: 1; }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .slide-in-right {
            animation: slideInRight 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-200%) rotate(-15deg); opacity: 0; }
            to { transform: translateX(0) rotate(0deg); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(200%) rotate(15deg); opacity: 0; }
            to { transform: translateX(0) rotate(0deg); opacity: 1; }
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbow 3s ease infinite;
            background-size: 400% 400%;
        }
        
        .super-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border: 3px solid transparent;
            background-clip: padding-box;
            position: relative;
        }
        
        .super-card::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
            border-radius: inherit;
            z-index: -1;
            animation: rainbow 3s ease infinite;
            background-size: 400% 400%;
        }
        
        .marquee-container {
            width: 100%;
            overflow: hidden;
        }
        
        .marquee-content {
            display: flex;
            animation: marquee 30s linear infinite;
            will-change: transform;
            white-space: nowrap;
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .marquee-content:hover {
            animation-play-state: paused;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-400 via-purple-700 via-indigo-800 to-blue-900">
    <!-- Floating Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="floating-emoji absolute top-10 left-10 text-4xl">ğŸŒŸ</div>
        <div class="floating-emoji absolute top-20 right-20 text-4xl" style="animation-delay: 1s;">â­</div>
        <div class="floating-emoji absolute bottom-20 left-20 text-4xl" style="animation-delay: 2s;">ğŸ¨</div>
        <div class="floating-emoji absolute bottom-10 right-10 text-4xl" style="animation-delay: 0.5s;">ğŸš€</div>
        <div class="floating-emoji absolute top-1/2 left-1/4 text-3xl" style="animation-delay: 1.5s;">âœ¨</div>
        <div class="floating-emoji absolute top-1/3 right-1/3 text-3xl" style="animation-delay: 2.5s;">ğŸ¯</div>
    </div>

    <!-- Welcome Marquee -->
    <div class="bg-gradient-to-r from-emerald-400 via-cyan-600 to-blue-600 py-4 shadow-xl border-b-4 border-yellow-400 overflow-hidden">
        <div class="marquee-container">
            <div class="marquee-content text-white text-xl md:text-2xl font-bold flex items-center space-x-8 whitespace-nowrap">
                <span class="text-3xl animate-bounce">ğŸ«</span>
                <span class="drop-shadow-lg">Great Welcome to Primary School Karanpur</span>
                <span class="text-3xl animate-pulse">ğŸŒŸ</span>
                <span class="drop-shadow-lg">Block-: Behjam</span>
                <span class="text-3xl animate-bounce">ğŸ›ï¸</span>
                <span class="drop-shadow-lg">District :- Lakhimpur Kheri</span>
                <span class="text-3xl animate-pulse">ğŸ“</span>
                <span class="drop-shadow-lg">Excellence in Education</span>
                <span class="text-3xl animate-bounce">âœ¨</span>
                <span class="drop-shadow-lg">Nurturing Young Minds</span>
                <span class="text-3xl animate-pulse">ğŸŒˆ</span>
                <span class="text-3xl animate-bounce">ğŸ«</span>
                <span class="drop-shadow-lg">Great Welcome to Primary School Karanpur</span>
                <span class="text-3xl animate-pulse">ğŸŒŸ</span>
                <span class="drop-shadow-lg">Block-: Behjam</span>
                <span class="text-3xl animate-bounce">ğŸ›ï¸</span>
                <span class="drop-shadow-lg">District :- Lakhimpur Kheri</span>
                <span class="text-3xl animate-pulse">ğŸ“</span>
                <span class="drop-shadow-lg">Excellence in Education</span>
                <span class="text-3xl animate-bounce">âœ¨</span>
                <span class="drop-shadow-lg">Nurturing Young Minds</span>
                <span class="text-3xl animate-pulse">ğŸŒˆ</span>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-purple-600 via-pink-500 to-indigo-600 shadow-2xl relative z-10 border-b-4 border-yellow-300">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-col lg:flex-row justify-between items-center py-8 space-y-4 lg:space-y-0">
                <div class="text-center lg:text-left">
                    <h1 class="text-3xl lg:text-6xl font-extrabold text-white drop-shadow-2xl mb-2 animate-pulse">
                        Primary School Karanpur
                    </h1>
                  <p class="text-2xl text-red-200 font-semibold drop-shadow-lg">
                                              ğŸ“ Block :- Behjam,    District :- Lakhimpur-Kheri ğŸŒŸ
                    </p>
<!--                     <p class="text-xl text-yellow-200 font-semibold drop-shadow-lg">
                        ğŸ“ Where Learning Meets Magic! ğŸŒŸ
                    </p> -->
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-6">
                    <button onclick="showReportCard()" class="slide-in-left group relative overflow-hidden bg-gradient-to-r from-emerald-400 via-cyan-400 to-blue-500 hover:from-emerald-500 hover:via-cyan-500 hover:to-blue-600 text-white px-10 py-4 rounded-2xl font-bold text-lg shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-white/30">
                        <span class="relative z-10 flex items-center justify-center space-x-2">
                            <span>ğŸ“Š</span>
                            <span>View Report Cards</span>
                            <span>ğŸ“</span>
                        </span>
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </button>
                    <button onclick="showAdminPanel()" class="slide-in-right group relative overflow-hidden bg-gradient-to-r from-orange-400 via-red-400 to-pink-500 hover:from-orange-500 hover:via-red-500 hover:to-pink-600 text-white px-10 py-4 rounded-2xl font-bold text-lg shadow-2xl transform hover:scale-110 transition-all duration-300 border-2 border-white/30">
                        <span class="relative z-10 flex items-center justify-center space-x-2">
                            <span>âš™ï¸</span>
                            <span>Admin Panel</span>
                            <span>ğŸ‘¨â€ğŸ’¼</span>
                        </span>
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Developer Credit Marquee -->
    <div class="bg-gradient-to-r from-purple-500 via-pink-600 to-red-500 py-3 shadow-xl border-b-4 border-orange-400 overflow-hidden">
        <div class="marquee-container">
            <div class="marquee-content text-white text-lg md:text-xl font-bold flex items-center space-x-8 whitespace-nowrap">
                <span class="text-2xl animate-spin">ğŸ’»</span>
                <span class="drop-shadow-lg">This site is developed by Deepak Kumar Vaishy !!</span>
                <span class="text-2xl animate-pulse">ğŸš€</span>
                <span class="drop-shadow-lg">Making students to feel proud</span>
                <span class="text-2xl animate-bounce">â­</span>
                <span class="drop-shadow-lg">Creating Digital Magic</span>
                <span class="text-2xl animate-pulse">ğŸ¯</span>
                <span class="drop-shadow-lg">Innovation & Excellence</span>
                <span class="text-2xl animate-spin">ğŸ”¥</span>
                <span class="text-2xl animate-spin">ğŸ’»</span>
                <span class="drop-shadow-lg">This site is developed by Deepak Kumar Vaishy !!</span>
                <span class="text-2xl animate-pulse">ğŸš€</span>
                <span class="drop-shadow-lg">Full Stack Developer</span>
                <span class="text-2xl animate-bounce">â­</span>
                <span class="drop-shadow-lg">Creating Digital Magic</span>
                <span class="text-2xl animate-pulse">ğŸ¯</span>
                <span class="drop-shadow-lg">Innovation & Excellence</span>
                <span class="text-2xl animate-spin">ğŸ”¥</span>
            </div>
        </div>
    </div>

    <!-- Report Card Section -->
    <div id="reportCardSection" class="container mx-auto px-4 py-8">
        <div class="super-card rounded-3xl shadow-2xl p-8 magical-card text-gray-800">
            <div class="text-center mb-12">
                <h2 class="text-6xl lg:text-6xl font-extrabold text-white drop-shadow-2xl mb-4 animate-bounce">
                    ğŸ“ Student Report Card ğŸ“š
                </h2>
                <div class="w-32 h-1 bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 mx-auto rounded-full mb-4"></div>
                <p class="text-2xl text-white/90 font-semibold drop-shadow-lg">
                    âœ¨ Discover Amazing Academic Achievements! ğŸŒŸ
                </p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div class="bg-white bg-opacity-20 p-6 rounded-2xl backdrop-blur-sm">
                    <label class="block text-xl font-bold text-gray-800 mb-4 drop-shadow">ğŸ« Select Class:</label>
                    <select id="classSelect" onchange="loadStudents()" class="w-full p-4 border-3 border-pink-300 rounded-2xl focus:border-yellow-400 focus:outline-none transition-all duration-300 text-lg font-semibold bg-gradient-to-r from-pink-100 to-purple-100">
                        <option value="">ğŸŒŸ Choose Your Class ğŸŒŸ</option>
                        <option value="1">Class 1 ğŸŒ± (Little Sprouts)</option>
                        <option value="2">Class 2 ğŸŒ¿ (Growing Leaves)</option>
                        <option value="3">Class 3 ğŸŒ³ (Strong Trees)</option>
                        <option value="4">Class 4 ğŸŒ² (Tall Pines)</option>
                        <option value="5">Class 5 ğŸ‹ (Wise Bamboo)</option>
                    </select>
                </div>
                
                <div class="bg-white bg-opacity-20 p-6 rounded-2xl backdrop-blur-sm">
                    <label class="block text-xl font-bold text-gray-800 mb-4 drop-shadow">ğŸ‘¦ Select Student:</label>
                    <select id="studentSelect" onchange="loadReportCard()" class="w-full p-4 border-3 border-blue-300 rounded-2xl focus:border-green-400 focus:outline-none transition-all duration-300 text-lg font-semibold bg-gradient-to-r from-blue-100 to-green-100">
                        <option value="">âœ¨ Choose Amazing Student âœ¨</option>
                    </select>
                </div>
            </div>
            
            <div id="reportCardDisplay" class="hidden">
                <!-- Report card will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Admin Panel Section -->
    <div id="adminSection" class="container mx-auto px-4 py-8 hidden">
        <div class="super-card rounded-3xl shadow-2xl p-8 magical-card text-gray-800">
            <div class="text-center mb-12">
                <h2 class="text-4xl lg:text-7xl font-extrabold text-white drop-shadow-2xl mb-4 animate-pulse">
                    ğŸ” Super Admin Panel ğŸ›¡ï¸
                </h2>
                <div class="w-40 h-1 bg-gradient-to-r from-red-400 via-orange-400 to-yellow-400 mx-auto rounded-full mb-4"></div>
                <p class="text-2xl text-white/90 font-semibold drop-shadow-lg">
                    âš¡ Manage Students with Magical Powers! ğŸ¯
                </p>
            </div>
            
            <!-- Password Protection -->
            <div id="passwordSection" class="text-center">
                <div class="max-w-lg mx-auto bg-gradient-to-br from-white/30 to-white/10 p-10 rounded-3xl backdrop-blur-lg border-2 border-white/20 shadow-2xl">
                    <div class="text-5xl mb-6 animate-bounce">ğŸ”’</div>
                    <h3 class="text-3xl font-bold text-white mb-2 drop-shadow-lg">Security Gate</h3>
                    <p class="text-lg text-white/80 mb-8 drop-shadow">Enter the magical password to continue</p>
                    <input type="password" id="adminPassword" placeholder="ğŸ”‘ Enter Secret Code..." class="w-full p-5 border-3 border-yellow-300 rounded-2xl focus:border-pink-400 focus:outline-none focus:ring-4 focus:ring-pink-200 transition-all duration-300 mb-8 text-xl font-semibold text-center bg-gradient-to-r from-yellow-50 to-pink-50 shadow-lg">
                    <button onclick="checkPassword()" class="group relative overflow-hidden bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 hover:from-green-500 hover:via-blue-600 hover:to-purple-700 text-white px-12 py-5 rounded-2xl text-xl font-bold transition-all duration-300 transform hover:scale-105 shadow-2xl border-2 border-white/30">
                        <span class="relative z-10 flex items-center justify-center space-x-3">
                            <span>ğŸ”“</span>
                            <span>Open Magical Door</span>
                            <span>âœ¨</span>
                        </span>
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </button>
                </div>
            </div>
            
            <!-- Admin Controls -->
            <div id="adminControls" class="hidden">
                <div class="grid md:grid-cols-3 gap-8 mb-12">
                    <button onclick="showAddStudent()" class="group relative overflow-hidden bg-gradient-to-br from-emerald-400 via-teal-500 to-cyan-600 hover:from-emerald-500 hover:via-teal-600 hover:to-cyan-700 text-white p-8 rounded-3xl transition-all duration-500 transform hover:scale-110 hover:rotate-1 text-xl font-bold shadow-2xl border-2 border-white/20">
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-3 animate-bounce">â•</div>
                            <h3 class="text-2xl font-extrabold mb-2">Add New Student</h3>
                            <p class="text-sm opacity-90">Create magical profiles</p>
                            <div class="text-3xl mt-2">ğŸŒŸ</div>
                        </div>
                    </button>
                    <button onclick="showEditStudent()" class="group relative overflow-hidden bg-gradient-to-br from-amber-400 via-orange-500 to-red-500 hover:from-amber-500 hover:via-orange-600 hover:to-red-600 text-white p-8 rounded-3xl transition-all duration-500 transform hover:scale-110 hover:rotate-1 text-xl font-bold shadow-2xl border-2 border-white/20">
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10 text-center">
                            <div class="text-3xl mb-3 animate-pulse">âœï¸</div>
                            <h3 class="text-2xl font-extrabold mb-2">Edit Student</h3>
                            <p class="text-sm opacity-90">Update information</p>
                            <div class="text-3xl mt-2">ğŸ“</div>
                        </div>
                    </button>
                    <button onclick="showDeleteStudent()" class="group relative overflow-hidden bg-gradient-to-br from-rose-400 via-pink-500 to-purple-600 hover:from-rose-500 hover:via-pink-600 hover:to-purple-700 text-white p-8 rounded-3xl transition-all duration-500 transform hover:scale-110 hover:rotate-1 text-xl font-bold shadow-2xl border-2 border-white/20">
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10 text-center">
                            <div class="text-3xl mb-3 animate-bounce">ğŸ—‘ï¸</div>
                            <h3 class="text-2xl font-extrabold mb-2">Remove Student</h3>
                            <p class="text-sm opacity-90">Careful deletion</p>
                            <div class="text-3xl mt-2">ğŸš«</div>
                        </div>
                    </button>
                </div>
                
                <div id="adminForms">
                    <!-- Admin forms will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration with your provided details
        const firebaseConfig = {
            apiKey: "AIzaSyBXcBGbfxZ0kU0vqbZvsB_eD7nRBdmRAVI",
            authDomain: "deeapk1281.firebaseapp.com",
            databaseURL: "https://deeapk1281-default-rtdb.firebaseio.com",
            projectId: "deeapk1281",
            storageBucket: "deeapk1281.appspot.com",
            messagingSenderId: ".",
            appId: "1:.:web:c60b948ecacf60888a356b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables to store current data
        let currentStudents = {};
        let currentStudentData = null;

        // Navigation functions
        function showReportCard() {
            document.getElementById('reportCardSection').classList.remove('hidden');
            document.getElementById('adminSection').classList.add('hidden');
        }

        function showAdminPanel() {
            document.getElementById('reportCardSection').classList.add('hidden');
            document.getElementById('adminSection').classList.remove('hidden');
        }

        // Load students based on selected class from Firebase
        function loadStudents() {
            const classSelect = document.getElementById('classSelect');
            const studentSelect = document.getElementById('studentSelect');
            const selectedClass = classSelect.value;
            
            studentSelect.innerHTML = '<option value="">âœ¨ Choose Amazing Student âœ¨</option>';
            document.getElementById('reportCardDisplay').classList.add('hidden');
            
            if (!selectedClass) return;
            
            // Show loading message
            studentSelect.innerHTML = '<option value="">ğŸ”„ Loading students...</option>';
            
            // Comprehensive search across all possible database paths
            database.ref().once('value')
                .then((snapshot) => {
                    const allData = snapshot.val();
                    console.log("Complete database structure:", allData);
                    
                    let students = null;
                    
                    if (allData) {
                        // Search strategy 1: Direct class path
                        if (allData.students && allData.students[`class${selectedClass}`]) {
                            students = allData.students[`class${selectedClass}`];
                            console.log(`Found students in students/class${selectedClass}:`, students);
                        }
                        // Search strategy 2: Alternative class structure
                        else if (allData[`class${selectedClass}`]) {
                            students = allData[`class${selectedClass}`];
                            console.log(`Found students in class${selectedClass}:`, students);
                        }
                        // Search strategy 3: Nested class structure
                        else if (allData.students && allData.students.class && allData.students.class[selectedClass]) {
                            students = allData.students.class[selectedClass];
                            console.log(`Found students in students/class/${selectedClass}:`, students);
                        }
                        // Search strategy 4: Deep search for any student with matching class
                        else {
                            students = {};
                            const searchForStudents = (obj, path = '') => {
                                if (obj && typeof obj === 'object') {
                                    Object.keys(obj).forEach(key => {
                                        const value = obj[key];
                                        if (value && typeof value === 'object') {
                                            // Check if this looks like a student object
                                            if (value.name && value.class && value.class == selectedClass) {
                                                students[key] = value;
                                                console.log(`Found student ${value.name} at path: ${path}/${key}`);
                                            } else {
                                                // Recursively search deeper
                                                searchForStudents(value, `${path}/${key}`);
                                            }
                                        }
                                    });
                                }
                            };
                            searchForStudents(allData, 'root');
                        }
                    }
                    
                    studentSelect.innerHTML = '<option value="">âœ¨ Choose Amazing Student âœ¨</option>';
                    currentStudents = students || {};
                    
                    if (students && Object.keys(students).length > 0) {
                        Object.keys(students).forEach(studentId => {
                            const student = students[studentId];
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = `${student.name} ğŸ‘¦âœ¨`;
                            studentSelect.appendChild(option);
                        });
                        console.log(`Loaded ${Object.keys(students).length} students for class ${selectedClass}`);
                    } else {
                        console.log("No students found, adding demo data...");
                        addDemoData(selectedClass);
                    }
                })
                .catch((error) => {
                    console.error("Error loading students:", error);
                    studentSelect.innerHTML = '<option value="">âŒ Error loading students</option>';
                    addDemoData(selectedClass);
                });
        }

        // Add demo data to Firebase
        function addDemoData(classNum) {
            const demoStudents = {
                student1: {
                    name: "Alice Rainbow",
                    fatherName: "Robert Rainbow",
                    class: classNum,
                    subjects: {
                        hindi: { name: "Hindi ğŸ“š", obtained: 9, maximum: 10 },
                        english: { name: "English ğŸ“–", obtained: 8, maximum: 10 },
                        maths: { name: "Maths ğŸ”¢", obtained: 10, maximum: 10 },
                        evs: { name: "EVS ğŸŒ", obtained: 9, maximum: 10 },
                        sanskrit: { name: "Sanskrit ğŸ•‰ï¸", obtained: 8, maximum: 10 }
                    }
                },
                student2: {
                    name: "Bob Sparkle",
                    fatherName: "John Sparkle",
                    class: classNum,
                    subjects: {
                        hindi: { name: "Hindi ğŸ“š", obtained: 7, maximum: 10 },
                        english: { name: "English ğŸ“–", obtained: 8, maximum: 10 },
                        maths: { name: "Maths ğŸ”¢", obtained: 6, maximum: 10 },
                        evs: { name: "EVS ğŸŒ", obtained: 7, maximum: 10 },
                        sanskrit: { name: "Sanskrit ğŸ•‰ï¸", obtained: 6, maximum: 10 }
                    }
                },
                student3: {
                    name: "Charlie Bright",
                    fatherName: "David Bright",
                    class: classNum,
                    subjects: {
                        hindi: { name: "Hindi ğŸ“š", obtained: 8, maximum: 10 },
                        english: { name: "English ğŸ“–", obtained: 9, maximum: 10 },
                        maths: { name: "Maths ğŸ”¢", obtained: 9, maximum: 10 },
                        evs: { name: "EVS ğŸŒ", obtained: 8, maximum: 10 },
                        sanskrit: { name: "Sanskrit ğŸ•‰ï¸", obtained: 7, maximum: 10 }
                    }
                }
            };

            console.log(`Adding demo data for class ${classNum}...`);
            database.ref(`students/class${classNum}`).set(demoStudents)
                .then(() => {
                    console.log("Demo data added successfully");
                    // Update the student dropdown immediately
                    const studentSelect = document.getElementById('studentSelect');
                    studentSelect.innerHTML = '<option value="">âœ¨ Choose Amazing Student âœ¨</option>';
                    currentStudents = demoStudents;
                    
                    Object.keys(demoStudents).forEach(studentId => {
                        const student = demoStudents[studentId];
                        const option = document.createElement('option');
                        option.value = studentId;
                        option.textContent = `${student.name} ğŸ‘¦âœ¨`;
                        studentSelect.appendChild(option);
                    });
                })
                .catch((error) => {
                    console.error("Error adding demo data:", error);
                    alert("âŒ Error connecting to database. Please check your internet connection!");
                });
        }

        // Load and display report card from Firebase
        function loadReportCard() {
            const classSelect = document.getElementById('classSelect');
            const studentSelect = document.getElementById('studentSelect');
            const reportDisplay = document.getElementById('reportCardDisplay');
            
            const selectedClass = classSelect.value;
            const selectedStudent = studentSelect.value;
            
            if (!selectedClass || !selectedStudent) {
                reportDisplay.classList.add('hidden');
                return;
            }
            
            // Show loading message
            reportDisplay.innerHTML = '<div class="text-center p-8"><div class="text-3xl mb-4">ğŸ”„</div><p class="text-xl font-bold">Loading magical report card...</p></div>';
            reportDisplay.classList.remove('hidden');
            
            // Fetch fresh data from Firebase to ensure we have the latest marks
            database.ref().once('value')
                .then((snapshot) => {
                    const allData = snapshot.val();
                    let student = null;
                    
                    // Search for the specific student across all possible paths
                    if (allData) {
                        // Try different paths to find the student
                        if (allData.students && allData.students[`class${selectedClass}`] && allData.students[`class${selectedClass}`][selectedStudent]) {
                            student = allData.students[`class${selectedClass}`][selectedStudent];
                        } else if (allData[`class${selectedClass}`] && allData[`class${selectedClass}`][selectedStudent]) {
                            student = allData[`class${selectedClass}`][selectedStudent];
                        } else if (currentStudents[selectedStudent]) {
                            student = currentStudents[selectedStudent];
                        } else {
                            // Deep search for the student
                            const findStudent = (obj) => {
                                if (obj && typeof obj === 'object') {
                                    for (const key of Object.keys(obj)) {
                                        if (key === selectedStudent && obj[key].name && obj[key].class == selectedClass) {
                                            return obj[key];
                                        }
                                        if (typeof obj[key] === 'object') {
                                            const found = findStudent(obj[key]);
                                            if (found) return found;
                                        }
                                    }
                                }
                                return null;
                            };
                            student = findStudent(allData);
                        }
                    }
                    
                    currentStudentData = student;
                    
                    if (!student) {
                        reportDisplay.innerHTML = '<div class="text-center p-8 text-red-600"><div class="text-4xl mb-4">âŒ</div><p class="text-xl font-bold">Student data not found!</p><p class="text-sm mt-2">Please check if the student exists in the database.</p></div>';
                        return;
                    }
                    
                    console.log("Loading report for student:", student.name, "Subjects:", student.subjects);
                    
                    // Calculate totals and percentage with default subjects order
                    let totalObtained = 0;
                    let totalMaximum = 0;
                    const subjectsArray = [];
                    
                    // Define default subjects in order
                    const defaultSubjects = ['hindi', 'english', 'maths'];
                    const defaultSubjectNames = {
                        'hindi': 'Hindi ğŸ“š',
                        'english': 'English ğŸ“–', 
                        'maths': 'Maths ğŸ”¢',
                        // 'evs': 'EVS ğŸŒ',
                        // 'sanskrit': 'Sanskrit ğŸ•‰ï¸'
                    };
                    
                    if (student.subjects && Object.keys(student.subjects).length > 0) {
                        // First add default subjects in order
                        defaultSubjects.forEach(subjectKey => {
                            if (student.subjects[subjectKey]) {
                                const subject = student.subjects[subjectKey];
                                totalObtained += subject.obtained || 0;
                                totalMaximum += subject.maximum || 10;
                                subjectsArray.push({
                                    name: subject.name || defaultSubjectNames[subjectKey],
                                    obtained: subject.obtained || 0,
                                    maximum: subject.maximum || 10
                                });
                                console.log(`Added default subject: ${subject.name}, ${subject.obtained}/${subject.maximum}`);
                            } else {
                                // Add default subject with 0 marks if not present
                                const defaultSubject = {
                                    name: defaultSubjectNames[subjectKey],
                                    obtained: 0,
                                    maximum: 10
                                };
                                totalMaximum += defaultSubject.maximum;
                                subjectsArray.push(defaultSubject);
                                console.log(`Added missing default subject: ${defaultSubject.name}, 0/10`);
                            }
                        });
                        
                        // Then add any additional subjects not in defaults
                        Object.keys(student.subjects).forEach(subjectKey => {
                            if (!defaultSubjects.includes(subjectKey.toLowerCase())) {
                                const subject = student.subjects[subjectKey];
                                totalObtained += subject.obtained || 0;
                                totalMaximum += subject.maximum || 10;
                                subjectsArray.push({
                                    name: subject.name || subjectKey,
                                    obtained: subject.obtained || 0,
                                    maximum: subject.maximum || 10
                                });
                                console.log(`Added additional subject: ${subject.name}, ${subject.obtained}/${subject.maximum}`);
                            }
                        });
                    } else {
                        // If no subjects exist, add default subjects with 0 marks
                        defaultSubjects.forEach(subjectKey => {
                            const defaultSubject = {
                                name: defaultSubjectNames[subjectKey],
                                obtained: 0,
                                maximum: 10
                            };
                            totalMaximum += defaultSubject.maximum;
                            subjectsArray.push(defaultSubject);
                            console.log(`Added default subject (no data): ${defaultSubject.name}, 0/10`);
                        });
                    }
                    
                    console.log(`Total subjects: ${subjectsArray.length}, Total obtained: ${totalObtained}, Total maximum: ${totalMaximum}`);
                    
                    const percentage = totalMaximum > 0 ? ((totalObtained / totalMaximum) * 100).toFixed(2) : 0;
                    
                    // Calculate rank (simplified - in real app, compare with all students)
                    const rank = percentage >= 90 ? 1 : percentage >= 80 ? 2 : 3;
                    
                    // Generate report card HTML
                    const isHighAchiever = percentage >= 85;
                    const celebrationClass = isHighAchiever ? 'celebration rainbow-bg' : '';
                    
                    // Start shower animation for high achievers
                    if (isHighAchiever) {
                        startShowerAnimation();
                    }
                    
                    reportDisplay.innerHTML = `
                <div class="slide-in ${celebrationClass} p-8 rounded-3xl ${isHighAchiever ? 'text-black' : 'bg-gradient-to-r from-cyan-100 via-purple-100 to-pink-100 text-gray-800'} relative overflow-hidden">
                    ${isHighAchiever ? `
                        <div class="sparkle" style="top: 15px; left: 20px;"></div>
                        <div class="sparkle" style="top: 30px; right: 30px; animation-delay: 0.5s;"></div>
                        <div class="sparkle" style="bottom: 30px; left: 60%; animation-delay: 1s;"></div>
                        <div class="sparkle" style="top: 60%; right: 20px; animation-delay: 1.5s;"></div>
                        <div class="sparkle" style="bottom: 40px; left: 20%; animation-delay: 0.8s;"></div>
                    ` : ''}
                    
                    <div class="text-center mb-8 relative z-10">
                        <h3 class="text-4xl font-bold mb-4 drop-shadow-lg">ğŸ† MAGICAL REPORT CARD ğŸ†</h3>
                        ${isHighAchiever ? '<p class="text-2xl font-bold animate-pulse drop-shadow-lg">ğŸŒŸ SUPERSTAR PERFORMANCE! ğŸŒŸ</p>' : ''}
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-8 text-xl relative z-10">
                        <div class="bg-black bg-opacity-30 p-4 rounded-3xl backdrop-blur-sm">
                            <strong>ğŸ‘¦ Student:</strong><br>${student.name}
                        </div>
                        <div class="bg-black bg-opacity-30 p-4 rounded-3xl backdrop-blur-sm">
                            <strong>ğŸ‘¨ Father:</strong><br>Mr. ${student.fatherName || 'Not specified'}</div>
                        <div class="bg-black bg-opacity-30 p-4 rounded-3xl backdrop-blur-sm">
                            <strong>ğŸ“š Class:</strong><br>Class ${student.class} ğŸ“
                        </div>
                    </div>
                    
                     <!-- Student Class Display Under Class Selection -->
                  <div class="text-center mb-8 relative z-10">
                      <div class="inline-block bg-gradient-to-r from-emerald-400 via-cyan-500 to-blue-600 text-white px-8 py-4 rounded-2xl shadow-2xl border-2 border-white/30 transform hover:scale-105 transition-all duration-300">
                          <div class="text-2xl font-bold drop-shadow-lg">
                                  ğŸ“ Academic Year 2025-26  ğŸ“š
                              </div>
                              <div class="text-sm mt-1 opacity-50">
                                  
                              </div>
                          </div>
                      </div>
                    
                    ${subjectsArray.length > 0 ? `
                    <div class="mb-12 relative z-10 bg-gradient-to-br from-white/20 to-white/10 p-6 rounded-3xl backdrop-blur-lg border-2 border-white/30 shadow-2xl">
                        <div class="text-center mb-6">
                            <h4 class="text-3xl font-extrabold text-red drop-shadow-2xl mb-2 animate-pulse">ğŸ“Š ACADEMIC PERFORMANCE TABLE ğŸ“ˆ</h4>
                            <div class="w-24 h-1 bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 mx-auto rounded-full"></div>
                        </div>
                        <table class="w-full border-collapse rounded-2xl overflow-hidden shadow-2xl transform hover:scale-[1.01] transition-all duration-500">
                            <thead class="bg-gradient-to-r from-purple-700 via-pink-000 to-red-700 text-white">
                                <tr>
                                    <th class="border-2 border-white p-4 text-left text-lg font-extrabold drop-shadow-lg">ğŸ“– SUBJECT</th>
                                    <th class="border-2 border-white p-4 text-center text-lg font-extrabold drop-shadow-lg">ğŸ“Š OBTAINED</th>
                                    <th class="border-2 border-white p-4 text-center text-lg font-extrabold drop-shadow-lg">ğŸ¯ MAXIMUM</th>
                                    <th class="border-2 border-white p-4 text-center text-lg font-extrabold drop-shadow-lg">ğŸ“‹ TOTAL</th>
                                </tr>
                            </thead>
                            <tbody class="bg-pink">
                                ${subjectsArray.map((subject, index) => `
                                    <tr class="hover:bg-gradient-to-r hover:from-pink-100 hover:via-purple-100 hover:to-blue-100 hover:scale-105 hover:shadow-xl hover:z-20 transition-all duration-700 ease-in-out transform ${index % 2 === 0 ? 'bg-gradient-to-r from-gray-50 to-blue-50' : 'bg-gradient-to-r from-white to-purple-50'} border-b-2 border-gray-200 relative hover:border-pink-400 hover:rounded-lg origin-center">
                                        <td class="border-2 border-gray-300 p-4 font-bold text-purple-800 text-base drop-shadow hover:text-lg hover:text-pink-700 transition-all duration-700 ease-in-out">${subject.name}</td>
                                        <td class="border-2 border-gray-300 p-4 text-center font-extrabold text-green-700 text-2xl drop-shadow-lg animate-pulse hover:text-3xl hover:text-green-600 transition-all duration-700 ease-in-out">${subject.obtained}</td>
                                        <td class="border-2 border-gray-300 p-4 text-center font-bold text-blue-700 text-lg drop-shadow hover:text-xl hover:text-blue-600 transition-all duration-700 ease-in-out">${subject.maximum}</td>
                                        <td class="border-2 border-gray-300 p-4 text-center font-bold text-purple-700 text-lg drop-shadow-lg hover:text-xl hover:text-purple-600 transition-all duration-700 ease-in-out">${subject.obtained}/${subject.maximum}</td>
                                    </tr>
                                `).join('')}
                                <tr class="bg-gradient-to-r from-yellow-300 via-orange-300 to-red-300 font-extrabold border-3 border-yellow-500 transform hover:scale-[1.01] transition-all duration-300">
                                    <td class="border-3 border-yellow-500 p-5 text-purple-900 text-lg drop-shadow-2xl animate-pulse">ğŸ† GRAND TOTAL ğŸ†</td>
                                    <td class="border-3 border-yellow-500 p-5 text-center text-green-800 text-3xl drop-shadow-2xl font-black animate-pulse">${totalObtained}</td>
                                    <td class="border-3 border-yellow-500 p-5 text-center text-blue-800 text-2xl drop-shadow-2xl font-black">${totalMaximum}</td>
                                    <td class="border-3 border-yellow-500 p-5 text-center text-purple-800 text-2xl drop-shadow-2xl font-black animate-pulse">${totalObtained}/${totalMaximum}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8 text-center relative z-10">
                        <div class="bg-gradient-to-r from-green-400 to-blue-500 p-6 rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300">
                            <h4 class="text-2xl font-bold mb-3 text-white drop-shadow">ğŸ“ˆ Percentage</h4>
                            <p class="text-4xl font-bold text-yellow-300 drop-shadow-lg">${percentage}%</p>
                        </div>
                        <div class="bg-gradient-to-r from-purple-400 to-pink-800 p-6 rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300">
                            <h4 class="text-2xl font-bold mb-3 text-white drop-shadow">ğŸ¥‡ Class Rank</h4>
                            <p class="text-4xl font-bold text-yellow-300 drop-shadow-lg">#${rank}</p>
                        </div>
                    </div>
                    ` : `
                    <div class="text-center p-8 relative z-10">
                        <div class="text-4xl mb-4">ğŸ“š</div>
                        <p class="text-2xl font-bold">No subjects added yet!</p>
                        <p class="text-lg mt-2">Ask your admin to add subjects from the Admin Panel.</p>
                    </div>
                    `}
                    
                    ${isHighAchiever && subjectsArray.length > 0 ? `
                        <div class="text-center mt-8 relative z-10">
                            <p class="text-3xl font-bold animate-bounce drop-shadow-lg">ğŸ‰ CONGRATULATIONS! ğŸ‰</p>
                            <p class="text-xl font-semibold mt-2 drop-shadow">You're a SUPERSTAR! Keep shining! âœ¨</p>
                        </div>
                    ` : subjectsArray.length > 0 ? `
                        <div class="text-center mt-8 relative z-10">
                            <p class="text-2xl font-bold text-blue-600">ğŸŒŸ Great Job! Keep Learning! ğŸ“š</p>
                        </div>
                    ` : ''}
                </div>
            `;
                })
                .catch((error) => {
                    console.error("Error loading report card:", error);
                    reportDisplay.innerHTML = '<div class="text-center p-8 text-red-600"><div class="text-4xl mb-4">âŒ</div><p class="text-xl font-bold">Error loading report card!</p><p class="text-sm mt-2">Please check your internet connection and try again.</p></div>';
                });
        }

        // Admin panel functions
        function checkPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'admin123') {
                document.getElementById('passwordSection').classList.add('hidden');
                document.getElementById('adminControls').classList.remove('hidden');
            } else {
                alert('âŒ Incorrect password! Try "admin123" ğŸ”‘');
            }
        }

        function showAddStudent() {
            const adminForms = document.getElementById('adminForms');
            adminForms.innerHTML = `
                <div class="bg-gradient-to-r from-green-100 to-blue-100 p-8 rounded-3xl slide-in shadow-2xl">
                    <h3 class="text-3xl font-bold mb-6 text-green-700 text-center">â• Add New Superstar Student ğŸŒŸ</h3>
                    <form onsubmit="addStudent(event)" class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <input type="text" id="newStudentName" placeholder="âœ¨ Student Name" required class="p-4 border-3 border-green-300 rounded-2xl focus:border-blue-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-green-50 to-blue-50">
                            <input type="text" id="newFatherName" placeholder="ğŸ‘¨ Father's Name" required class="p-4 border-3 border-blue-300 rounded-2xl focus:border-green-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-blue-50 to-green-50">
                        </div>
                        <select id="newStudentClass" required class="w-full p-4 border-3 border-purple-300 rounded-2xl focus:border-pink-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-purple-50 to-pink-50">
                            <option value="">ğŸ« Select Magical Class</option>
                            <option value="1">Class 1 ğŸŒ±</option>
                            <option value="2">Class 2 ğŸŒ¿</option>
                            <option value="3">Class 3 ğŸŒ³</option>
                            <option value="4">Class 4 ğŸŒ²</option>
                            <option value="5">Class 5 ğŸ‹</option>
                        </select>
                        <div id="subjectsContainer" class="bg-white bg-opacity-50 p-6 rounded-2xl">
                            <h4 class="font-bold mb-4 text-xl text-purple-700">ğŸ“š Add Amazing Subjects:</h4>
                            <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                <input type="text" value="Hindi" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                            </div>
                            <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                <input type="text" value="English" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                            </div>
                            <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                <input type="text" value="Maths" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                            </div>
                            <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                <input type="text" value="EVS" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                            </div>
                            <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                <input type="text" value="Sanskrit" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <button type="button" onclick="addSubjectField()" class="group relative overflow-hidden bg-gradient-to-r from-purple-500 via-violet-600 to-indigo-700 hover:from-purple-600 hover:via-violet-700 hover:to-indigo-800 text-white px-8 py-4 rounded-2xl font-bold transition-all duration-300 transform hover:scale-105 shadow-xl border-2 border-white/20">
                                <span class="relative z-10 flex items-center justify-center space-x-2">
                                    <span>â•</span>
                                    <span>Add Subject</span>
                                    <span>ğŸ“š</span>
                                </span>
                                <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </button>
                            <button type="submit" class="flex-1 group relative overflow-hidden bg-gradient-to-r from-violet-500 via-purple-600 to-indigo-700 hover:from-violet-600 hover:via-purple-700 hover:to-indigo-800 text-white p-5 rounded-2xl text-xl font-bold transition-all duration-300 transform hover:scale-105 shadow-2xl border-2 border-white/20">
                                <span class="relative z-10 flex items-center justify-center space-x-3">
                                    <span>ğŸš€</span>
                                    <span>Add Superstar Student</span>
                                    <span>âœ¨</span>
                                </span>
                                <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </button>
                        </div>
                    </form>
                </div>
            `;
        }

        function showEditStudent() {
            const adminForms = document.getElementById('adminForms');
            adminForms.innerHTML = `
                <div class="bg-gradient-to-r from-yellow-100 to-orange-100 p-8 rounded-3xl slide-in shadow-2xl">
                    <h3 class="text-3xl font-bold mb-6 text-orange-700 text-center">âœï¸ Edit Student Information ğŸ“</h3>
                    <div class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <select id="editClassSelect" onchange="loadEditStudents()" class="p-4 border-3 border-yellow-300 rounded-2xl focus:border-orange-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-yellow-50 to-orange-50">
                                <option value="">ğŸ« Select Class to Edit</option>
                                <option value="1">Class 1 ğŸŒ±</option>
                                <option value="2">Class 2 ğŸŒ¿</option>
                                <option value="3">Class 3 ğŸŒ³</option>
                                <option value="4">Class 4 ğŸŒ²</option>
                                <option value="5">Class 5 ğŸ‹</option>
                            </select>
                            <select id="editStudentSelect" onchange="loadStudentForEdit()" class="p-4 border-3 border-orange-300 rounded-2xl focus:border-yellow-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-orange-50 to-yellow-50">
                                <option value="">ğŸ‘¦ Select Student to Edit</option>
                            </select>
                        </div>
                        <div id="editStudentForm" class="hidden">
                            <!-- Edit form will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
        }

        function showDeleteStudent() {
            const adminForms = document.getElementById('adminForms');
            adminForms.innerHTML = `
                <div class="bg-gradient-to-r from-red-100 to-pink-100 p-8 rounded-3xl slide-in shadow-2xl">
                    <h3 class="text-3xl font-bold mb-6 text-red-700 text-center">ğŸ—‘ï¸ Remove Student ğŸš«</h3>
                    <div class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <select id="deleteClassSelect" onchange="loadDeleteStudents()" class="p-4 border-3 border-red-300 rounded-2xl focus:border-pink-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-red-50 to-pink-50">
                                <option value="">ğŸ« Select Class</option>
                                <option value="1">Class 1 ğŸŒ±</option>
                                <option value="2">Class 2 ğŸŒ¿</option>
                                <option value="3">Class 3 ğŸŒ³</option>
                                <option value="4">Class 4 ğŸŒ²</option>
                                <option value="5">Class 5 ğŸ‹</option>
                            </select>
                            <select id="deleteStudentSelect" class="p-4 border-3 border-pink-300 rounded-2xl focus:border-red-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-pink-50 to-red-50">
                                <option value="">ğŸ‘¦ Select Student to Remove</option>
                            </select>
                        </div>
                        <div class="text-center">
                            <button onclick="deleteStudent()" class="group relative overflow-hidden bg-gradient-to-r from-red-500 via-rose-600 to-pink-700 hover:from-red-600 hover:via-rose-700 hover:to-pink-800 text-white px-10 py-5 rounded-2xl text-xl font-bold transition-all duration-300 transform hover:scale-105 shadow-2xl border-2 border-white/20">
                                <span class="relative z-10 flex items-center justify-center space-x-3">
                                    <span>ğŸ—‘ï¸</span>
                                    <span>Remove Student (Permanent!)</span>
                                    <span>âš ï¸</span>
                                </span>
                                <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </button>
                        </div>
                        <div class="bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded">
                            <p class="text-yellow-700 font-semibold">âš ï¸ Warning: This action cannot be undone!</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions for admin operations
        function addSubjectField() {
            const container = document.getElementById('subjectsContainer');
            const newField = document.createElement('div');
            newField.className = 'subject-entry grid grid-cols-4 gap-3 mb-4';
            newField.innerHTML = `
                <input type="text" placeholder="ğŸ“– Subject Name" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
            `;
            container.appendChild(newField);
        }

        function removeSubject(button) {
            button.parentElement.remove();
        }

        function addStudent(event) {
            event.preventDefault();
            
            const name = document.getElementById('newStudentName').value;
            const fatherName = document.getElementById('newFatherName').value;
            const studentClass = document.getElementById('newStudentClass').value;
            
            const subjectEntries = document.querySelectorAll('.subject-entry');
            const subjects = {};
            
            subjectEntries.forEach((entry, index) => {
                const subjectName = entry.querySelector('.subject-name').value;
                const obtained = parseInt(entry.querySelector('.obtained-marks').value);
                const maximum = parseInt(entry.querySelector('.maximum-marks').value);
                
                if (subjectName && !isNaN(obtained) && !isNaN(maximum)) {
                    const subjectKey = subjectName.toLowerCase().replace(/\s+/g, '');
                    subjects[subjectKey] = {
                        name: subjectName + " ğŸ“š",
                        obtained: obtained,
                        maximum: maximum
                    };
                }
            });
            
            const newStudent = {
                name: name,
                fatherName: fatherName,
                class: studentClass,
                subjects: subjects
            };
            
            // Save to Firebase
            const newStudentRef = database.ref(`students/class${studentClass}`).push();
            newStudentRef.set(newStudent)
                .then(() => {
                    alert('ğŸ‰ Superstar student added successfully! âœ¨');
                    document.getElementById('adminForms').innerHTML = '';
                    // Refresh the student list if the same class is selected
                    if (document.getElementById('classSelect').value === studentClass) {
                        loadStudents();
                    }
                })
                .catch((error) => {
                    console.error("Error adding student:", error);
                    alert('âŒ Error adding student. Please try again!');
                });
        }

        function loadEditStudents() {
            const classSelect = document.getElementById('editClassSelect');
            const studentSelect = document.getElementById('editStudentSelect');
            const selectedClass = classSelect.value;
            
            studentSelect.innerHTML = '<option value="">ğŸ‘¦ Select Student to Edit</option>';
            document.getElementById('editStudentForm').classList.add('hidden');
            
            if (!selectedClass) return;
            
            // Use comprehensive search like in loadStudents
            database.ref().once('value')
                .then((snapshot) => {
                    const allData = snapshot.val();
                    let students = null;
                    
                    if (allData) {
                        if (allData.students && allData.students[`class${selectedClass}`]) {
                            students = allData.students[`class${selectedClass}`];
                        } else if (allData[`class${selectedClass}`]) {
                            students = allData[`class${selectedClass}`];
                        } else {
                            students = {};
                            const searchForStudents = (obj) => {
                                if (obj && typeof obj === 'object') {
                                    Object.keys(obj).forEach(key => {
                                        const value = obj[key];
                                        if (value && typeof value === 'object') {
                                            if (value.name && value.class && value.class == selectedClass) {
                                                students[key] = value;
                                            } else {
                                                searchForStudents(value);
                                            }
                                        }
                                    });
                                }
                            };
                            searchForStudents(allData);
                        }
                    }
                    
                    if (students && Object.keys(students).length > 0) {
                        Object.keys(students).forEach(studentId => {
                            const student = students[studentId];
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = `${student.name} ğŸ‘¦`;
                            studentSelect.appendChild(option);
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error loading students for edit:", error);
                });
        }

        function loadStudentForEdit() {
            const classSelect = document.getElementById('editClassSelect');
            const studentSelect = document.getElementById('editStudentSelect');
            const editForm = document.getElementById('editStudentForm');
            
            const selectedClass = classSelect.value;
            const selectedStudent = studentSelect.value;
            
            if (!selectedClass || !selectedStudent) {
                editForm.classList.add('hidden');
                return;
            }
            
            database.ref(`students/class${selectedClass}/${selectedStudent}`).once('value')
                .then((snapshot) => {
                    const student = snapshot.val();
                    if (!student) return;
                    
                    // Define default subjects in order
                    const defaultSubjects = [
                        { key: 'hindi', name: 'Hindi' },
                        { key: 'english', name: 'English' },
                        { key: 'maths', name: 'Maths' },
                        { key: 'evs', name: 'EVS' },
                        { key: 'sanskrit', name: 'Sanskrit' }
                    ];
                    
                    let subjectsHTML = '';
                    
                    // First add default subjects in order
                    defaultSubjects.forEach(defaultSubject => {
                        let obtained = 0;
                        let maximum = 10;
                        
                        // Check if student has this subject
                        if (student.subjects && student.subjects[defaultSubject.key]) {
                            obtained = student.subjects[defaultSubject.key].obtained || 0;
                            maximum = student.subjects[defaultSubject.key].maximum || 10;
                        }
                        
                        subjectsHTML += `
                            <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                <input type="text" value="${defaultSubject.name}" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                <input type="number" value="${obtained}" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                <input type="number" value="${maximum}" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                            </div>
                        `;
                    });
                    
                    // Then add any additional subjects not in defaults
                    if (student.subjects) {
                        const defaultKeys = defaultSubjects.map(s => s.key);
                        Object.keys(student.subjects).forEach(subjectKey => {
                            if (!defaultKeys.includes(subjectKey.toLowerCase())) {
                                const subject = student.subjects[subjectKey];
                                subjectsHTML += `
                                    <div class="subject-entry grid grid-cols-4 gap-3 mb-4">
                                        <input type="text" value="${subject.name.replace(' ğŸ“š', '')}" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                                        <input type="number" value="${subject.obtained}" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                                        <input type="number" value="${subject.maximum}" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                                        <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
                                    </div>
                                `;
                            }
                        });
                    }
                    
                    editForm.innerHTML = `
                        <form onsubmit="updateStudent(event, '${selectedClass}', '${selectedStudent}')" class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <input type="text" id="editStudentName" value="${student.name}" placeholder="âœ¨ Student Name" required class="p-4 border-3 border-green-300 rounded-2xl focus:border-blue-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-green-50 to-blue-50">
                                <input type="text" id="editFatherName" value="${student.fatherName || ''}" placeholder="ğŸ‘¨ Father's Name" required class="p-4 border-3 border-blue-300 rounded-2xl focus:border-green-500 focus:outline-none text-lg font-semibold bg-gradient-to-r from-blue-50 to-green-50">
                            </div>
                            <div id="editSubjectsContainer" class="bg-white bg-opacity-50 p-6 rounded-2xl">
                                <h4 class="font-bold mb-4 text-xl text-purple-700">ğŸ“š Edit Subjects:</h4>
                                ${subjectsHTML}
                            </div>
                            <div class="flex gap-4">
                                <button type="button" onclick="addEditSubjectField()" class="group relative overflow-hidden bg-gradient-to-r from-purple-500 via-violet-600 to-indigo-700 hover:from-purple-600 hover:via-violet-700 hover:to-indigo-800 text-white px-8 py-4 rounded-2xl font-bold transition-all duration-300 transform hover:scale-105 shadow-xl border-2 border-white/20">
                                    <span class="relative z-10 flex items-center justify-center space-x-2">
                                        <span>â•</span>
                                        <span>Add Subject</span>
                                        <span>ğŸ“š</span>
                                    </span>
                                    <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                </button>
                                <button type="submit" class="flex-1 group relative overflow-hidden bg-gradient-to-r from-emerald-500 via-teal-600 to-cyan-700 hover:from-emerald-600 hover:via-teal-700 hover:to-cyan-800 text-white p-5 rounded-2xl text-xl font-bold transition-all duration-300 transform hover:scale-105 shadow-2xl border-2 border-white/20">
                                    <span class="relative z-10 flex items-center justify-center space-x-3">
                                        <span>ğŸ’¾</span>
                                        <span>Update Student</span>
                                        <span>âœ¨</span>
                                    </span>
                                    <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                </button>
                            </div>
                        </form>
                    `;
                    
                    editForm.classList.remove('hidden');
                });
        }

        function addEditSubjectField() {
            const container = document.getElementById('editSubjectsContainer');
            const newField = document.createElement('div');
            newField.className = 'subject-entry grid grid-cols-4 gap-3 mb-4';
            newField.innerHTML = `
                <input type="text" placeholder="ğŸ“– Subject Name" class="subject-name p-3 border-2 border-purple-200 rounded-xl font-semibold">
                <input type="number" placeholder="ğŸ“Š Obtained" class="obtained-marks p-3 border-2 border-green-200 rounded-xl font-semibold">
                <input type="number" value="10" class="maximum-marks p-3 border-2 border-blue-200 rounded-xl font-semibold">
                <button type="button" onclick="removeSubject(this)" class="bg-gradient-to-r from-red-400 to-pink-500 text-white rounded-xl px-3 font-bold hover:from-red-500 hover:to-pink-600 transition-all duration-300">âŒ</button>
            `;
            container.appendChild(newField);
        }

        function updateStudent(event, classNum, studentId) {
            event.preventDefault();
            
            const name = document.getElementById('editStudentName').value;
            const fatherName = document.getElementById('editFatherName').value;
            
            const subjectEntries = document.querySelectorAll('#editSubjectsContainer .subject-entry');
            const subjects = {};
            
            subjectEntries.forEach((entry, index) => {
                const subjectName = entry.querySelector('.subject-name').value;
                const obtained = parseInt(entry.querySelector('.obtained-marks').value);
                const maximum = parseInt(entry.querySelector('.maximum-marks').value);
                
                if (subjectName && !isNaN(obtained) && !isNaN(maximum)) {
                    const subjectKey = subjectName.toLowerCase().replace(/\s+/g, '');
                    subjects[subjectKey] = {
                        name: subjectName + " ğŸ“š",
                        obtained: obtained,
                        maximum: maximum
                    };
                }
            });
            
            const updatedStudent = {
                name: name,
                fatherName: fatherName,
                class: classNum,
                subjects: subjects
            };
            
            // Update in Firebase
            database.ref(`students/class${classNum}/${studentId}`).set(updatedStudent)
                .then(() => {
                    alert('ğŸ‰ Student updated successfully! âœ¨');
                    document.getElementById('adminForms').innerHTML = '';
                    // Refresh the student list if the same class is selected
                    if (document.getElementById('classSelect').value === classNum) {
                        loadStudents();
                    }
                })
                .catch((error) => {
                    console.error("Error updating student:", error);
                    alert('âŒ Error updating student. Please try again!');
                });
        }

        function loadDeleteStudents() {
            const classSelect = document.getElementById('deleteClassSelect');
            const studentSelect = document.getElementById('deleteStudentSelect');
            const selectedClass = classSelect.value;
            
            studentSelect.innerHTML = '<option value="">ğŸ‘¦ Select Student to Remove</option>';
            
            if (!selectedClass) return;
            
            // Use comprehensive search like in loadStudents
            database.ref().once('value')
                .then((snapshot) => {
                    const allData = snapshot.val();
                    let students = null;
                    
                    if (allData) {
                        if (allData.students && allData.students[`class${selectedClass}`]) {
                            students = allData.students[`class${selectedClass}`];
                        } else if (allData[`class${selectedClass}`]) {
                            students = allData[`class${selectedClass}`];
                        } else {
                            students = {};
                            const searchForStudents = (obj) => {
                                if (obj && typeof obj === 'object') {
                                    Object.keys(obj).forEach(key => {
                                        const value = obj[key];
                                        if (value && typeof value === 'object') {
                                            if (value.name && value.class && value.class == selectedClass) {
                                                students[key] = value;
                                            } else {
                                                searchForStudents(value);
                                            }
                                        }
                                    });
                                }
                            };
                            searchForStudents(allData);
                        }
                    }
                    
                    if (students && Object.keys(students).length > 0) {
                        Object.keys(students).forEach(studentId => {
                            const student = students[studentId];
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = `${student.name} ğŸ‘¦`;
                            studentSelect.appendChild(option);
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error loading students for delete:", error);
                });
        }

        function deleteStudent() {
            const classSelect = document.getElementById('deleteClassSelect');
            const studentSelect = document.getElementById('deleteStudentSelect');
            
            const selectedClass = classSelect.value;
            const selectedStudent = studentSelect.value;
            
            if (!selectedClass || !selectedStudent) {
                alert('ğŸš¨ Please select both class and student to remove! âš ï¸');
                return;
            }
            
            const studentName = studentSelect.options[studentSelect.selectedIndex].text;
            
            if (confirm(`ğŸš¨ Are you sure you want to permanently remove ${studentName}? This action cannot be undone! âš ï¸`)) {
                database.ref(`students/class${selectedClass}/${selectedStudent}`).remove()
                    .then(() => {
                        alert('ğŸ—‘ï¸ Student removed successfully! âœ¨');
                        document.getElementById('adminForms').innerHTML = '';
                        // Refresh the student list if the same class is selected
                        if (document.getElementById('classSelect').value === selectedClass) {
                            loadStudents();
                        }
                    })
                    .catch((error) => {
                        console.error("Error deleting student:", error);
                        alert('âŒ Error removing student. Please try again!');
                    });
            }
        }

        // Shower animation function for high achievers
        function startShowerAnimation() {
            // Clear any existing shower particles
            document.querySelectorAll('.shower-particle').forEach(particle => particle.remove());
            
            // Create shower particles
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'shower-particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 2 + 's';
                    particle.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    
                    // Random colors for particles
                    const colors = [
                        'radial-gradient(circle, #ffd700, #ff6b6b)',
                        'radial-gradient(circle, #4ecdc4, #45b7d1)',
                        'radial-gradient(circle, #96ceb4, #feca57)',
                        'radial-gradient(circle, #ff9ff3, #54a0ff)',
                        'radial-gradient(circle, #a8e6cf, #dcedc1)'
                    ];
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    document.body.appendChild(particle);
                    
                    // Remove particle after animation
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 5000);
                }, i * 100);
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            showReportCard();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96bd14f0a5103b4f',t:'MTc1NDYzNTg1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
