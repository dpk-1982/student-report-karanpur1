<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Student Report - Primary School Karanpur</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #007bff;
      color: white;
      padding: 20px;
    }

    label,
    select,
    input {
      margin: 5px 0;
      display: block;
    }

    .report-card,
    .admin-form {
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      background-color: white;
      color: black;
    }

    .admin-form {
      display: none;
      background-color: #28a745;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th,
    td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    .flex-row {
      display: flex;
      justify-content: space-between;
      gap: 30px;
    }

    .admin-button {
      margin-top: 20px;
      padding: 10px 15px;
      background-color: #0056b3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button[type="submit"] {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: white;
      color: #28a745;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    input,
    select {
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>

  <h1>Primary School Karanpur</h1>

  <!-- Class and Student Selection -->
  <label for="classSelect">Select Class:</label>
  <select id="classSelect" onchange="populateStudents()">
    <option value="">--Select Class--</option>
    <option value="1">Class 1</option>
    <option value="2">Class 2</option>
    <option value="3">Class 3</option>
    <option value="4">Class 4</option>
    <option value="5">Class 5</option>
  </select>

  <label for="studentSelect">Select Student:</label>
  <select id="studentSelect" onchange="showReport()">
    <option value="">--Select Student--</option>
  </select>

  <!-- Report Display -->
  <div class="report-card" id="reportCard" style="display: none;"></div>

  <!-- Admin Login Button -->
  <button class="admin-button" onclick="adminLogin()">Admin Login</button>

  <!-- Admin Form -->
  <div class="admin-form" id="adminFormSection">
    <h2>Add Student Record (Admin Only)</h2>
    <form id="studentForm">
      <label>Class:
        <select id="classInput" required>
          <option value="">--Select Class--</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
        </select>
      </label>

      <label>Student Name: <input type="text" id="nameInput" required></label>
      <label>Father's Name: <input type="text" id="fatherInput" required></label>
      <label>Roll Number: <input type="number" id="rollInput" required></label>
      <label>Subjects (comma separated): <input type="text" id="subjectsInput" placeholder="Math:45, English:40" required></label>
      <label>Rank in Class: <input type="number" id="rankInput" required></label>

      <button type="submit">Add Student</button>
    </form>
  </div>

  <script type="module">
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      get,
      remove
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBXcBGbfxZ0kU0vqbZvsB_eD7nRBdmRAVI",
      authDomain: "deeapk1281.firebaseapp.com",
      databaseURL: "https://deeapk1281-default-rtdb.firebaseio.com",
      projectId: "deeapk1281",
      storageBucket: "deeapk1281.appspot.com",
      messagingSenderId: "1033114222578",
      appId: "1:1033114222578:web:c60b948ecacf60888a356b",
      measurementId: "G-KMVWFVFM35"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const classSelect = document.getElementById('classSelect');
    const studentSelect = document.getElementById('studentSelect');
    const reportCard = document.getElementById('reportCard');
    // Load students from Firebase
    window.populateStudents = function() {
      const classId = classSelect.value;
      studentSelect.innerHTML = '<option value="">--Select Student--</option>';
      if (!classId) return;
      get(ref(db, 'students/' + classId)).then(snapshot => {
        if (snapshot.exists()) {
          const students = snapshot.val();
          for (const studentName in students) {
            const option = document.createElement('option');
            option.value = studentName;
            option.textContent = studentName;
            studentSelect.appendChild(option);
          }
        } else {
          alert("No students found in this class.");
        }
      });
      reportCard.style.display = 'none';
    };
    // Show report with update/delete buttons
    window.showReport = function() {
      const classId = classSelect.value;
      const studentName = studentSelect.value;
      if (!classId || !studentName) return;
      const studentRef = ref(db, `students/${classId}/${studentName}`);
      get(studentRef).then(snapshot => {
        if (!snapshot.exists()) {
          reportCard.style.display = 'none';
          return;
        }
        const data = snapshot.val();
        let rows = '';
        let total = 0,
          maxTotal = 0;
        for (const subject in data.subjects) {
          const marks = data.subjects[subject];
          total += marks;
          maxTotal += 50;
          rows += `<tr><td>${subject}</td><td>${marks}</td></tr>`;
        }
        const percent = ((total / maxTotal) * 100).toFixed(2);
        reportCard.innerHTML = `
        <div class="flex-row">
          <p><strong>Student Name:</strong> ${studentName}</p>
          <p><strong>Father's Name:</strong> ${data.father}</p>
        </div>
        <p><strong>Roll Number:</strong> ${data.roll}</p>
        <p><strong>Class:</strong> Class ${classId}</p>
        <table>
          <tr><th>Subject</th><th>Marks</th></tr>
          ${rows}
        </table>
        <p><strong>Total Marks:</strong> ${total} / ${maxTotal}</p>
        <p><strong>Percentage:</strong> ${percent}%</p>
        <p><strong>Rank in Class:</strong> ${data.rank}</p>
        <button onclick="editStudent('${classId}', '${studentName}')">Edit</button>
        <button onclick="deleteStudent('${classId}', '${studentName}')">Delete</button>
      `;
        reportCard.style.display = 'block';
      });
    };
    // Admin login
    window.adminLogin = function() {
      const password = prompt("Enter admin password:");
      if (password === "admin123") {
        document.getElementById('adminFormSection').style.display = 'block';
      } else {
        alert("Incorrect password!");
      }
    };
    // Submit (Add or Update)
    document.getElementById('studentForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const classId = document.getElementById('classInput').value;
      const name = document.getElementById('nameInput').value.trim();
      const father = document.getElementById('fatherInput').value.trim();
      const roll = parseInt(document.getElementById('rollInput').value);
      const rank = parseInt(document.getElementById('rankInput').value);
      const subjectsInput = document.getElementById('subjectsInput').value;
      const subjectPairs = subjectsInput.split(',').map(s => s.trim());
      const subjects = {};
      for (const pair of subjectPairs) {
        const [sub, mark] = pair.split(':').map(s => s.trim());
        if (sub && mark && !isNaN(mark)) {
          subjects[sub] = parseInt(mark);
        } else {
          alert("Invalid subject format. Use format like Math:45, English:40");
          return;
        }
      }
      const studentRef = ref(db, `students/${classId}/${name}`);
      set(studentRef, {
        father,
        roll,
        subjects,
        rank
      }).then(() => {
        alert("Student saved successfully!");
        e.target.reset();
        if (classSelect.value === classId) {
          populateStudents();
          studentSelect.value = name;
          showReport();
        }
      }).catch(err => alert("Error: " + err.message));
    });
    // Delete Student
    window.deleteStudent = function(classId, studentName) {
      const confirmDelete = confirm(`Delete student ${studentName} from Class ${classId}?`);
      if (!confirmDelete) return;
      const studentRef = ref(db, `students/${classId}/${studentName}`);
      remove(studentRef).then(() => {
        alert("Student deleted.");
        populateStudents();
        reportCard.style.display = 'none';
      }).catch(err => alert("Error deleting: " + err.message));
    };
    // Edit Student (Pre-fill form)
    window.editStudent = function(classId, studentName) {
      const studentRef = ref(db, `students/${classId}/${studentName}`);
      get(studentRef).then(snapshot => {
        if (!snapshot.exists()) return alert("Student not found.");
        const data = snapshot.val();
        document.getElementById('classInput').value = classId;
        document.getElementById('nameInput').value = studentName;
        document.getElementById('fatherInput').value = data.father;
        document.getElementById('rollInput').value = data.roll;
        document.getElementById('rankInput').value = data.rank;
        const subjectsStr = Object.entries(data.subjects).map(([k, v]) => `${k}:${v}`).join(', ');
        document.getElementById('subjectsInput').value = subjectsStr;
        document.getElementById('adminFormSection').style.display = 'block';
        alert("Edit the fields and click 'Add Student' to update.");
      });
    };
  </script>

</body>

<marquee>This website is developed by Deepak Kumar Vaishya!!</marquee>

</html>
