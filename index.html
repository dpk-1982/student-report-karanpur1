<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Report Card System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Beautiful Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@200;300;400;500;600;700;800;900&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Comfortaa:wght@300;400;500;600;700&family=Quicksand:wght@300;400;500;600;700&family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Beautiful Font Families */
        body {
            font-family: 'Nunito', 'Poppins', sans-serif;
            font-weight: 400;
        }
        
        .font-primary {
            font-family: 'Fredoka', 'Nunito', cursive;
            font-weight: 500;
        }
        
        .font-heading {
            font-family: 'Comfortaa', 'Poppins', cursive;
            font-weight: 500;
            letter-spacing: 2px;
        }
        
        .font-elegant {
            font-family: 'Raleway', 'Poppins', sans-serif;
            font-weight: 500;
            letter-spacing: 1px;
        }
        
        .font-playful {
            font-family: 'Quicksand', 'Nunito', sans-serif;
            font-weight: 500;
        }
        
        .font-display {
            font-family: 'Fredoka', 'Comfortaa', cursive;
            font-weight: 600;
            letter-spacing: 3px;
        }
        
        /* Enhanced Text Shadows for Better Readability */
        .text-shadow-soft {
            text-shadow: 2px 2px 8px rgba(0,0,0,0.1);
        }
        
        .text-shadow-bold {
            text-shadow: 3px 3px 10px rgba(0,0,0,0.3);
        }
        
        .text-shadow-glow {
            text-shadow: 0 0 20px rgba(255,255,255,0.8), 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Fun Animations for Kids */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        @keyframes wiggle {
            0%, 7% { transform: rotateZ(0); }
            15% { transform: rotateZ(-10deg); }
            20% { transform: rotateZ(5deg); }
            25% { transform: rotateZ(-5deg); }
            30% { transform: rotateZ(4deg); }
            35% { transform: rotateZ(-2deg); }
            40%, 100% { transform: rotateZ(0); }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes colorShift {
            0% { filter: hue-rotate(0deg); }
            25% { filter: hue-rotate(90deg); }
            50% { filter: hue-rotate(180deg); }
            75% { filter: hue-rotate(270deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        /* Special Celebration Animations for High Achievers (85%+) */
        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-3deg); }
        }
        
        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        @keyframes starBurst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
        
        @keyframes goldGlow {
            0%, 100% { box-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ffd700; }
            50% { box-shadow: 0 0 40px #ffd700, 0 0 80px #ffd700, 0 0 120px #ffd700; }
        }
        
        @keyframes fireworks {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        @keyframes shower {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .shower-drop {
            position: absolute;
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: shower 2s linear infinite;
            opacity: 0.8;
        }
        
        @keyframes trophy-bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-30px) scale(1.1); }
            60% { transform: translateY(-15px) scale(1.05); }
        }
        
        /* High Achiever Classes */
        .celebration { animation: celebration 2s ease-in-out infinite; }
        .gold-glow { animation: goldGlow 2s ease-in-out infinite; }
        .trophy-bounce { animation: trophy-bounce 2s ease-in-out infinite; }
        
        /* Confetti Container */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confetti 3s linear infinite;
        }
        
        .star-burst {
            position: absolute;
            font-size: 30px;
            animation: starBurst 2s ease-out infinite;
        }
        
        .firework {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: fireworks 2s ease-out infinite;
        }
        
        /* Fun Classes */
        .bounce { animation: bounce 2s infinite; }
        .wiggle { animation: wiggle 2s ease-in-out infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .pulse { animation: pulse 2s ease-in-out infinite; }
        .slide-in { animation: slideIn 0.8s ease-out; }
        .fade-in-up { animation: fadeInUp 0.6s ease-out; }
        .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
        .color-shift { animation: colorShift 4s linear infinite; }
        
        /* Rainbow Background */
        .rainbow-bg {
            background: linear-gradient(-45deg, #ff6b35, #f7931e, #ffd23f, #06d6a0, #118ab2, #073b4c, #e63946, #f77f00, #fcbf49);
            background-size: 400% 400%;
            animation: rainbow 4s ease infinite;
        }
        
        /* Magical Gradient Buttons */
        .magic-button {
            background: linear-gradient(45deg, #ff6b35, #f7931e, #06d6a0, #118ab2, #e63946, #f77f00);
            background-size: 300% 300%;
            animation: rainbow 3s ease infinite;
            border: none;
            color: white;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .magic-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 25px rgba(0,0,0,0.3);
        }
        
        /* Cute Cards */
        .cute-card {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #06d6a0 100%);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 3px solid #fff;
        }
        
        .cute-card:hover {
            transform: translateY(0px) rotate(0deg);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        /* Fun Messages */
        .success-message {
            position: static;
            top: 50px;
            right: 20px;
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,3,0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease-out, pulse 2s ease-in-out infinite;
            font-weight: bold;
            border: 3px solid #fff;
        }
        
        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease-out, wiggle 1s ease-in-out;
            font-weight: bold;
            border: 3px solid #fff;
        }


        
        /* Sparkle Effects */
        .sparkle-container {
            position: relative;
            overflow: hidden;
        }
        
        .sparkle-container::before,
        .sparkle-container::after {
            content: '✨';
            position: absolute;
            font-size: 15px;
            animation: sparkle 4s ease-in-out infinite;
        }
        
        .sparkle-container::before {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .sparkle-container::after {
            top: 70%;
            right: 10%;
            animation-delay: 1s;
        }
        
        /* Mobile-First Responsive Design */
        @media (max-width: 640px) {
            body {
                font-size: 14px;
            }
            
            .container {
                padding-left: 8px;
                padding-right: 8px;
            }
            
            /* Mobile Navigation */
            .mobile-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 10px;
                z-index: 1000;
                border-top: 3px solid #fff;
                box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
            }
            
            .mobile-nav button {
                width: 100%;
                margin: 5px 0;
                padding: 12px;
                font-size: 14px;
                border-radius: 15px;
            }
            
            /* Mobile Cards */
            .mobile-card {
                margin: 8px;
                padding: 16px;
                border-radius: 20px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            }
            
            /* Mobile Table */
            .mobile-table {
                display: block;
                width: 100%;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            
            .mobile-table table {
                min-width: 100%;
                font-size: 12px;
            }
            
            .mobile-table th,
            .mobile-table td {
                padding: 8px 4px;
                text-align: center;
                min-width: 80px;
            }
            
            /* Mobile Form */
            .mobile-form input,
            .mobile-form select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px;
                border-radius: 12px;
                width: 100%;
                margin-bottom: 10px;
            }
            
            /* Mobile Grid */
            .mobile-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            @media (min-width: 480px) {
                .mobile-grid {
                    grid-template-columns: 1fr 1fr;
                }
            }
            
            /* Touch-friendly buttons */
            .touch-button {
                min-height: 44px;
                min-width: 44px;
                padding: 12px 16px;
                font-size: 14px;
                border-radius: 12px;
                touch-action: manipulation;
            }
            
            /* Mobile animations - reduced for performance */
            .mobile-animate {
                animation-duration: 1s;
                animation-iteration-count: 1;
            }
            
            /* Simplified celebrations on mobile */
            .confetti-container {
                opacity: 0.7;
            }
            
            .confetti-piece,
            .star-burst,
            .firework,
            .shower-drop {
                animation-duration: 1.5s;
                opacity: 0.6;
            }
            
            /* Mobile-specific spacing */
            .mobile-spacing {
                margin: 8px 0;
                padding: 8px;
            }
            
            /* Mobile text sizes */
            .mobile-text-sm { font-size: 12px; }
            .mobile-text-base { font-size: 14px; }
            .mobile-text-lg { font-size: 16px; }
            .mobile-text-xl { font-size: 18px; }
            .mobile-text-2xl { font-size: 20px; }
            .mobile-text-3xl { font-size: 24px; }
        }
        
        /* Tablet styles */
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .tablet-text {
                font-size: 16px;
            }
        }
        
        /* Fun Table Styles - Enhanced for Mobile */
        .fun-table {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            width: 100%;
            font-size: 12px;
        }
        
        @media (min-width: 640px) {
            .fun-table {
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                font-size: 14px;
            }
        }
        
        .fun-table th {
            background: linear-gradient(45deg, #ff6b35, #f7931e, #06d6a0);
            color: white;
            font-size: 11px;
            padding: 8px 4px;
            font-weight: bold;
            text-align: center;
        }
        
        @media (min-width: 480px) {
            .fun-table th {
                font-size: 13px;
                padding: 10px 6px;
            }
        }
        
        @media (min-width: 640px) {
            .fun-table th {
                font-size: 16px;
                padding: 16px 12px;
            }
        }
        
        @media (min-width: 1024px) {
            .fun-table th {
                font-size: 20px;
                padding: 24px;
            }
        }
        
        .fun-table td {
            padding: 6px 4px;
            transition: all 0.3s ease;
            border-bottom: 1px solid #f0f0f0;
            font-size: 11px;
            text-align: center;
        }
        
        @media (min-width: 480px) {
            .fun-table td {
                padding: 8px 6px;
                font-size: 12px;
                border-bottom: 2px solid #f0f0f0;
            }
        }
        
        @media (min-width: 640px) {
            .fun-table td {
                padding: 12px 8px;
                font-size: 14px;
            }
        }
        
        @media (min-width: 1024px) {
            .fun-table td {
                padding: 20px;
                font-size: 18px;
            }
        }
        
        .fun-table tr:hover td {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
        }
        
        @media (min-width: 640px) {
            .fun-table tr:hover td {
                transform: scale(1.02);
            }
        }
        
        /* Marquee Animation */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .animate-marquee {
            animation: marquee 20s linear infinite;
        }
        
        .marquee-container {
            width: 100%;
            overflow: hidden;
        }

        /* Theme Colors */
        .theme-pink { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .theme-blue { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .theme-green { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .theme-orange { background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%); }
        .theme-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="min-h-screen rainbow-bg">
  
  
    
        
    <!-- Welcome Marquee -->
    <div class="bg-gradient-to-r from-orange-500 via-yellow-500 to-green-500 text-white py-3 sm:py-4 overflow-hidden border-b-4 border-white shadow-lg">
        <div class="marquee-container">
            <div class="marquee-text text-lg sm:text-3xl font-bold whitespace-nowrap animate-marquee">
                🌟✨ Welcome to Primary School Karanpur , The place where students Learn with JOY !! ✨🌟 
                📚💫 Welcome to Primary School Karanpur , The place where students Learn with JOY !! 💫📚 
                🎓🌈 Welcome to Primary School Karanpur , The place where students Learn with JOY !! 🌈🎓
            </div>
        </div>
    </div>

    <!-- Celebration Effects Container for High Achievers -->
    <div id="celebrationContainer" class="confetti-container hidden"></div>

    <!-- Header -->
    <div class="text-center py-4 sm:py-8 px-2 sm:px-4 sparkle-container">
        <h1 class="text-2xl sm:text-4xl md:text-5xl lg:text-5xl xl:text-5xl font-display bounce mb-2 sm:mb-4 mobile-text-2xl" style="color: #ffffff; text-shadow: 4px 4px 0px #000000, 8px 8px 0px #333333, 2px 2px 10px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.5); animation: bounce 1.5s ease-in-out infinite; transform: scale(1.05); font-weight: 900; letter-spacing: 3px; -webkit-text-stroke: 2px #000000;">
            🌟🎉🏫✨ PRIMARY SCHOOL KARANPUR ✨🏫🎉🌟
        </h1>
        <p class="text-sm sm:text-lg md:text-2xl lg:text-3xl font-elegant mb-4 sm:mb-6 pulse mobile-text-base text-shadow-soft" style="background: linear-gradient(135deg, #ff6b35, #06d6a0, #118ab2, #01F8E7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            🌟📍 Block : Behjam, Lakhimpur-Kheri 📍🌟
        </p>
        
        <!-- Desktop Navigation -->
        <div class="hidden sm:flex flex-col sm:flex-row justify-center gap-3 sm:gap-6">
            <button id="studentBtn" class="magic-button py-3 sm:py-4 px-6 sm:px-8 rounded-full text-lg sm:text-xl font-primary wiggle text-shadow-bold" style="letter-spacing: 2px;">
                ✨📊 VIEW REPORT CARD 📊✨
            </button>
            <button id="adminBtn" class="magic-button py-3 sm:py-4 px-6 sm:px-8 rounded-full text-lg sm:text-xl font-primary float text-shadow-bold" style="letter-spacing: 2px;">
                🚀👨‍💼 ADMIN PANEL 👨‍💼🚀
            </button>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="sm:hidden mobile-nav">
            <button id="studentBtnMobile" class="magic-button touch-button mobile-text-base font-primary wiggle w-full mb-2 text-shadow-bold">
                ✨📊 VIEW REPORT CARD 📊✨
            </button>
            <button id="adminBtnMobile" class="magic-button touch-button mobile-text-base font-primary float w-full text-shadow-bold">
                🚀👨‍💼 ADMIN PANEL 👨‍💼🚀
            </button>
        </div>
    </div>
  
  
  
  
  
  
  
  

    <!-- Student Section -->
    <div id="studentSection" class="container mx-auto px-1 sm:px-2 md:px-4 max-w-7xl mb-20 sm:mb-0">
        <div class="mobile-card p-3 sm:p-4 md:p-8 slide-in sparkle-container" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 60%, #06d6a0 100%); border-radius: 20px sm:border-radius: 20px; box-shadow: 0 16px 30px rgba(0,0,8,0.3), inset 0 0 0 3px #ffffff, inset 0 0 0 6px rgba(255,255,255,0.2); border: 10px sm:border-8px solid #ffffff; transition: all 0.3s ease; backdrop-filter: blur(10px);">
            <h2 class="text-base sm:text-xl md:text-2xl font-heading mb-3 sm:mb-4 md:mb-6 text-center  text-black drop-shadow-lg mobile-text-lg text-shadow-glow" style="letter-spacing: 2px; border: 2px sm:border-4px solid rgba(255,255,255,0.8); background: rgba(255,255,255,0.2); padding: 8px sm:padding-12px md:padding-16px; border-radius: 12px sm:border-radius-20px; backdrop-filter: blur(5px);">
                ✨🌟 SELECT STUDENT DETAILS 🌟✨
            </h2>
            
            <div class="mobile-grid md:grid-cols-2 gap-3 sm:gap-4 md:gap-6 mb-3 sm:mb-4 md:mb-6">
                <div class="mobile-spacing">
                    <label class="block text-sm sm:text-base md:text-lg lg:text-xl font-playful mb-2 text-white drop-shadow-lg mobile-text-base text-shadow-glow" style="letter-spacing: 1px; background: rgba(255,255,255,0.2); padding: 6px 12px sm:padding-8px-16px; border-radius: 50px sm:border-radius-15px; border: 2px sm:border-3px solid rgba(255,255,255,0.6); backdrop-filter: blur(5px);">🌟📚 CLASS 📚🌟</label>
                    <select id="classSelect" class="mobile-form w-full p-3 sm:p-4 text-sm sm:text-base md:text-lg font-primary focus:outline-none transition-all duration-300 touch-button" style="border: 3px sm:border-6px solid #ffffff; border-radius: 12px sm:border-radius-30px; box-shadow: 0 6px 20px rgba(0,0,0,0.2), inset 0 0 0 2px rgba(255,255,255,0.5); background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); backdrop-filter: blur(5px);">
                        <option value="">🎯 Select Class</option>
                        <option value="1">🌟 Class 1</option>
                        <option value="2">🌟 Class 2</option>
                        <option value="3">🌟 Class 3</option>
                        <option value="4">🌟 Class 4</option>
                        <option value="5">🌟 Class 5</option>
                    </select>
                </div>
                <div class="mobile-spacing">
                    <label class="block text-sm sm:text-base md:text-lg lg:text-xl font-playful mb-2 text-white drop-shadow-lg mobile-text-base text-shadow-glow" style="letter-spacing: 1px; background: rgba(255,255,255,0.2); padding: 6px 12px sm:padding-8px-16px; border-radius: 10px sm:border-radius-15px; border: 2px sm:border-3px solid rgba(255,255,255,0.6); backdrop-filter: blur(5px);">✨👦 STUDENT NAME 👦✨</label>
                    <select id="studentSelect" class="mobile-form w-full p-3 sm:p-4 text-sm sm:text-base md:text-lg font-primary focus:outline-none transition-all duration-300 touch-button" style="border: 3px sm:border-6px solid #ffffff; border-radius: 12px sm:border-radius-20px; box-shadow: 0 6px 20px rgba(0,0,0,0.2), inset 0 0 0 2px rgba(255,255,255,0.5); background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); backdrop-filter: blur(5px);" disabled>
                        <option value="">🎯 First select a class</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Report Card Display -->
        <div id="reportCard" class="hidden mt-4 sm:mt-8">
            <!-- Magical Report Card Container -->
            <div class="relative overflow-hidden" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); border-radius: 30px; padding: 8px; box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 8px rgba(255,255,255,0.1); animation: float 4s ease-in-out infinite;">
                
                <!-- Animated Background Elements -->
                <div class="absolute inset-0 overflow-hidden rounded-3xl">
                    <div class="absolute -top-10 -left-10 w-40 h-40 bg-gradient-to-r from-yellow-300 to-pink-300 rounded-full opacity-20 animate-pulse"></div>
                    <div class="absolute -bottom-10 -right-10 w-60 h-60 bg-gradient-to-r from-blue-300 to-purple-300 rounded-full opacity-20" style="animation: float 6s ease-in-out infinite reverse;"></div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gradient-to-r from-green-200 to-blue-200 rounded-full opacity-10" style="animation: pulse 8s ease-in-out infinite;"></div>
                </div>

                <div class="relative bg-white rounded-3xl p-4 sm:p-8 shadow-2xl backdrop-filter backdrop-blur-lg border border-white/20">
                    
                    <!-- Animated Header -->
                    <div class="text-center mb-6 sm:mb-10 relative overflow-hidden" style="background: linear-gradient(135deg, #ff6b6b 0%, #feca57 25%, #48dbfb 50%, #ff9ff3 75%, #54a0ff 100%); background-size: 300% 300%; animation: rainbow 4s ease infinite; border-radius: 25px; padding: 20px 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.2), inset 0 0 0 3px rgba(255,255,255,0.3);">
                        
                        <!-- Floating Stars -->
                        <div class="absolute top-2 left-4 text-2xl animate-bounce" style="animation-delay: 0s;">⭐</div>
                        <div class="absolute top-4 right-6 text-xl animate-bounce" style="animation-delay: 0.5s;">✨</div>
                        <div class="absolute bottom-2 left-8 text-lg animate-bounce" style="animation-delay: 1s;">🌟</div>
                        <div class="absolute bottom-4 right-4 text-2xl animate-bounce" style="animation-delay: 1.5s;">💫</div>
                        
                        <h2 class="text-2xl sm:text-6xl font-display mb-3 sm:mb-6 text-white relative z-10 text-shadow-glow" style="letter-spacing: 4px; animation: bounce 2s infinite;">
                            🏆✨ Monthly REPORT CARD ✨🏆
                        </h2>
                        <p class="text-lg sm:text-3xl font-elegant text-white relative z-10 text-shadow-bold" style="animation: pulse 3s ease-in-out infinite;">
                            🌟 Academic Excellence Report 🌟
                        </p>
                        
                        <!-- Animated Border -->
                        <div class="absolute inset-0 rounded-3xl border-4 border-white/50" style="animation: pulse 2s ease-in-out infinite;"></div>
                    </div>
                    
                    <!-- Student Info Cards with Staggered Animation -->
                    <div id="studentInfo" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8 mb-6 sm:mb-10">
                        <!-- Student info will be populated here with animations -->
                    </div>
                    
                    <!-- Enhanced Marks Table -->
                    <div class="mb-6 sm:mb-10 relative">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl sm:text-4xl font-heading bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2 text-shadow-soft" style="animation:  3s ease-in-out infinite;">
                                📚✨ SUBJECT WISE PERFORMANCE ✨📚
                            </h3>
                            <div class="w-32 h-1 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto rounded-full" style="animation: pulse 2s ease-in-out infinite;"></div>
                        </div>
                        
                        <div class="mobile-table overflow-x-auto rounded-2xl sm:rounded-3xl shadow-xl sm:shadow-2xl" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 3px sm:padding-6px;">
                            <div class="bg-white rounded-xl sm:rounded-2xl overflow-hidden">
                                <table class="fun-table w-full min-w-[280px] sm:min-w-[300px]">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);">
                                            <th class="mobile-animate" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0s;">📖 SUBJECT</th>
                                            <th class="mobile-animate" style="animation: pulse 2s ease-in-out infinite; animation-delay: 0.3s;">📝 OBTAINED</th>
                                            <th class="mobile-animate" style="animation: float 3s ease-in-out infinite; animation-delay: 0.6s;">🎯 MAXIMUM</th>
                                            <th class="mobile-animate" style="animation: bounce 2s ease-in-out infinite; animation-delay: 0.9s;">📊 %</th>
                                        </tr>
                                    </thead>
                                    <tbody id="marksTable">
                                        <!-- Marks will be populated here with animations -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Summary Cards -->
                    <div class="mb-6 sm:mb-10">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl sm:text-4xl font-heading bg-gradient-to-r from-green-300 to-blue-600 bg-clip-text text-transparent mb-2 text-shadow-soft" style="animation: bounce 2s ease-in-out infinite;">
                                📊🏆 OVERALL PERFORMANCE 🏆📊
                            </h3>
                            <div class="w-40 h-1 bg-gradient-to-r from-green-500 to-blue-500 mx-auto rounded-full" style="animation: pulse 2s ease-in-out infinite;"></div>
                        </div>
                        
                        <div id="summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8">
                            <!-- Summary will be populated here with enhanced animations -->
                        </div>
                    </div>
                    
                    <!-- Enhanced Inspirational Quote Section -->
                    <div class="relative overflow-hidden rounded-3xl" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 6px; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-4 left-4 text-2xl animate-bounce" style="animation-delay: 0s;">🌟</div>
                        <div class="absolute top-6 right-6 text-2xl animate-bounce" style="animation-delay: 0.7s;">✨</div>
                        <div class="absolute bottom-4 left-6 text-2xl animate-bounce" style="animation-delay: 1.4s;">💫</div>
                        <div class="absolute bottom-6 right-4 text-2xl animate-bounce" style="animation-delay: 2.1s;">⭐</div>
                        
                        <div id="inspirationalQuote" class="bg-white rounded-2xl p-6 sm:p-10 text-center relative z-10 shadow-inner">
                            <!-- Quote will be populated here with enhanced styling -->
                        </div>
                    </div>
                    
                    <!-- Decorative Elements -->
                    <div class="absolute top-4 left-4 w-8 h-8 bg-yellow-300 rounded-full opacity-60" style="animation: float 3s ease-in-out infinite;"></div>
                    <div class="absolute top-8 right-8 w-6 h-6 bg-pink-300 rounded-full opacity-60" style="animation: float 4s ease-in-out infinite reverse;"></div>
                    <div class="absolute bottom-4 left-8 w-10 h-10 bg-blue-300 rounded-full opacity-60" style="animation: pulse 3s ease-in-out infinite;"></div>
                    <div class="absolute bottom-8 right-4 w-7 h-7 bg-green-300 rounded-full opacity-60" style="animation: bounce 2s ease-in-out infinite;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Section -->
    <div id="adminSection" class="hidden container mx-auto px-1 sm:px-2 md:px-4 max-w-7xl mb-20 sm:mb-0">
        <!-- Admin Login -->
        <div id="adminLogin" class="mobile-card cute-card p-3 sm:p-4 md:p-8 mx-auto max-w-sm sm:max-w-md sparkle-container">
            <h2 class="text-lg sm:text-xl md:text-3xl font-heading text-center text-white mb-3 sm:mb-4 md:mb-6 wiggle mobile-text-xl text-shadow-glow">🔐✨ Admin Access ✨🔐</h2>
            <div class="mb-3 sm:mb-4 md:mb-6 mobile-spacing">
                <label class="block text-sm sm:text-base md:text-lg font-bold text-white mb-2 mobile-text-base">🔑 Password</label>
                <input type="password" id="adminPassword" class="mobile-form w-full p-3 sm:p-4 border-3 sm:border-4 border-white rounded-xl sm:rounded-2xl text-sm sm:text-base md:text-lg focus:border-yellow-300 focus:outline-none transition-all duration-300 theme-orange touch-button" placeholder="✨ Enter admin password">
            </div>
            <button id="loginBtn" class="w-full magic-button touch-button py-3 sm:py-4 px-4 sm:px-6 rounded-xl sm:rounded-2xl text-base sm:text-lg md:text-xl font-bold pulse mobile-text-lg">
                🚀✨ Login ✨🚀
            </button>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <div class="cute-card p-4 sm:p-8 sparkle-container">
                <h2 class="text-2xl sm:text-3xl font-bold text-center text-white mb-4 sm:mb-8 bounce color-shift">👨‍💼✨ Admin Dashboard ✨👨‍💼</h2>
                
                <!-- Student Management -->
                <div class="bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-4 sm:p-8 rounded-3xl shadow-lg mb-4 sm:mb-8 border-4 border-white sparkle-container">
                    <h3 class="text-xl sm:text-3xl font-bold text-purple-800 mb-4 sm:mb-6 text-center pulse">🎓✨ Student & Marks Management ✨🎓</h3>
                    
                    <!-- Class Selection -->
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">📚 Select Class</label>
                        <select id="adminClassSelect" class="w-full p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none">
                            <option value="">Choose Class</option>
                            <option value="1">Class 1</option>
                            <option value="2">Class 2</option>
                            <option value="3">Class 3</option>
                            <option value="4">Class 4</option>
                            <option value="5">Class 5</option>
                        </select>
                    </div>

                    <!-- Student Selection/Creation -->
                    <div class="mb-4 sm:mb-6">
                        <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">👦 Student</label>
                        <div class="flex flex-col sm:flex-row gap-3 mb-3">
                            <select id="adminStudentSelect" class="flex-1 p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none" disabled>
                                <option value="">First select a class</option>
                                <option value="new">➕ Add New Student</option>
                            </select>
                            <button id="deleteStudentBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 sm:py-4 px-4 sm:px-6 rounded-xl transform hover:scale-105 transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base" disabled>
                                🗑️ Delete
                            </button>
                        </div>
                    </div>

                    <!-- Student Details Form -->
                    <div id="studentForm" class="mb-4 sm:mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4">
                            <div>
                                <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">👦 Student Name</label>
                                <input type="text" id="studentName" placeholder="Enter student name" class="w-full p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-base sm:text-lg font-bold text-purple-700 mb-2">👨 Father's Name</label>
                                <input type="text" id="fatherName" placeholder="Enter father's name" class="w-full p-3 sm:p-4 border-3 border-purple-300 rounded-xl text-base sm:text-lg font-bold focus:border-purple-500 focus:outline-none">
                            </div>
                        </div>
                    </div>

                    <!-- Subjects and Marks -->
                    <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-inner mb-4 sm:mb-6">
                        <h4 class="text-lg sm:text-2xl font-bold text-purple-700 text-center mb-3 sm:mb-4">📖 Subjects & Marks</h4>
                        
                        <div id="subjectsContainer">
                            <!-- Subject rows will be added here -->
                        </div>
                        
                        <div class="text-center mt-3 sm:mt-4">
                            <button id="addSubjectBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 sm:py-3 px-4 sm:px-6 rounded-full transform hover:scale-105 transition-all duration-300 text-sm sm:text-base">
                                ➕ Add Subject
                            </button>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button id="saveStudentBtn" class="w-full magic-button py-4 sm:py-6 px-6 sm:px-8 rounded-2xl text-lg sm:text-2xl font-bold bounce">
                        ✨🌟 Save Student & Marks 🌟✨
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXcBGbfxZ0kU0vqbZvsB_eD7nRBdmRAVI",
            authDomain: "deeapk1281.firebaseapp.com",
            databaseURL: "https://deeapk1281-default-rtdb.firebaseio.com",
            projectId: "deeapk1281",
            storageBucket: "deeapk1281.appspot.com",
            messagingSenderId: ".",
            appId: "1:.:web:c60b948ecacf60888a356b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Configuration
        const ADMIN_PASSWORD = "admin123";
        let currentStudentId = null;
        let subjectCount = 0;

        // Sample Data for Recovery
        const sampleData = {
            students: {
                class1: {
                    "alice_johnson_1": { name: "Alice Johnson", fatherName: "Robert Johnson" },
                    "bob_smith_1": { name: "Bob Smith", fatherName: "Michael Smith" },
                    "charlie_brown_1": { name: "Charlie Brown", fatherName: "David Brown" }
                },
                class2: {
                    "diana_wilson_2": { name: "Diana Wilson", fatherName: "James Wilson" },
                    "edward_davis_2": { name: "Edward Davis", fatherName: "William Davis" },
                    "fiona_miller_2": { name: "Fiona Miller", fatherName: "Thomas Miller" }
                },
                class3: {
                    "george_taylor_3": { name: "George Taylor", fatherName: "Richard Taylor" },
                    "helen_anderson_3": { name: "Helen Anderson", fatherName: "Charles Anderson" },
                    "ivan_thomas_3": { name: "Ivan Thomas", fatherName: "Joseph Thomas" }
                }
            },
            marks: {
                class1: {
                    "alice_johnson_1": {
                        "Mathematics": { obtained: 95, maximum: 100 },
                        "English": { obtained: 88, maximum: 100 },
                        "Science": { obtained: 92, maximum: 100 },
                        "Social Studies": { obtained: 85, maximum: 100 }
                    },
                    "bob_smith_1": {
                        "Mathematics": { obtained: 78, maximum: 100 },
                        "English": { obtained: 82, maximum: 100 },
                        "Science": { obtained: 75, maximum: 100 },
                        "Social Studies": { obtained: 80, maximum: 100 }
                    },
                    "charlie_brown_1": {
                        "Mathematics": { obtained: 65, maximum: 100 },
                        "English": { obtained: 70, maximum: 100 },
                        "Science": { obtained: 68, maximum: 100 },
                        "Social Studies": { obtained: 72, maximum: 100 }
                    }
                },
                class2: {
                    "diana_wilson_2": {
                        "Mathematics": { obtained: 90, maximum: 100 },
                        "English": { obtained: 94, maximum: 100 },
                        "Science": { obtained: 87, maximum: 100 },
                        "Social Studies": { obtained: 91, maximum: 100 },
                        "Art": { obtained: 96, maximum: 100 }
                    },
                    "edward_davis_2": {
                        "Mathematics": { obtained: 73, maximum: 100 },
                        "English": { obtained: 79, maximum: 100 },
                        "Science": { obtained: 76, maximum: 100 },
                        "Social Studies": { obtained: 74, maximum: 100 },
                        "Art": { obtained: 85, maximum: 100 }
                    },
                    "fiona_miller_2": {
                        "Mathematics": { obtained: 82, maximum: 100 },
                        "English": { obtained: 86, maximum: 100 },
                        "Science": { obtained: 84, maximum: 100 },
                        "Social Studies": { obtained: 88, maximum: 100 },
                        "Art": { obtained: 90, maximum: 100 }
                    }
                },
                class3: {
                    "george_taylor_3": {
                        "Mathematics": { obtained: 88, maximum: 100 },
                        "English": { obtained: 85, maximum: 100 },
                        "Science": { obtained: 90, maximum: 100 },
                        "Social Studies": { obtained: 87, maximum: 100 },
                        "Computer": { obtained: 95, maximum: 100 }
                    },
                    "helen_anderson_3": {
                        "Mathematics": { obtained: 92, maximum: 100 },
                        "English": { obtained: 89, maximum: 100 },
                        "Science": { obtained: 94, maximum: 100 },
                        "Social Studies": { obtained: 91, maximum: 100 },
                        "Computer": { obtained: 88, maximum: 100 }
                    },
                    "ivan_thomas_3": {
                        "Mathematics": { obtained: 77, maximum: 100 },
                        "English": { obtained: 74, maximum: 100 },
                        "Science": { obtained: 79, maximum: 100 },
                        "Social Studies": { obtained: 76, maximum: 100 },
                        "Computer": { obtained: 82, maximum: 100 }
                    }
                }
            }
        };

        // DOM Elements
        const elements = {
            // Navigation
            studentBtn: document.getElementById('studentBtn'),
            adminBtn: document.getElementById('adminBtn'),
            studentSection: document.getElementById('studentSection'),
            adminSection: document.getElementById('adminSection'),

            
            // Student View
            classSelect: document.getElementById('classSelect'),
            studentSelect: document.getElementById('studentSelect'),
            reportCard: document.getElementById('reportCard'),
            studentInfo: document.getElementById('studentInfo'),
            marksTable: document.getElementById('marksTable'),
            summary: document.getElementById('summary'),
            inspirationalQuote: document.getElementById('inspirationalQuote'),
            
            // Admin
            adminLogin: document.getElementById('adminLogin'),
            adminDashboard: document.getElementById('adminDashboard'),
            adminPassword: document.getElementById('adminPassword'),
            loginBtn: document.getElementById('loginBtn'),
            adminClassSelect: document.getElementById('adminClassSelect'),
            adminStudentSelect: document.getElementById('adminStudentSelect'),
            deleteStudentBtn: document.getElementById('deleteStudentBtn'),
            studentForm: document.getElementById('studentForm'),
            studentName: document.getElementById('studentName'),
            fatherName: document.getElementById('fatherName'),
            subjectsContainer: document.getElementById('subjectsContainer'),
            addSubjectBtn: document.getElementById('addSubjectBtn'),
            saveStudentBtn: document.getElementById('saveStudentBtn')
        };

        // Utility Functions
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 2000);
        }

        function generateStudentId(name) {
            return name.toLowerCase().replace(/\s+/g, '_') + '_' + Date.now();
        }

        function calculateGrade(percentage) {
            if (percentage >= 90) return 'A+';
            if (percentage >= 80) return 'A';
            if (percentage >= 70) return 'B';
            if (percentage >= 60) return 'C';
            if (percentage >= 50) return 'D';
            return 'F';
        }

        // Celebration Functions for High Achievers (85%+)
        function createCelebrationEffects() {
            const container = document.getElementById('celebrationContainer');
            container.classList.remove('hidden');
            container.innerHTML = '';

            // Create confetti pieces
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'][Math.floor(Math.random() * 6)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
            }

            // Create star bursts
            for (let i = 0; i < 10; i++) {
                const star = document.createElement('div');
                star.className = 'star-burst';
                star.innerHTML = '⭐';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }

            // Create fireworks
            for (let i = 0; i < 8; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = Math.random() * 100 + '%';
                firework.style.top = Math.random() * 50 + '%';
                firework.style.backgroundColor = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1'][Math.floor(Math.random() * 4)];
                firework.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(firework);
            }

            // Create shower effect (water drops)
            for (let i = 0; i < 30; i++) {
                const drop = document.createElement('div');
                drop.className = 'shower-drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDelay = Math.random() * 2 + 's';
                drop.style.animationDuration = (Math.random() * 1 + 1.5) + 's';
                container.appendChild(drop);
            }

            // Hide celebration after 10 seconds
            setTimeout(() => {
                container.classList.add('hidden');
            }, 10000);
        }

        function applyCelebrationStyles(percentage) {
            const reportCard = document.getElementById('reportCard');
            const studentInfo = document.getElementById('studentInfo');
            const summary = document.getElementById('summary');
            const inspirationalQuote = document.getElementById('inspirationalQuote');

            if (percentage >= 85) {
                // Add special celebration classes
                reportCard.classList.add('gold-glow');
                studentInfo.classList.add('celebration');
                summary.classList.add('trophy-bounce');
                inspirationalQuote.classList.add('celebration');
                
                // Create celebration effects
                createCelebrationEffects();
                
                // Add special trophy and crown emojis
                const reportCardTitle = reportCard.querySelector('h2');
                if (reportCardTitle && !reportCardTitle.innerHTML.includes('👑')) {
                    reportCardTitle.innerHTML = '🏆EXCELLENT REPORT CARD🏆';
                }
            } else {
                // Remove celebration classes if percentage is below 85%
                reportCard.classList.remove('gold-glow');
                studentInfo.classList.remove('celebration');
                summary.classList.remove('trophy-bounce');
                inspirationalQuote.classList.remove('celebration');
                
                // Reset title
                const reportCardTitle = reportCard.querySelector('h2');
                if (reportCardTitle) {
                    reportCardTitle.innerHTML = '🎉✨ REPORT CARD ✨🎉';
                }
            }
        }

        // Inspirational Quotes based on performance
        function getInspirationalQuote(percentage, rank) {
            const quotes = {
                excellent: [
                    { quote: "You're amazing!", author: "Keep it up!", emoji: "🌟" },
                    { quote: "Great job!", author: "You rock!", emoji: "🏆" },
                    { quote: "Fantastic work!", author: "So proud!", emoji: "✨" },
                    { quote: "You're a star!", author: "Well done!", emoji: "👑" }
                ],
                good: [
                    { quote: "Nice work!", author: "Keep going!", emoji: "💪" },
                    { quote: "Good job!", author: "You can do it!", emoji: "❤️" },
                    { quote: "Well done!", author: "Keep trying!", emoji: "🚀" },
                    { quote: "Great effort!", author: "Don't stop!", emoji: "⏰" }
                ],
                average: [
                    { quote: "Keep learning!", author: "You're growing!", emoji: "🌱" },
                    { quote: "Never give up!", author: "Keep going!", emoji: "🛤️" },
                    { quote: "Try your best!", author: "You can do it!", emoji: "📈" },
                    { quote: "Keep working!", author: "Stay strong!", emoji: "🎯" }
                ],
                needsImprovement: [
                    { quote: "Try again!", author: "You can do it!", emoji: "🌈" },
                    { quote: "Don't give up!", author: "Keep trying!", emoji: "💫" },
                    { quote: "Learn and grow!", author: "You're brave!", emoji: "📚" },
                    { quote: "You're strong!", author: "Believe in yourself!", emoji: "🦁" }
                ]
            };

            let category;
            if (percentage >= 85 || rank <= 2) {
                category = 'excellent';
            } else if (percentage >= 70 || rank <= 5) {
                category = 'good';
            } else if (percentage >= 50) {
                category = 'average';
            } else {
                category = 'needsImprovement';
            }

            const categoryQuotes = quotes[category];
            const randomQuote = categoryQuotes[Math.floor(Math.random() * categoryQuotes.length)];
            return randomQuote;
        }

        // Restore Sample Data Function
        async function restoreSampleData() {
            try {
                // Add sample students
                await db.ref('students').set(sampleData.students);
                
                // Add sample marks
                await db.ref('marks').set(sampleData.marks);
                
                console.log('Sample data restored successfully');
                
            } catch (error) {
                console.error('Error restoring sample data:', error);
            }
        }

        // Navigation - Desktop and Mobile
        function showStudentSection() {
            elements.studentSection.classList.remove('hidden');
            elements.adminSection.classList.add('hidden');
            elements.reportCard.classList.add('hidden');
        }

        function showAdminSection() {
            elements.adminSection.classList.remove('hidden');
            elements.studentSection.classList.add('hidden');
            elements.reportCard.classList.add('hidden');
            elements.adminLogin.classList.remove('hidden');
            elements.adminDashboard.classList.add('hidden');
        }

        // Desktop Navigation
        elements.studentBtn.addEventListener('click', showStudentSection);
        elements.adminBtn.addEventListener('click', showAdminSection);

        // Mobile Navigation
        document.getElementById('studentBtnMobile').addEventListener('click', showStudentSection);
        document.getElementById('adminBtnMobile').addEventListener('click', showAdminSection);

        // Admin Login
        elements.loginBtn.addEventListener('click', () => {
            if (elements.adminPassword.value === ADMIN_PASSWORD) {
                elements.adminLogin.classList.add('hidden');
                elements.adminDashboard.classList.remove('hidden');
                addSubjectRow(); // Add initial subject row
            } else {
                showMessage('❌ Incorrect password!', 'error');
            }
        });

        // Student View - Class Selection
        elements.classSelect.addEventListener('change', async () => {
            const classNum = elements.classSelect.value;
            elements.studentSelect.innerHTML = '<option value="">Select Student</option>';
            elements.studentSelect.disabled = true;
            elements.reportCard.classList.add('hidden');

            if (classNum) {
                try {
                    const snapshot = await db.ref(`students/class${classNum}`).once('value');
                    const students = snapshot.val();
                    
                    if (students) {
                        elements.studentSelect.disabled = false;
                        Object.keys(students).forEach(studentId => {
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = students[studentId].name;
                            elements.studentSelect.appendChild(option);
                        });
                    } else {
                        elements.studentSelect.innerHTML = '<option value="">No students found</option>';
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                    showMessage('❌ Error loading students', 'error');
                }
            }
        });

        // Student View - Student Selection
        elements.studentSelect.addEventListener('change', async () => {
            const classNum = elements.classSelect.value;
            const studentId = elements.studentSelect.value;
            
            if (classNum && studentId) {
                await displayReportCard(classNum, studentId);
            } else {
                elements.reportCard.classList.add('hidden');
            }
        });

        // Display Report Card Function
        async function displayReportCard(classNum, studentId) {
            // Show report card immediately
            elements.reportCard.classList.remove('hidden');
            
            try {
                const [studentSnapshot, marksSnapshot] = await Promise.all([
                    db.ref(`students/class${classNum}/${studentId}`).once('value'),
                    db.ref(`marks/class${classNum}/${studentId}`).once('value')
                ]);
                
                const studentData = studentSnapshot.val();
                const marksData = marksSnapshot.val();

                if (!studentData) {
                    showMessage('❌ Student data not found!', 'error');
                    elements.reportCard.classList.add('hidden');
                    return;
                }

                // Display student info with enhanced animations
                elements.studentInfo.innerHTML = `
                    <div class="relative overflow-hidden rounded-3xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); padding: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: slideIn 0.8s ease-out;">
                        <div class="bg-white rounded-2xl p-4 sm:p-6 text-center relative z-10">
                            <div class="absolute top-2 right-2 text-2xl animate-bounce">👦</div>
                            <h3 class="text-lg sm:text-2xl font-bold text-orange-700 mb-3" style="animation: wiggle 2s ease-in-out infinite;">✨ STUDENT NAME ✨</h3>
                            <p class="text-base sm:text-xl font-bold text-orange-800 bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">${studentData.name}</p>
                        </div>
                        <div class="absolute -top-2 -left-2 w-8 h-8 bg-yellow-300 rounded-full opacity-60 animate-pulse"></div>
                    </div>
                    <div class="relative overflow-hidden rounded-3xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%); padding: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.2s;">
                        <div class="bg-white rounded-2xl p-4 sm:p-6 text-center relative z-10">
                            <div class="absolute top-2 right-2 text-2xl animate-bounce" style="animation-delay: 0.5s;">👨</div>
                            <h3 class="text-lg sm:text-2xl font-bold text-green-700 mb-3" style="animation: pulse 2s ease-in-out infinite;">💚 FATHER'S NAME 💚</h3>
                            <p class="text-base sm:text-xl font-bold text-green-800 bg-gradient-to-r from-green-500 to-teal-500 bg-clip-text text-transparent">${studentData.fatherName}</p>
                        </div>
                        <div class="absolute -bottom-2 -right-2 w-6 h-6 bg-green-300 rounded-full opacity-60 animate-bounce"></div>
                    </div>
                    <div class="relative overflow-hidden rounded-3xl transform hover:scale-105 transition-all duration-500" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); padding: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.4s;">
                        <div class="bg-white rounded-2xl p-4 sm:p-6 text-center relative z-10">
                            <div class="absolute top-2 right-2 text-2xl animate-bounce" style="animation-delay: 1s;">📚</div>
                            <h3 class="text-lg sm:text-2xl font-bold text-blue-700 mb-3" style="animation: float 3s ease-in-out infinite;">💙 CLASS LEVEL 💙</h3>
                            <p class="text-base sm:text-xl font-bold text-blue-800 bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">Class ${classNum}</p>
                        </div>
                        <div class="absolute -top-2 -right-2 w-10 h-10 bg-blue-300 rounded-full opacity-60" style="animation: float 4s ease-in-out infinite;"></div>
                    </div>
                `;

                // Display enhanced marks table with animations
                let totalObtained = 0;
                let totalMaximum = 0;
                let tableHTML = '';

                if (marksData) {
                    Object.keys(marksData).forEach((subject, index) => {
                        const marks = marksData[subject];
                        const percentage = ((marks.obtained / marks.maximum) * 100).toFixed(1);
                        const grade = calculateGrade(percentage);
                        totalObtained += marks.obtained;
                        totalMaximum += marks.maximum;

                        // Enhanced row styling with gradients and animations
                        const rowGradient = index % 4 === 0 ? 'from-pink-50 to-rose-100' : 
                                          index % 4 === 1 ? 'from-blue-50 to-indigo-100' : 
                                          index % 4 === 2 ? 'from-green-50 to-emerald-100' : 
                                          'from-yellow-50 to-amber-100';
                        
                        const gradeColor = percentage >= 90 ? 'text-green-600 font-extrabold' : 
                                         percentage >= 80 ? 'text-blue-600 font-extrabold' : 
                                         percentage >= 70 ? 'text-yellow-600 font-extrabold' : 
                                         percentage >= 60 ? 'text-orange-600 font-extrabold' : 
                                         'text-red-600 font-extrabold';
                        
                        const gradeEmoji = percentage >= 90 ? '🏆' : 
                                         percentage >= 80 ? '🥇' : 
                                         percentage >= 70 ? '🥈' : 
                                         percentage >= 60 ? '🥉' : '📚';
                        
                        const animationDelay = index * 0.1;
                        
                        tableHTML += `
                            <tr class="bg-gradient-to-r ${rowGradient} hover:scale-102 transition-all duration-300 border-b-1 sm:border-b-2 border-white mobile-animate" style="animation: fadeInUp 0.6s ease-out; animation-delay: ${animationDelay}s; animation-fill-mode: both;">
                                <td class="text-purple-800 relative">
                                    <div class="flex items-center justify-center">
                                        <span class="mr-1 text-sm sm:text-xl animate-bounce" style="animation-delay: ${animationDelay + 0.5}s;">📖</span>
                                        <span class="text-xs sm:text-base font-bold">${subject}</span>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="bg-blue-500 text-white px-2 py-1 rounded-full inline-block transform hover:scale-110 transition-all duration-300 text-xs sm:text-base font-bold mobile-animate" style="animation: pulse 2s ease-in-out infinite; animation-delay: ${animationDelay + 0.2}s;">
                                        ${marks.obtained}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="bg-green-500 text-white px-2 py-1 rounded-full inline-block transform hover:scale-110 transition-all duration-300 text-xs sm:text-base font-bold mobile-animate" style="animation: pulse 2s ease-in-out infinite; animation-delay: ${animationDelay + 0.4}s;">
                                        ${marks.maximum}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-2 py-1 rounded-full inline-block transform hover:scale-110 transition-all duration-300 text-xs sm:text-base font-bold mobile-animate" style="animation: wiggle 2s ease-in-out infinite; animation-delay: ${animationDelay + 0.6}s;">
                                        ${percentage}%
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                } else {
                    tableHTML = '<tr><td colspan="4" class="py-8 text-center text-gray-500 text-lg">📚 No marks data available 📚</td></tr>';
                }

                elements.marksTable.innerHTML = tableHTML;

                // Calculate overall performance
                const overallPercentage = totalMaximum > 0 ? ((totalObtained / totalMaximum) * 100).toFixed(1) : 0;
                const overallGrade = calculateGrade(overallPercentage);
                const rank = 1; // Simplified rank calculation

                // Display enhanced summary with spectacular animations
                const performanceLevel = overallPercentage >= 90 ? 'outstanding' : 
                                       overallPercentage >= 80 ? 'excellent' : 
                                       overallPercentage >= 70 ? 'good' : 
                                       overallPercentage >= 60 ? 'satisfactory' : 'needsImprovement';
                
                const performanceEmoji = overallPercentage >= 90 ? '🏆👑' : 
                                       overallPercentage >= 80 ? '🥇⭐' : 
                                       overallPercentage >= 70 ? '🥈💫' : 
                                       overallPercentage >= 60 ? '🥉✨' : '📚💪';
                
                const rankEmoji = rank === 1 ? '👑🏆' : rank <= 3 ? '🥇⭐' : rank <= 5 ? '🥈💫' : '🥉✨';
                
                elements.summary.innerHTML = `
                    <div class="relative overflow-hidden rounded-3xl transform hover:scale-110 transition-all duration-500" style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 50%, #fd79a8 100%); padding: 8px; box-shadow: 0 15px 40px rgba(0,0,0,0.3), 0 0 0 4px rgba(255,255,255,0.2); animation: slideIn 0.8s ease-out;">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-2 left-2 text-2xl animate-bounce">📊</div>
                        <div class="absolute top-2 right-2 text-xl animate-bounce" style="animation-delay: 0.5s;">✨</div>
                        <div class="absolute bottom-2 left-2 text-lg animate-bounce" style="animation-delay: 1s;">💯</div>
                        
                        <div class="bg-white rounded-2xl p-4 sm:p-6 text-center relative z-10 shadow-inner">
                            <div class="mb-4">
                                <div class="text-3xl sm:text-4xl animate-bounce mb-2">📊✨</div>
                                <h3 class="text-lg sm:text-2xl font-bold text-orange-700 mb-3" style="animation: wiggle 2s ease-in-out infinite;">TOTAL MARKS</h3>
                            </div>
                            <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-3 rounded-3xl transform hover:scale-105 transition-all duration-300" style="animation: pulse 2s ease-in-out infinite;">
                                <p class="text-2xl sm:text-4xl font-extrabold">${totalObtained}/${totalMaximum}</p>
                            </div>
                        </div>
                        
                        <!-- Decorative circles -->
                        <div class="absolute -top-3 -left-3 w-12 h-12 bg-yellow-300 rounded-full opacity-40 animate-pulse"></div>
                        <div class="absolute -bottom-3 -right-3 w-8 h-8 bg-pink-300 rounded-full opacity-40" style="animation: float 3s ease-in-out infinite;"></div>
                    </div>
                    
                    <div class="relative overflow-hidden rounded-3xl transform hover:scale-110 transition-all duration-500" style="background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 50%, #52c41a 100%); padding: 8px; box-shadow: 0 15px 40px rgba(0,0,0,0.3), 0 0 0 4px rgba(255,255,255,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.2s;">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-2 left-2 text-2xl animate-bounce" style="animation-delay: 0.3s;">📈</div>
                        <div class="absolute top-2 right-2 text-xl animate-bounce" style="animation-delay: 0.8s;">🌟</div>
                        <div class="absolute bottom-2 right-2 text-lg animate-bounce" style="animation-delay: 1.3s;">💚</div>
                        
                        <div class="bg-white rounded-2xl p-4 sm:p-6 text-center relative z-10 shadow-inner">
                            <div class="mb-4">
                                <div class="text-3xl sm:text-4xl animate-bounce mb-2" style="animation-delay: 0.5s;">${performanceEmoji}</div>
                                <h3 class="text-lg sm:text-2xl font-bold text-green-700 mb-3" style="animation: pulse 2s ease-in-out infinite;">PERCENTAGE</h3>
                            </div>
                            <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-4 py-3 rounded-2xl transform hover:scale-105 transition-all duration-300 ${overallPercentage >= 85 ? 'gold-glow' : ''}" style="animation: ${overallPercentage >= 85 ? 'celebration 2s ease-in-out infinite' : 'wiggle 2s ease-in-out infinite'};">
                                <p class="text-2xl sm:text-4xl font-extrabold">${overallPercentage}%</p>
                                <p class="text-sm sm:text-base font-bold mt-1 capitalize">${performanceLevel}</p>
                            </div>
                        </div>
                        
                        <!-- Decorative circles -->
                        <div class="absolute -top-3 -right-3 w-10 h-10 bg-green-300 rounded-full opacity-40" style="animation: float 4s ease-in-out infinite;"></div>
                        <div class="absolute -bottom-3 -left-3 w-6 h-6 bg-teal-300 rounded-full opacity-40 animate-bounce"></div>
                    </div>
                    
                    <div class="relative overflow-hidden rounded-3xl transform hover:scale-110 transition-all duration-500" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #6c5ce7 100%); padding: 8px; box-shadow: 0 15px 40px rgba(0,0,0,0.3), 0 0 0 4px rgba(255,255,255,0.2); animation: slideIn 0.8s ease-out; animation-delay: 0.4s;">
                        
                        <!-- Floating Elements -->
                        <div class="absolute top-2 left-2 text-2xl animate-bounce" style="animation-delay: 0.6s;">🥇</div>
                        <div class="absolute top-2 right-2 text-xl animate-bounce" style="animation-delay: 1.1s;">💫</div>
                        <div class="absolute bottom-2 left-2 text-lg animate-bounce" style="animation-delay: 1.6s;">🎯</div>
                        
                        <div class="bg-white rounded-2xl p-4 sm:p-6 text-center relative z-10 shadow-inner">
                            <div class="mb-4">
                                <div class="text-3xl sm:text-4xl animate-bounce mb-2" style="animation-delay: 0.7s;">${rankEmoji}</div>
                                <h3 class="text-lg sm:text-2xl font-bold text-blue-700 mb-3" style="animation: float 3s ease-in-out infinite;">CLASS RANK</h3>
                            </div>
                            <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-3 rounded-2xl transform hover:scale-105 transition-all duration-300 ${rank <= 3 ? 'trophy-bounce' : ''}" style="animation: ${rank <= 3 ? 'celebration 2s ease-in-out infinite' : 'pulse 2s ease-in-out infinite'};">
                                <p class="text-2xl sm:text-4xl font-extrabold">#${rank}</p>
                                <p class="text-sm sm:text-base font-bold mt-1">${rank === 1 ? 'First Place!' : rank <= 3 ? 'Top 3!' : rank <= 5 ? 'Top 5!' : 'Keep Going!'}</p>
                            </div>
                        </div>
                        
                        <!-- Decorative circles -->
                        <div class="absolute -top-3 -left-3 w-8 h-8 bg-blue-300 rounded-full opacity-40 animate-pulse"></div>
                        <div class="absolute -bottom-3 -right-3 w-12 h-12 bg-purple-300 rounded-full opacity-40" style="animation: float 5s ease-in-out infinite reverse;"></div>
                    </div>
                `;

                // Display enhanced inspirational quote with magical effects
                const inspirationalQuote = getInspirationalQuote(parseFloat(overallPercentage), rank);
                document.getElementById('inspirationalQuote').innerHTML = `
                    <div class="mb-6 sm:mb-8 relative">
                        <!-- Animated Title -->
                        <div class="text-center relative">
                            <div class="absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-red-400 rounded-3xl opacity-20 animate-pulse"></div>
                            <h3 class="relative text-2xl sm:text-5xl font-extrabold mb-4 sm:mb-6" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: pulse 3s ease-in-out infinite; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">
                                ${inspirationalQuote.emoji}✨ WORDS OF INSPIRATION ✨${inspirationalQuote.emoji}
                            </h3>
                            
                            <!-- Decorative line -->
                            <div class="w-64 h-2 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 mx-auto rounded-full mb-6" style="animation: pulse 2s ease-in-out infinite;"></div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Quote Container -->
                    <div class="relative overflow-hidden rounded-3xl" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 8px; box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 6px rgba(255,255,255,0.1);">
                        
                        <!-- Floating Quote Marks -->
                        <div class="absolute top-4 left-4 text-6xl text-white opacity-20 animate-pulse">"</div>
                        <div class="absolute bottom-4 right-4 text-6xl text-white opacity-20 animate-bounce" style="animation-delay: 1s; transform: rotate(180deg);">"</div>
                        
                        <!-- Main Quote Content -->
                        <div class="bg-white rounded-2xl p-6 sm:p-10 shadow-2xl relative z-10 border-4 border-white/20">
                            
                            <!-- Quote Text -->
                            <div class="text-center mb-6 sm:mb-8">
                                <div class="text-4xl sm:text-6xl mb-4 animate-bounce">${inspirationalQuote.emoji}</div>
                                <p class="text-xl sm:text-4xl font-bold mb-6 sm:mb-8 italic relative" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1.4; animation: pulse 3s ease-in-out infinite;">
                                    "${inspirationalQuote.quote}"
                                </p>
                                
                                <!-- Author -->
                                <div class="relative">
                                    <div class="absolute inset-0 bg-gradient-to-r from-purple-200 to-pink-200 rounded-2xl opacity-50"></div>
                                    <p class="relative text-lg sm:text-2xl font-bold text-purple-700 py-3 px-6 rounded-2xl border-2 border-purple-300" style="animation: pulse 2s ease-in-out infinite;">
                                        - ${inspirationalQuote.author}
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Motivational Message -->
                            <div class="text-center">
                                <div class="bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 text-white px-6 py-4 rounded-3xl shadow-lg transform hover:scale-105 transition-all duration-300" style="animation: pulse 2s ease-in-out infinite;">
                                    <p class="text-lg sm:text-2xl font-extrabold">✨🌟✨Keep shining bright! ✨🌟✨</p>
                                    <p class="text-sm sm:text-lg font-bold mt-2">You are amazing and capable of great things!</p>
                                </div>
                            </div>
                            
                            <!-- Decorative Stars -->
                            <div class="absolute top-4 left-8 text-2xl text-yellow-400 animate-pulse">⭐</div>
                            <div class="absolute top-8 right-8 text-xl text-pink-400 animate-bounce" style="animation-delay: 0.5s;">✨</div>
                            <div class="absolute bottom-8 left-6 text-lg text-purple-400 animate-bounce" style="animation-delay: 1s;">🌟</div>
                            <div class="absolute bottom-4 right-12 text-2xl text-blue-400 animate-bounce" style="animation-delay: 1.5s;">💫</div>
                        </div>
                        
                        <!-- Background Animation Elements -->
                        <div class="absolute top-10 left-10 w-16 h-16 bg-white rounded-full opacity-10" style="animation: pulse 4s ease-in-out infinite;"></div>
                        <div class="absolute bottom-10 right-10 w-12 h-12 bg-white rounded-full opacity-10" style="animation: pulse 5s ease-in-out infinite reverse;"></div>
                        <div class="absolute top-1/2 left-1/4 w-8 h-8 bg-white rounded-full opacity-10" style="animation: pulse 3s ease-in-out infinite;"></div>
                    </div>
                `;

                // Apply celebration effects for high achievers (85%+)
                applyCelebrationStyles(parseFloat(overallPercentage));

                // Report card already shown above

            } catch (error) {
                console.error('Error displaying report card:', error);
                showMessage('❌ Error loading report card!', 'error');
            }
        }

        // Calculate Rank
        async function calculateRank(classNum, percentage) {
            try {
                const studentsSnapshot = await db.ref(`students/class${classNum}`).once('value');
                const students = studentsSnapshot.val();
                
                if (!students) return 1;

                const percentages = [];
                
                for (const studentId of Object.keys(students)) {
                    const marksSnapshot = await db.ref(`marks/class${classNum}/${studentId}`).once('value');
                    const marksData = marksSnapshot.val();
                    
                    if (marksData) {
                        let totalObtained = 0;
                        let totalMaximum = 0;
                        
                        Object.values(marksData).forEach(marks => {
                            totalObtained += marks.obtained;
                            totalMaximum += marks.maximum;
                        });
                        
                        const studentPercentage = totalMaximum > 0 ? (totalObtained / totalMaximum) * 100 : 0;
                        percentages.push(studentPercentage);
                    }
                }
                
                percentages.sort((a, b) => b - a);
                const rank = percentages.findIndex(p => p <= percentage) + 1;
                return rank || percentages.length + 1;
                
            } catch (error) {
                console.error('Error calculating rank:', error);
                return 1;
            }
        }

        // Admin - Class Selection
        elements.adminClassSelect.addEventListener('change', async () => {
            const classNum = elements.adminClassSelect.value;
            elements.adminStudentSelect.innerHTML = '<option value="">Select Student</option><option value="new">➕ Add New Student</option>';
            elements.adminStudentSelect.disabled = true;
            elements.deleteStudentBtn.disabled = true;
            clearForm();

            if (classNum) {
                try {
                    const snapshot = await db.ref(`students/class${classNum}`).once('value');
                    const students = snapshot.val();
                    
                    elements.adminStudentSelect.disabled = false;
                    
                    if (students) {
                        Object.keys(students).forEach(studentId => {
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = students[studentId].name;
                            elements.adminStudentSelect.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                    showMessage('❌ Error loading students', 'error');
                }
            }
        });

        // Admin - Student Selection
        elements.adminStudentSelect.addEventListener('change', async () => {
            const selectedValue = elements.adminStudentSelect.value;
            const classNum = elements.adminClassSelect.value;
            
            elements.deleteStudentBtn.disabled = !selectedValue || selectedValue === 'new';
            
            if (selectedValue === 'new') {
                clearForm();
                currentStudentId = null;
            } else if (selectedValue && classNum) {
                await loadStudentData(classNum, selectedValue);
            }
        });

        // Load Student Data
        async function loadStudentData(classNum, studentId) {
            try {
                const [studentSnapshot, marksSnapshot] = await Promise.all([
                    db.ref(`students/class${classNum}/${studentId}`).once('value'),
                    db.ref(`marks/class${classNum}/${studentId}`).once('value')
                ]);
                
                const studentData = studentSnapshot.val();
                const marksData = marksSnapshot.val();
                
                currentStudentId = studentId;
                
                // Populate student info
                elements.studentName.value = studentData.name || '';
                elements.fatherName.value = studentData.fatherName || '';
                
                // Clear and populate subjects
                elements.subjectsContainer.innerHTML = '';
                subjectCount = 0;
                
                if (marksData) {
                    Object.keys(marksData).forEach(subject => {
                        const marks = marksData[subject];
                        addSubjectRow(subject, marks.obtained, marks.maximum);
                    });
                } else {
                    addSubjectRow(); // Add empty row
                }
                
            } catch (error) {
                console.error('Error loading student data:', error);
                showMessage('❌ Error loading student data', 'error');
            }
        }

        // Clear Form
        function clearForm() {
            elements.studentName.value = '';
            elements.fatherName.value = '';
            elements.subjectsContainer.innerHTML = '';
            subjectCount = 0;
            currentStudentId = null;
            addSubjectRow(); // Add initial empty row
        }

        // Add Subject Row
        function addSubjectRow(subjectName = '', obtained = '', maximum = '') {
            subjectCount++;
            const row = document.createElement('div');
            row.className = 'subject-row grid grid-cols-1 sm:grid-cols-4 gap-2 sm:gap-4 mb-3 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border-2 border-purple-200 items-center';
            row.innerHTML = `
                <div class="sm:col-span-1">
                    <label class="block text-sm font-bold text-purple-700 mb-1 sm:hidden">Subject:</label>
                    <input type="text" class="subject-name w-full p-2 sm:p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none text-sm sm:text-base" placeholder="Subject name" value="${subjectName}">
                </div>
                <div class="sm:col-span-1">
                    <label class="block text-sm font-bold text-purple-700 mb-1 sm:hidden">Obtained:</label>
                    <input type="number" class="obtained-marks w-full p-2 sm:p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none text-sm sm:text-base" placeholder="Obtained" min="0" value="${obtained}">
                </div>
                <div class="sm:col-span-1">
                    <label class="block text-sm font-bold text-purple-700 mb-1 sm:hidden">Maximum:</label>
                    <input type="number" class="max-marks w-full p-2 sm:p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none text-sm sm:text-base" placeholder="Maximum" min="1" value="${maximum}">
                </div>
                <div class="text-center sm:col-span-1">
                    <button type="button" class="remove-subject bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded-lg transform hover:scale-105 transition-all duration-300 text-sm sm:text-base w-full sm:w-auto" ${subjectCount === 1 ? 'style="display:none"' : ''}>
                        🗑️ Remove
                    </button>
                </div>
            `;
            
            elements.subjectsContainer.appendChild(row);
            
            // Add remove functionality
            row.querySelector('.remove-subject').addEventListener('click', () => {
                row.remove();
                subjectCount--;
                updateRemoveButtons();
            });
            
            updateRemoveButtons();
        }

        // Update Remove Buttons Visibility
        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.remove-subject');
            removeButtons.forEach(btn => {
                btn.style.display = removeButtons.length > 1 ? 'block' : 'none';
            });
        }

        // Add Subject Button
        elements.addSubjectBtn.addEventListener('click', () => {
            addSubjectRow();
        });

        // Delete Student
        elements.deleteStudentBtn.addEventListener('click', async () => {
            const selectedValue = elements.adminStudentSelect.value;
            const classNum = elements.adminClassSelect.value;
            
            if (!selectedValue || selectedValue === 'new' || !classNum) {
                showMessage('❌ Please select a student to delete!', 'error');
                return;
            }
            
            const studentName = elements.adminStudentSelect.selectedOptions[0].textContent;
            
            if (confirm(`⚠️ Are you sure you want to delete ${studentName}? This action cannot be undone!`)) {
                try {
                    await Promise.all([
                        db.ref(`students/class${classNum}/${selectedValue}`).remove(),
                        db.ref(`marks/class${classNum}/${selectedValue}`).remove()
                    ]);
                    
                    showMessage(`✅ ${studentName} deleted successfully!`);
                    
                    // Refresh student list
                    elements.adminClassSelect.dispatchEvent(new Event('change'));
                    
                } catch (error) {
                    console.error('Error deleting student:', error);
                    showMessage(`❌ Failed to delete ${studentName}!`, 'error');
                }
            }
        });

        // Save Student
        elements.saveStudentBtn.addEventListener('click', async () => {
            const classNum = elements.adminClassSelect.value;
            const studentName = elements.studentName.value.trim();
            const fatherName = elements.fatherName.value.trim();
            
            if (!classNum) {
                showMessage('❌ Please select a class!', 'error');
                return;
            }
            
            if (!studentName || !fatherName) {
                showMessage('❌ Please fill in student name and father\'s name!', 'error');
                return;
            }
            
            // Collect subjects data
            const subjectRows = document.querySelectorAll('.subject-row');
            const subjects = {};
            let hasValidSubject = false;
            
            subjectRows.forEach(row => {
                const subjectName = row.querySelector('.subject-name').value.trim();
                const obtainedMarks = parseInt(row.querySelector('.obtained-marks').value);
                const maxMarks = parseInt(row.querySelector('.max-marks').value);
                
                if (subjectName && !isNaN(obtainedMarks) && !isNaN(maxMarks) && maxMarks > 0) {
                    subjects[subjectName] = {
                        obtained: obtainedMarks,
                        maximum: maxMarks
                    };
                    hasValidSubject = true;
                }
            });
            
            if (!hasValidSubject) {
                showMessage('❌ Please add at least one complete subject with valid marks!', 'error');
                return;
            }
            
            try {
                const studentId = currentStudentId || generateStudentId(studentName);
                
                // Save student data
                await db.ref(`students/class${classNum}/${studentId}`).set({
                    name: studentName,
                    fatherName: fatherName
                });
                
                // Save marks data
                await db.ref(`marks/class${classNum}/${studentId}`).set(subjects);
                
                const action = currentStudentId ? 'updated' : 'saved';
                showMessage(`✅ ${studentName} ${action} successfully!`);
                
                // Refresh student list
                elements.adminClassSelect.dispatchEvent(new Event('change'));
                
            } catch (error) {
                console.error('Error saving student:', error);
                showMessage('❌ Error saving student data!', 'error');
            }
        });

        // Initialize with sample data on first load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Smart Report Card System initialized');
            
            // Check if database is empty and auto-restore sample data in background (non-blocking)
            setTimeout(async () => {
                try {
                    const studentsSnapshot = await db.ref('students').once('value');
                    if (!studentsSnapshot.exists()) {
                        console.log('Database is empty, restoring sample data...');
                        await restoreSampleData();
                    }
                } catch (error) {
                    console.error('Error checking database:', error);
                }
            }, 100);
        });
    </script>

    <!-- Developer Credit Marquee at Bottom -->
    <div class="fixed bottom-0 left-0 right-0 z-50 overflow-hidden" style="background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe); background-size: 400% 400%; animation: rainbow 3s ease infinite; border-top: 4px solid #ffffff; box-shadow: 0 -10px 30px rgba(0,0,0,0.3);">
        
        <!-- Animated Background Elements -->
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute -top-2 left-10 w-8 h-8 bg-white rounded-full opacity-20 animate-bounce"></div>
            <div class="absolute -top-1 right-20 w-6 h-6 bg-yellow-300 rounded-full opacity-30 animate-pulse"></div>
            <div class="absolute -top-3 left-1/3 w-4 h-4 bg-pink-300 rounded-full opacity-25" style="animation: float 4s ease-in-out infinite;"></div>
            <div class="absolute -top-2 right-1/3 w-5 h-5 bg-blue-300 rounded-full opacity-20" style="animation: float 3s ease-in-out infinite reverse;"></div>
        </div>
        
        <!-- Main Marquee Container -->
        <div class="relative py-3 sm:py-4 overflow-hidden">
            <div class="marquee-container">
                <div class="whitespace-nowrap animate-marquee">
                    
                    <!-- Sparkle Effects -->
                    <span class="inline-block text-2xl sm:text-2xl animate-bounce mr-4" style="animation-delay: 0s;">✨</span>
                    <span class="inline-block text-xl sm:text-2xl animate-bounce mr-2" style="animation-delay: 0.2s;">🌟</span>
                    <span class="inline-block text-lg sm:text-2xl animate-bounce mr-4" style="animation-delay: 0.4s;">💫</span>
                    
                    <!-- Main Developer Credit Text -->
                    <span class="text-lg sm:text-1xl md:text-2xl lg:text-2xl font-display text-white mr-8 relative" style="text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.8); letter-spacing: 3px; animation: pulse 2s ease-in-out infinite;">
                        🚀👨‍💻 This site is developed by Mr. Deepak Kumar Vaishy 👨‍💻🚀
                    </span>
                    
                    <!-- More Sparkle Effects -->
                    <span class="inline-block text-2xl sm:text-3xl animate-bounce mr-4" style="animation-delay: 0.6s;">⭐</span>
                    <span class="inline-block text-xl sm:text-2xl animate-bounce mr-2" style="animation-delay: 0.8s;">🎯</span>
                    <span class="inline-block text-lg sm:text-xl animate-bounce mr-4" style="animation-delay: 1s;">🏆</span>
                    
                    <!-- Repeated Text for Continuous Effect -->
                    <span class="text-lg sm:text-1xl md:text-2xl lg:text-2xl font-display text-white mr-8 relative" style="text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.8); letter-spacing: 3px; animation: wiggle 3s ease-in-out infinite;">
                        💻✨ This site is developed by Mr. Deepak Kumar Vaishy ✨💻
                    </span>
                    
                    <!-- Final Sparkle Effects -->
                    <span class="inline-block text-2xl sm:text-3xl animate-bounce mr-4" style="animation-delay: 1.2s;">🌈</span>
                    <span class="inline-block text-xl sm:text-2xl animate-bounce mr-2" style="animation-delay: 1.4s;">💎</span>
                    <span class="inline-block text-lg sm:text-xl animate-bounce mr-8" style="animation-delay: 1.6s;">🎨</span>
                    
                    <!-- Third Repetition -->
                    <span class="text-lg sm:text-2xl md:text-3xl lg:text-4xl font-display text-white mr-8 relative" style="text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.8); letter-spacing: 2px; animation: bounce 2s ease-in-out infinite;">
                        🎓🌟 This site is developed by Mr. Deepak Kumar Vaishy 🌟🎓
                    </span>
                    
                </div>
            </div>
        </div>
        
        <!-- Decorative Border Animation -->
        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400" style="animation: pulse 1.5s ease-in-out infinite;"></div>
        
        <!-- Floating Elements -->
        <div class="absolute top-1 left-4 text-lg text-white opacity-60 animate-bounce" style="animation-delay: 0.3s;">💻</div>
        <div class="absolute top-2 right-8 text-sm text-white opacity-50 animate-bounce" style="animation-delay: 0.7s;">🚀</div>
        <div class="absolute top-1 left-1/2 text-base text-white opacity-40 animate-bounce" style="animation-delay: 1.1s;">⚡</div>
        
    </div>

    <!-- Add bottom padding to main content to prevent overlap with fixed marquee -->
    <style>
        body {
            padding-bottom: 60px; /* Adjust based on marquee height */
        }
        
        @media (min-width: 640px) {
            body {
                padding-bottom: 80px;
            }
        }
        
        /* Enhanced marquee animation for smoother effect */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .animate-marquee {
            animation: marquee 25s linear infinite;
        }
        
        /* Pause animation on hover for better readability */
        .marquee-container:hover .animate-marquee {
            animation-play-state: paused;
        }
        
        /* Glowing text effect for developer credit */
        .developer-glow {
            text-shadow: 
                0 0 5px rgba(255,255,255,0.8),
                0 0 10px rgba(255,255,255,0.6),
                0 0 15px rgba(255,255,255,0.4),
                0 0 20px rgba(102, 126, 234, 0.8),
                0 0 35px rgba(102, 126, 234, 0.6),
                0 0 40px rgba(102, 126, 234, 0.4);
        }
        
        /* Mobile responsiveness for marquee */
        @media (max-width: 640px) {
            .animate-marquee {
                animation-duration: 20s;
            }
            
            body {
                padding-bottom: 60px;
            }
        }
        
        /* Tablet responsiveness */
        @media (min-width: 641px) and (max-width: 1024px) {
            .animate-marquee {
                animation-duration: 22s;
            }
        }
        
        /* Desktop enhancement */
        @media (min-width: 1025px) {
            .animate-marquee {
                animation-duration: 30s;
            }
            
            body {
                padding-bottom: 90px;
            }
        }
    </style>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a3d9dfe45e16e3',t:'MTc1NDM3MTI4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
