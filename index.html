<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Student Report Card System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        .rainbow-bg {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        }
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f39c12;
            animation: confetti-fall 3s linear infinite;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes shower {
            0% { transform: translateY(-100vh) scale(0); opacity: 0; }
            10% { opacity: 1; transform: scale(1); }
            90% { opacity: 1; }
            100% { transform: translateY(100vh) scale(0); opacity: 0; }
        }
        .shower-particle {
            position: absolute;
            font-size: 2rem;
            animation: shower 4s linear infinite;
            pointer-events: none;
        }
        
        /* Marquee Animations */
        @keyframes marqueeLeft {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        @keyframes marqueeRight {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #0073e6, 0 0 20px #0073e6; }
            50% { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #0073e6, 0 0 40px #0073e6; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes slideInLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInUp {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s ease-out;
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s ease-out;
        }
        
        .slide-in-up {
            animation: slideInUp 0.8s ease-out;
        }
        
        .btn-hover {
            transition: all 0.3s ease;
        }
        
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .marquee-top {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            overflow: hidden;
            white-space: nowrap;
            padding: 15px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .marquee-bottom {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c);
            overflow: hidden;
            white-space: nowrap;
            padding: 15px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .marquee-content-top {
            display: inline-block;
            animation: marqueeLeft 20s linear infinite;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }
        
        .marquee-content-bottom {
            display: inline-block;
            animation: marqueeLeft 30s linear infinite;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
        }
        
        /* Animated Background */
        @keyframes backgroundShift {
            0% { background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); }
            14% { background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c); }
            28% { background: linear-gradient(-45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4); }
            42% { background: linear-gradient(-45deg, #ffeaa7, #fab1a0, #fd79a8, #fdcb6e); }
            56% { background: linear-gradient(-45deg, #a29bfe, #6c5ce7, #fd79a8, #e84393); }
            70% { background: linear-gradient(-45deg, #00b894, #00cec9, #0984e3, #6c5ce7); }
            84% { background: linear-gradient(-45deg, #e17055, #d63031, #74b9ff, #0984e3); }
            100% { background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); }
        }
        
        .animated-bg {
            background-size: 400% 400%;
            animation: backgroundShift 15s ease infinite;
        }
    </style>
</head>
<body class="min-h-screen animated-bg" style="font-family: 'Comic Sans MS', bold, sans-serif; padding-top: 60px; padding-bottom: 60px;">
    <!-- Top Marquee -->
    <div class="marquee-top">
        <div class="marquee-content-top">
            🎓 Welcome to Primary School Karanpur, "🌟A school with a difference.".🌟 "Learn with JOY !! "🌟 Excellence in Education 📚 Building Future Leaders 🚀
        </div>
    </div>

    <!-- Celebration Overlay -->
    <div id="celebration" class="celebration hidden"></div>

    <!-- School Name Box -->
    <div class="container mx-auto px-4 py-6">
        <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 p-1 rounded-3xl shadow-2xl mb-6">
            <div class="bg-white rounded-3xl p-6 text-center">
                <h1 class="text-5xl sm:text-5xl md:text-6xl font-bold bg-gradient-to-r from-indigo-600 to-purple-500 bg-clip-text text-transparent mb-2">
                    Primary School Karanpur
                </h1>
                <p class="text-lg sm:text-xl text-gray-600 font-semibold">"A School with a Difference."</p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-2xl mb-8 border-4 border-yellow-300 rounded-b-3xl">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                <h1 class="text-2xl sm:text-3xl font-bold text-purple-600 text-center">🎓 Report Card System 🎓</h1>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
                    <button id="studentViewBtn" class="bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 text-white px-4 py-3 rounded-full btn-hover shadow-lg border-2 border-blue-300 font-bold text-sm sm:text-base slide-in-left">
                        📊 Student View
                    </button>
                    <button id="adminViewBtn" class="bg-gradient-to-r from-red-400 to-red-600 hover:from-red-500 hover:to-red-700 text-white px-4 py-3 rounded-full btn-hover shadow-lg border-2 border-red-300 font-bold text-sm sm:text-base slide-in-right">
                        👨‍💼 Admin Panel
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Student View -->
    <div id="studentView" class="container mx-auto px-2 sm:px-4">
        <div class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 mb-8 border-4 border-purple-300">
            <h2 class="text-2xl sm:text-4xl font-bold text-center text-purple-600 mb-6 sm:mb-8">🌟 Select Student Report Card 🌟</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
                <div class="space-y-2">
                    <label class="block text-base sm:text-lg font-bold text-gray-700">📚 Select Class:</label>
                    <select id="classSelect" class="w-full p-3 sm:p-4 border-4 border-purple-300 rounded-2xl focus:border-purple-500 focus:outline-none text-base sm:text-lg bg-purple-50 font-bold transform hover:scale-105 transition-all duration-300">
                        <option value="">Choose Class...</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                    </select>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-base sm:text-lg font-bold text-gray-700">👦 Select Student:</label>
                    <select id="studentSelect" class="w-full p-3 sm:p-4 border-4 border-purple-300 rounded-2xl focus:border-purple-500 focus:outline-none text-base sm:text-lg bg-purple-50 font-bold transform hover:scale-105 transition-all duration-300" disabled>
                        <option value="">First select a class...</option>
                    </select>
                </div>
            </div>
            

        </div>

        <!-- Report Card Display -->
        <div id="reportCard" class="hidden bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-2 sm:p-4 md:p-8 border-2 sm:border-4 border-yellow-400 mx-1 sm:mx-0">
            <div id="reportContent"></div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden container mx-auto px-2 sm:px-4">
        <!-- Admin Login -->
        <div id="adminLogin" class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 max-w-md mx-auto border-4 border-red-300">
            <h2 class="text-2xl sm:text-3xl font-bold text-center text-red-600 mb-6">🔐 Admin Login</h2>
            <div class="space-y-4">
                <input type="password" id="adminPassword" placeholder="Enter Admin Password" class="w-full p-3 sm:p-4 border-4 border-red-300 rounded-2xl focus:border-red-500 focus:outline-none text-base sm:text-lg bg-red-50 font-bold transform hover:scale-105 transition-all duration-300">
                <button id="loginBtn" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 sm:py-4 rounded-2xl text-base sm:text-lg font-bold btn-hover shadow-lg border-2 border-red-400">
                    🚀 Login
                </button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <div class="bg-white rounded-3xl shadow-2xl p-4 sm:p-8 mb-8 border-4 border-red-300">
                <h2 class="text-2xl sm:text-4xl font-bold text-center text-red-600 mb-6 sm:mb-8">👨‍💼 Admin Dashboard</h2>
                
                <!-- Student Management Form -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <div>
                        <label class="block text-base sm:text-lg font-bold text-gray-700 mb-2">📚 Select Class:</label>
                        <select id="adminClassSelect" class="w-full p-3 sm:p-4 border-4 border-red-300 rounded-2xl focus:border-red-500 focus:outline-none text-base sm:text-lg bg-red-50 font-bold transform hover:scale-105 transition-all duration-300">
                            <option value="">Choose Class...</option>
                            <option value="1">Class 1</option>
                            <option value="2">Class 2</option>
                            <option value="3">Class 3</option>
                            <option value="4">Class 4</option>
                            <option value="5">Class 5</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-base sm:text-lg font-bold text-gray-700 mb-2">👦 Select Student:</label>
                        <select id="adminStudentSelect" class="w-full p-3 sm:p-4 border-4 border-red-300 rounded-2xl focus:border-red-500 focus:outline-none text-base sm:text-lg bg-red-50 font-bold transform hover:scale-105 transition-all duration-300" disabled>
                            <option value="">First select a class...</option>
                            <option value="new">➕ Add New Student</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Student Form -->
            <div id="studentForm" class="hidden bg-white rounded-3xl shadow-2xl p-4 sm:p-8 mb-8 border-4 border-green-300">
                <h3 id="formTitle" class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">➕ Add New Student</h3>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">👦 Student Name:</label>
                        <input type="text" id="studentName" class="w-full p-3 border-4 border-gray-300 rounded-2xl focus:border-green-500 focus:outline-none bg-green-50 font-bold transform hover:scale-105 transition-all duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">👨 Father's Name:</label>
                        <input type="text" id="fatherName" class="w-full p-3 border-4 border-gray-300 rounded-2xl focus:border-green-500 focus:outline-none bg-green-50 font-bold transform hover:scale-105 transition-all duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">📚 Class:</label>
                        <select id="studentClass" class="w-full p-3 border-4 border-gray-300 rounded-2xl focus:border-green-500 focus:outline-none bg-green-50 font-bold transform hover:scale-105 transition-all duration-300">
                            <option value="">Select Class...</option>
                            <option value="1">Class 1</option>
                            <option value="2">Class 2</option>
                            <option value="3">Class 3</option>
                            <option value="4">Class 4</option>
                            <option value="5">Class 5</option>
                        </select>
                    </div>
                </div>

                <!-- Subjects -->
                <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-4 sm:p-6 rounded-3xl mb-6 border-4 border-blue-300">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 space-y-2 sm:space-y-0">
                        <h4 class="text-lg sm:text-xl font-bold text-gray-800">📚 Subjects & Marks</h4>
                        <button id="addSubjectBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-2xl font-bold btn-hover shadow-lg border-2 border-blue-400">
                            ➕ Add Subject
                        </button>
                    </div>
                    <div id="allSubjects" class="space-y-3">
                        <!-- All subjects will be added here -->
                    </div>
                </div>
                
                <!-- Success Message -->
                <div id="successMessage" class="hidden bg-green-100 border-4 border-green-400 text-green-800 px-6 py-4 rounded-2xl mb-4 text-center font-bold">
                    <!-- Success message will appear here -->
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="saveStudentBtn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl text-lg sm:text-xl font-bold btn-hover shadow-2xl border-4 border-green-400 slide-in-left">
                        💾 Save Student
                    </button>
                    <button id="deleteStudentBtn" class="hidden bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-2xl text-lg sm:text-xl font-bold btn-hover shadow-2xl border-4 border-red-400 slide-in-right">
                        🗑️ Delete Student
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXcBGbfxZ0kU0vqbZvsB_eD7nRBdmRAVI",
            authDomain: "deeapk1281.firebaseapp.com",
            databaseURL: "https://deeapk1281-default-rtdb.firebaseio.com",
            projectId: "deeapk1281",
            storageBucket: "deeapk1281.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:c60b948ecacf60888a356b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let currentView = 'student';
        const adminPassword = 'admin123';

        // DOM Elements
        const studentViewBtn = document.getElementById('studentViewBtn');
        const adminViewBtn = document.getElementById('adminViewBtn');
        const studentView = document.getElementById('studentView');
        const adminPanel = document.getElementById('adminPanel');
        const classSelect = document.getElementById('classSelect');
        const studentSelect = document.getElementById('studentSelect');
        const generateReportBtn = document.getElementById('generateReportBtn');
        const reportCard = document.getElementById('reportCard');

        // Navigation
        studentViewBtn.addEventListener('click', () => {
            currentView = 'student';
            studentView.classList.remove('hidden');
            adminPanel.classList.add('hidden');
            studentViewBtn.classList.add('bg-blue-600');
            adminViewBtn.classList.remove('bg-red-600');
        });

        adminViewBtn.addEventListener('click', () => {
            currentView = 'admin';
            studentView.classList.add('hidden');
            adminPanel.classList.remove('hidden');
            // Always show login screen when accessing admin panel
            adminLogin.classList.remove('hidden');
            adminDashboard.classList.add('hidden');
            adminPasswordInput.value = ''; // Clear any existing password
            adminViewBtn.classList.add('bg-red-600');
            studentViewBtn.classList.remove('bg-blue-600');
        });

        // Class selection handler
        classSelect.addEventListener('change', async (e) => {
            const selectedClass = e.target.value;
            studentSelect.innerHTML = '<option value="">Select Student...</option>';
            studentSelect.disabled = true;
            reportCard.classList.add('hidden');

            if (selectedClass) {
                try {
                    const snapshot = await database.ref(`students/class${selectedClass}`).once('value');
                    const students = snapshot.val();
                    
                    if (students) {
                        Object.keys(students).forEach(studentId => {
                            const student = students[studentId];
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = student.name;
                            studentSelect.appendChild(option);
                        });
                        studentSelect.disabled = false;
                    } else {
                        studentSelect.innerHTML = '<option value="">No students found</option>';
                    }
                } catch (error) {
                    console.error('Error fetching students:', error);
                    studentSelect.innerHTML = '<option value="">Error loading students</option>';
                }
            } else {
                studentSelect.innerHTML = '<option value="">First select a class...</option>';
            }
        });

        // Student selection handler - Auto generate report
        studentSelect.addEventListener('change', async (e) => {
            const selectedClass = classSelect.value;
            const selectedStudent = e.target.value;

            if (selectedClass && selectedStudent) {
                try {
                    const snapshot = await database.ref(`students/class${selectedClass}/${selectedStudent}`).once('value');
                    const studentData = snapshot.val();

                    if (studentData) {
                        generateReportCard(studentData, selectedClass);
                    }
                } catch (error) {
                    console.error('Error fetching student data:', error);
                }
            } else {
                reportCard.classList.add('hidden');
            }
        });



        // Generate report card HTML
        function generateReportCard(studentData, classNum) {
            const subjects = studentData.subjects || {};
            let totalObtained = 0;
            let totalMaximum = 0;
            
            // Subject order priority
            const subjectOrder = ['Hindi', 'English', 'Maths', 'EVS', 'Sanskrit'];
            
            // Filter and order subjects - show subjects with obtained marks > 0 or if they have any marks entered
            const filteredSubjects = {};
            
            // Add subjects in order if they have obtained marks > 0
            subjectOrder.forEach(subjectName => {
                if (subjects[subjectName] && subjects[subjectName].obtained > 0) {
                    filteredSubjects[subjectName] = subjects[subjectName];
                }
            });
            
            // Add other subjects that have obtained marks > 0
            Object.keys(subjects).forEach(subjectName => {
                if (!subjectOrder.includes(subjectName) && subjects[subjectName].obtained > 0) {
                    filteredSubjects[subjectName] = subjects[subjectName];
                }
            });
            
            // Calculate totals from filtered subjects
            Object.values(filteredSubjects).forEach(subject => {
                totalObtained += subject.obtained || 0;
                totalMaximum += subject.maximum || 0;
            });

            const percentage = totalMaximum > 0 ? ((totalObtained / totalMaximum) * 100).toFixed(2) : 0;
            const isHighAchiever = percentage >= 85;

            // Generate subjects table from filtered subjects
            let subjectsHTML = '';
            Object.entries(filteredSubjects).forEach(([subjectName, marks]) => {
                // Convert subject name to proper case
                const properCaseSubject = subjectName.charAt(0).toUpperCase() + subjectName.slice(1).toLowerCase();
                subjectsHTML += `
                    <tr class="border-b border-gray-200 hover:bg-purple-50 transition-colors duration-200">
                        <td class="py-3 px-2 sm:py-4 sm:px-4 font-semibold text-gray-800 text-sm sm:text-base md:text-lg">${properCaseSubject}</td>
                        <td class="py-3 px-2 sm:py-4 sm:px-4 text-center text-blue-600 font-bold text-sm sm:text-base md:text-lg">${marks.obtained || 0}</td>
                        <td class="py-3 px-2 sm:py-4 sm:px-4 text-center text-gray-600 text-sm sm:text-base md:text-lg">${marks.maximum || 0}</td>
                        <td class="py-3 px-2 sm:py-4 sm:px-4 text-center font-bold text-sm sm:text-base md:text-lg">${marks.obtained || 0}/${marks.maximum || 0}</td>
                    </tr>
                `;
            });

            const reportHTML = `
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold text-purple-600 mb-2 ${isHighAchiever ? 'rainbow-bg text-transparent bg-clip-text' : ''}">
                        🎓 REPORT CARD
                    </h2>
                    ${isHighAchiever ? '<div class="text-2xl">🌟 EXCELLENT PERFORMANCE! 🌟</div>' : ''}
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-4 sm:p-6 rounded-2xl">
                        <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4">📋 Student Information</h3>
                        <div class="space-y-2 text-sm sm:text-base">
                            <p><span class="font-semibold">👦 Student Name:</span> ${studentData.name}</p>
                            <p><span class="font-semibold">👨 Father's Name:</span> ${studentData.fatherName}</p>
                            <p><span class="font-semibold">📚 Class:</span> ${classNum}</p>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-green-100 to-blue-100 p-4 sm:p-6 rounded-2xl">
                        <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4">📊 Performance Summary</h3>
                        <div class="space-y-2 text-sm sm:text-base">
                            <p><span class="font-semibold">📈 Total Marks:</span> ${totalObtained}/${totalMaximum}</p>
                            <p><span class="font-semibold">🎯 Percentage:</span> <span class="${percentage >= 85 ? 'text-green-600 font-bold text-lg sm:text-xl' : percentage >= 60 ? 'text-blue-600' : 'text-red-600'}">${percentage}%</span></p>
                            <p><span class="font-semibold">🏆 Grade:</span> <span class="font-bold ${percentage >= 85 ? 'text-green-600' : percentage >= 60 ? 'text-blue-600' : 'text-red-600'}">${getGrade(percentage)}</span></p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-2xl p-3 sm:p-6">
                    <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 text-center">📚 Subject-wise Performance</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-xl shadow-lg overflow-hidden min-w-full">
                            <thead class="bg-gradient-to-r from-purple-500 to-blue-500 text-white">
                                <tr>
                                    <th class="py-4 px-2 sm:py-5 sm:px-4 text-left font-bold text-sm sm:text-base md:text-lg">Subject</th>
                                    <th class="py-4 px-2 sm:py-5 sm:px-4 text-center font-bold text-sm sm:text-base md:text-lg">Obtained</th>
                                    <th class="py-4 px-2 sm:py-5 sm:px-4 text-center font-bold text-sm sm:text-base md:text-lg">Maximum</th>
                                    <th class="py-4 px-2 sm:py-5 sm:px-4 text-center font-bold text-sm sm:text-base md:text-lg">OM/MM</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${subjectsHTML}
                                <tr class="bg-gradient-to-r from-yellow-100 to-orange-100 font-bold text-base sm:text-lg md:text-xl">
                                    <td class="py-4 px-2 sm:py-5 sm:px-4">🎯 TOTAL</td>
                                    <td class="py-4 px-2 sm:py-5 sm:px-4 text-center text-blue-600">${totalObtained}</td>
                                    <td class="py-4 px-2 sm:py-5 sm:px-4 text-center">${totalMaximum}</td>
                                    <td class="py-4 px-2 sm:py-5 sm:px-4 text-center font-bold">${totalObtained}/${totalMaximum}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Motivational Quote -->
                <div class="mt-8 text-center">
                    <div class="bg-gradient-to-r from-indigo-100 to-purple-100 p-6 rounded-2xl border-4 border-indigo-300">
                        <h4 class="text-lg font-bold text-indigo-800 mb-2">💫 Daily Motivation</h4>
                        <p class="text-base text-indigo-700 font-semibold italic">"${getMotivationalQuote()}"</p>
                    </div>
                </div>

                ${isHighAchiever ? `
                    <div class="mt-6 text-center">
                        <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-6 rounded-2xl shadow-2xl">
                            <h3 class="text-2xl font-bold mb-2">🎉 CONGRATULATIONS! 🎉</h3>
                            <p class="text-lg">Outstanding performance! Keep up the excellent work!</p>
                        </div>
                    </div>
                ` : ''}
            `;

            document.getElementById('reportContent').innerHTML = reportHTML;
            reportCard.classList.remove('hidden');
            reportCard.classList.add('slide-in-up');

            // Trigger celebration animation for high achievers
            if (isHighAchiever) {
                triggerCelebration();
            }

            // Scroll to report card
            setTimeout(() => {
                reportCard.scrollIntoView({ behavior: 'smooth' });
            }, 200);
        }

        // Get grade based on percentage
        function getGrade(percentage) {
            if (percentage >= 90) return 'A+';
            if (percentage >= 80) return 'A';
            if (percentage >= 70) return 'B+';
            if (percentage >= 60) return 'B';
            if (percentage >= 50) return 'C';
            if (percentage >= 40) return 'D';
            return 'F';
        }

        // Get random motivational quote
        function getMotivationalQuote() {
            const quotes = [
                "Success is not final, failure is not fatal: it is the courage to continue that counts.",
                "The future belongs to those who believe in the beauty of their dreams.",
                "It is during our darkest moments that we must focus to see the light.",
                "Believe you can and you're halfway there.",
                "The only impossible journey is the one you never begin.",
                "In the middle of difficulty lies opportunity.",
                "Success is not how high you have climbed, but how you make a positive difference to the world.",
                "Don't watch the clock; do what it does. Keep going.",
                "The way to get started is to quit talking and begin doing.",
                "Innovation distinguishes between a leader and a follower.",
                "Your limitation—it's only your imagination.",
                "Push yourself, because no one else is going to do it for you.",
                "Great things never come from comfort zones.",
                "Dream it. Wish it. Do it.",
                "Success doesn't just find you. You have to go out and get it."
            ];
            return quotes[Math.floor(Math.random() * quotes.length)];
        }

        // Trigger celebration animation with shower effects
        function triggerCelebration() {
            const celebration = document.getElementById('celebration');
            celebration.classList.remove('hidden');
            
            // Create confetti
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    celebration.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 100);
            }
            
            // Create shower particles
            const showerEmojis = ['🌟', '⭐', '✨', '🎉', '🎊', '🏆', '👏', '🎯', '💫', '🌈'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'shower-particle';
                    particle.textContent = showerEmojis[Math.floor(Math.random() * showerEmojis.length)];
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 2 + 's';
                    particle.style.animationDuration = (3 + Math.random() * 2) + 's';
                    celebration.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 5000);
                }, i * 150);
            }
            
            setTimeout(() => {
                celebration.classList.add('hidden');
            }, 6000);
        }

        // Admin Panel Functionality
        const adminLogin = document.getElementById('adminLogin');
        const adminDashboard = document.getElementById('adminDashboard');
        const adminPasswordInput = document.getElementById('adminPassword');
        const loginBtn = document.getElementById('loginBtn');

        loginBtn.addEventListener('click', () => {
            if (adminPasswordInput.value === adminPassword) {
                adminLogin.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                adminPasswordInput.value = ''; // Clear password after successful login
            } else {
                alert('❌ Incorrect password! Try "admin123"');
                adminPasswordInput.value = '';
            }
        });

        // Default subjects in order
        const defaultSubjects = ['Hindi', 'English', 'Maths', 'EVS', 'Sanskrit'];
        let currentStudentId = null;
        let isEditMode = false;

        // Admin class selection handler
        document.getElementById('adminClassSelect').addEventListener('change', async (e) => {
            const selectedClass = e.target.value;
            const studentSelect = document.getElementById('adminStudentSelect');
            
            studentSelect.innerHTML = '<option value="">Select Student...</option>';
            studentSelect.disabled = true;
            document.getElementById('studentForm').classList.add('hidden');

            if (selectedClass) {
                try {
                    const snapshot = await database.ref(`students/class${selectedClass}`).once('value');
                    const students = snapshot.val();
                    
                    studentSelect.innerHTML += '<option value="new">➕ Add New Student</option>';
                    
                    if (students) {
                        Object.keys(students).forEach(studentId => {
                            const student = students[studentId];
                            const option = document.createElement('option');
                            option.value = studentId;
                            option.textContent = `✏️ ${student.name}`;
                            studentSelect.appendChild(option);
                        });
                    }
                    studentSelect.disabled = false;
                } catch (error) {
                    console.error('Error fetching students:', error);
                    studentSelect.innerHTML = '<option value="">Error loading students</option>';
                }
            } else {
                studentSelect.innerHTML = '<option value="">First select a class...</option>';
            }
        });

        // Admin student selection handler
        document.getElementById('adminStudentSelect').addEventListener('change', async (e) => {
            const selectedStudent = e.target.value;
            const selectedClass = document.getElementById('adminClassSelect').value;

            if (selectedStudent === 'new') {
                // Add new student mode
                isEditMode = false;
                currentStudentId = null;
                document.getElementById('formTitle').textContent = '➕ Add New Student';
                document.getElementById('deleteStudentBtn').classList.add('hidden');
                clearForm();
                setupDefaultSubjects();
                document.getElementById('studentForm').classList.remove('hidden');
                document.getElementById('studentClass').value = selectedClass;
            } else if (selectedStudent && selectedClass) {
                // Edit existing student mode
                isEditMode = true;
                currentStudentId = selectedStudent;
                document.getElementById('formTitle').textContent = '✏️ Edit Student';
                document.getElementById('deleteStudentBtn').classList.remove('hidden');
                
                try {
                    const snapshot = await database.ref(`students/class${selectedClass}/${selectedStudent}`).once('value');
                    const studentData = snapshot.val();
                    
                    if (studentData) {
                        loadStudentData(studentData, selectedClass);
                        document.getElementById('studentForm').classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error loading student data:', error);
                }
            } else {
                document.getElementById('studentForm').classList.add('hidden');
            }
        });

        // Setup default subjects
        function setupDefaultSubjects() {
            const container = document.getElementById('allSubjects');
            container.innerHTML = '';
            
            defaultSubjects.forEach(subject => {
                addSubjectWithData(subject, 0, 10, true);
            });
        }

        // Add subject field
        document.getElementById('addSubjectBtn').addEventListener('click', addSubject);

        function addSubject() {
            addSubjectWithData('', 0, 10, false);
        }
        
        function addSubjectWithData(subjectName = '', obtained = 0, maximum = 10, isDefault = false) {
            const container = document.getElementById('allSubjects');
            const subjectDiv = document.createElement('div');
            subjectDiv.className = 'bg-white p-4 rounded-2xl shadow-lg border-4 border-blue-200 btn-hover';
            
            const removeButton = isDefault ? '' : `
                <div>
                    <button type="button" onclick="this.parentElement.parentElement.remove()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-3 rounded-xl font-bold w-full btn-hover shadow-lg border-2 border-red-400">
                        🗑️ Remove
                    </button>
                </div>
            `;
            
            const gridCols = isDefault ? 'sm:grid-cols-3' : 'sm:grid-cols-4';
            const readonlyAttr = isDefault ? 'readonly' : '';
            const placeholder = isDefault ? '' : 'placeholder="Subject Name"';
            
            subjectDiv.innerHTML = `
                <div class="grid grid-cols-1 ${gridCols} gap-3 items-end">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Subject Name:</label>
                        <input type="text" class="subject-name w-full p-3 border-4 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none bg-blue-50 font-bold" value="${subjectName}" ${readonlyAttr} ${placeholder}>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Obtained Marks:</label>
                        <input type="number" class="subject-obtained w-full p-3 border-4 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none bg-blue-50 font-bold text-center" min="0" value="${obtained}">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Maximum Marks:</label>
                        <input type="number" class="subject-maximum w-full p-3 border-4 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none bg-blue-50 font-bold text-center" min="1" value="${maximum}">
                    </div>
                    ${removeButton}
                </div>
            `;
            container.appendChild(subjectDiv);
        }

        // Clear form
        function clearForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('fatherName').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('allSubjects').innerHTML = '';
            document.getElementById('successMessage').classList.add('hidden');
        }

        // Load student data for editing
        function loadStudentData(studentData, classNum) {
            document.getElementById('studentName').value = studentData.name || '';
            document.getElementById('fatherName').value = studentData.fatherName || '';
            document.getElementById('studentClass').value = classNum;
            document.getElementById('successMessage').classList.add('hidden');
            
            // Clear and load all subjects
            document.getElementById('allSubjects').innerHTML = '';
            const subjects = studentData.subjects || {};
            
            // Load default subjects first
            defaultSubjects.forEach(subject => {
                const subjectData = subjects[subject] || { obtained: 0, maximum: 10 };
                addSubjectWithData(subject, subjectData.obtained, subjectData.maximum, true);
            });
            
            // Load additional subjects
            Object.keys(subjects).forEach(subjectName => {
                if (!defaultSubjects.includes(subjectName)) {
                    addSubjectWithData(subjectName, subjects[subjectName].obtained || 0, subjects[subjectName].maximum || 10, false);
                }
            });
        }

        // Show message function
        function showMessage(message, type) {
            const messageDiv = document.getElementById('successMessage');
            if (!messageDiv) {
                console.error('Success message div not found');
                alert(message); // Fallback to alert
                return;
            }
            
            messageDiv.textContent = message;
            
            if (type === 'success') {
                messageDiv.className = 'bg-green-100 border-4 border-green-400 text-green-800 px-6 py-4 rounded-2xl mb-4 text-center font-bold';
            } else {
                messageDiv.className = 'bg-red-100 border-4 border-red-400 text-red-800 px-6 py-4 rounded-2xl mb-4 text-center font-bold';
            }
            
            messageDiv.classList.remove('hidden');
            
            // Hide message after 4 seconds
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 4000);
        }

        // Save student function
        async function saveStudent() {
            console.log('Save student function called');
            
            const name = document.getElementById('studentName').value.trim();
            const fatherName = document.getElementById('fatherName').value.trim();
            const studentClass = document.getElementById('studentClass').value;

            console.log('Form data:', { name, fatherName, studentClass });

            if (!name || !fatherName || !studentClass) {
                showMessage('❌ Please fill in all required fields (Student Name, Father\'s Name, and Class)!', 'error');
                return;
            }

            // Collect subjects data
            const subjects = {};
            const subjectFields = document.querySelectorAll('#allSubjects > div');
            
            console.log('Found subject fields:', subjectFields.length);

            for (let field of subjectFields) {
                const subjectNameInput = field.querySelector('.subject-name');
                const obtainedInput = field.querySelector('.subject-obtained');
                const maximumInput = field.querySelector('.subject-maximum');
                
                if (subjectNameInput && obtainedInput && maximumInput) {
                    const subjectName = subjectNameInput.value.trim();
                    const obtained = parseInt(obtainedInput.value) || 0;
                    const maximum = parseInt(maximumInput.value) || 10;

                    if (subjectName && subjectName.length > 0 && maximum > 0) {
                        subjects[subjectName] = { obtained, maximum };
                    }
                }
            }

            console.log('Collected subjects:', subjects);

            if (Object.keys(subjects).length === 0) {
                showMessage('❌ Please add at least one subject!', 'error');
                return;
            }

            try {
                const studentData = {
                    name,
                    fatherName,
                    class: studentClass,
                    subjects
                };

                console.log('Saving student data:', studentData);

                if (isEditMode && currentStudentId) {
                    // Update existing student
                    await database.ref(`students/class${studentClass}/${currentStudentId}`).set(studentData);
                    showMessage(`✅ Student "${name}" has been updated successfully!`, 'success');
                    console.log('Student updated successfully');
                } else {
                    // Add new student
                    const newStudentRef = database.ref(`students/class${studentClass}`).push();
                    await newStudentRef.set(studentData);
                    showMessage(`✅ Student "${name}" has been added successfully to Class ${studentClass}!`, 'success');
                    console.log('New student added successfully');
                }
                
                // Scroll to admin dashboard after delay
                setTimeout(() => {
                    const adminDashboard = document.getElementById('adminDashboard');
                    if (adminDashboard) {
                        adminDashboard.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 1500);
                
                // Refresh student list
                setTimeout(() => {
                    const adminClassSelect = document.getElementById('adminClassSelect');
                    if (adminClassSelect) {
                        adminClassSelect.dispatchEvent(new Event('change'));
                    }
                }, 2000);

            } catch (error) {
                console.error('Error saving student:', error);
                showMessage(`❌ Error saving student "${name}". Please try again.`, 'error');
            }
        }

        // Delete student function
        async function deleteStudent() {
            console.log('Delete student function called');
            
            if (!currentStudentId || !isEditMode) {
                showMessage('❌ No student selected for deletion!', 'error');
                return;
            }

            const studentName = document.getElementById('studentName').value;
            const studentClass = document.getElementById('adminClassSelect').value;
            
            if (confirm(`Are you sure you want to delete ${studentName}? This action cannot be undone.`)) {
                try {
                    console.log('Deleting student:', currentStudentId, 'from class:', studentClass);
                    
                    await database.ref(`students/class${studentClass}/${currentStudentId}`).remove();
                    showMessage(`✅ Student "${studentName}" deleted successfully!`, 'success');
                    console.log('Student deleted successfully');
                    
                    // Reset variables
                    currentStudentId = null;
                    isEditMode = false;
                    
                    // Scroll to admin dashboard after delay
                    setTimeout(() => {
                        const adminDashboard = document.getElementById('adminDashboard');
                        if (adminDashboard) {
                            adminDashboard.scrollIntoView({ behavior: 'smooth' });
                        }
                    }, 1500);
                    
                    // Hide form and refresh student list
                    setTimeout(() => {
                        document.getElementById('studentForm').classList.add('hidden');
                        const adminClassSelect = document.getElementById('adminClassSelect');
                        if (adminClassSelect) {
                            adminClassSelect.dispatchEvent(new Event('change'));
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error deleting student:', error);
                    showMessage('❌ Error deleting student. Please try again.', 'error');
                }
            }
        }

        // Add event listeners after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Save button event listener
            const saveBtn = document.getElementById('saveStudentBtn');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveStudent);
                console.log('Save button event listener added');
            } else {
                console.error('Save button not found');
            }

            // Delete button event listener
            const deleteBtn = document.getElementById('deleteStudentBtn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', deleteStudent);
                console.log('Delete button event listener added');
            } else {
                console.error('Delete button not found');
            }
        });



        // Initialize with some sample data (for demo purposes)
        async function initializeSampleData() {
            try {
                // Check if data already exists
                const snapshot = await database.ref('students').once('value');
                if (!snapshot.exists()) {
                    // Add sample data with default subjects
                    const sampleData = {
                        students: {
                            class1: {
                                student1: {
                                    name: "Aarav Sharma",
                                    fatherName: "Rajesh Sharma",
                                    class: "1",
                                    subjects: {
                                        "Hindi": { obtained: 9, maximum: 10 },
                                        "English": { obtained: 8, maximum: 10 },
                                        "Maths": { obtained: 10, maximum: 10 },
                                        "EVS": { obtained: 9, maximum: 10 },
                                        "Sanskrit": { obtained: 8, maximum: 10 }
                                    }
                                },
                                student2: {
                                    name: "Priya Gupta",
                                    fatherName: "Suresh Gupta",
                                    class: "1",
                                    subjects: {
                                        "Hindi": { obtained: 7, maximum: 10 },
                                        "English": { obtained: 8, maximum: 10 },
                                        "Maths": { obtained: 6, maximum: 10 },
                                        "EVS": { obtained: 8, maximum: 10 },
                                        "Sanskrit": { obtained: 7, maximum: 10 }
                                    }
                                }
                            },
                            class2: {
                                student1: {
                                    name: "Arjun Singh",
                                    fatherName: "Vikram Singh",
                                    class: "2",
                                    subjects: {
                                        "Hindi": { obtained: 9, maximum: 10 },
                                        "English": { obtained: 8, maximum: 10 },
                                        "Maths": { obtained: 9, maximum: 10 },
                                        "EVS": { obtained: 10, maximum: 10 },
                                        "Sanskrit": { obtained: 8, maximum: 10 },
                                        "Drawing": { obtained: 9, maximum: 10 }
                                    }
                                }
                            }
                        }
                    };
                    
                    await database.ref().set(sampleData);
                    console.log('Sample data initialized');
                }
            } catch (error) {
                console.error('Error initializing sample data:', error);
            }
        }

        // Initialize the app
        initializeSampleData();
    </script>

    <!-- Bottom Marquee -->
    <div class="marquee-bottom">
        <div class="marquee-content-bottom">
            💻 This site is developed by Mr. Deepak Kumar Vaishy !! 🌟 Professional Web Development Services 🚀 Contact for Custom Solutions 📧
        </div>
    </div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c72dbb24925a12',t:'MTc1NDc0MTcyMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
